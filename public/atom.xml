<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Wyzane&#39;s Blog</title>
  
  
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="http://wyzane.gitee.io/blog/"/>
  <updated>2024-02-27T04:45:09.641Z</updated>
  <id>http://wyzane.gitee.io/blog/</id>
  
  <author>
    <name>Wyzane</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>AutoGençš„ä»‹ç»å’Œä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2024/02/27/AutoGen%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2024/02/27/AutoGen%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/</id>
    <published>2024-02-27T04:36:59.000Z</published>
    <updated>2024-02-27T04:45:09.641Z</updated>
    
    <content type="html"><![CDATA[<p>AutoGen æ˜¯ç”±å¾®è½¯ã€å®¾å¤•æ³•å°¼äºšå·ç«‹å¤§å­¦å’Œåç››é¡¿å¤§å­¦åˆä½œå¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒæ”¯æŒä½¿ç”¨å¤šä¸ªä»£ç†æ¥å¼€å‘ LLM åº”ç”¨ç¨‹åºï¼Œè¿™äº›ä»£ç†å¯ä»¥ç›¸äº’å¯¹è¯æ¥å®Œæˆä»»åŠ¡ã€‚</p><a id="more"></a><p>AutoGen ä¸­çš„ä»£ç†æ˜¯å¯å®šåˆ¶çš„ã€å¯å¯¹è¯çš„ï¼Œå¹¶ä¸”æ— ç¼åœ°å…è®¸äººç±»å‚ä¸ã€‚AutoGen æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><p>å¯ä»¥è½»æ¾æ„å»ºåŸºäºå¤šä»£ç†å¯¹è¯çš„ä¸‹ä¸€ä»£ LLM åº”ç”¨ç¨‹åºã€‚å®ƒç®€åŒ–äº†å¤æ‚çš„ LLM å·¥ä½œæµç¨‹çš„ç¼–æ’ã€è‡ªåŠ¨åŒ–å’Œä¼˜åŒ–ã€‚å®ƒæœ€å¤§é™åº¦åœ°æé«˜äº† LLM æ¨¡å‹çš„æ€§èƒ½å¹¶å…‹æœäº†å®ƒä»¬çš„å¼±ç‚¹ã€‚</p></li><li><p>å®ƒæ”¯æŒå¤æ‚å·¥ä½œæµç¨‹çš„å¤šç§å¯¹è¯æ¨¡å¼ã€‚å€ŸåŠ©å¯å®šåˆ¶å’Œå¯å¯¹è¯çš„ä»£ç†ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ AutoGen æ„å»ºå„ç§æ¶‰åŠå¯¹è¯è‡ªä¸»æ€§ã€ä»£ç†æ•°é‡å’Œä»£ç†å¯¹è¯æ‹“æ‰‘çš„å¯¹è¯æ¨¡å¼ã€‚</p></li><li><p>å®ƒæä¾›äº†ä¸€ç³»åˆ—å…·æœ‰ä¸åŒå¤æ‚æ€§çš„å·¥ä½œç³»ç»Ÿã€‚è¿™äº›ç³»ç»Ÿæ¶µç›–å„ç§é¢†åŸŸå’Œå¤æ‚æ€§çš„å¹¿æ³›åº”ç”¨ã€‚</p></li><li><p>å®ƒæä¾›å¢å¼ºçš„ LLM æ¨ç†ã€‚å®ƒæä¾› API å’Œç¼“å­˜ç­‰å®ç”¨ç¨‹åºï¼Œä»¥åŠé”™è¯¯å¤„ç†ã€å¤šé…ç½®æ¨ç†ã€ä¸Šä¸‹æ–‡ç¼–ç¨‹ç­‰é«˜çº§ä½¿ç”¨æ¨¡å¼ã€‚</p></li></ol><p>AutoGen çš„åŠŸèƒ½ç±»ä¼¼äº LangChain ä¸­çš„ agentsã€‚</p><h1 id="AutoGençš„å®‰è£…"><a href="#AutoGençš„å®‰è£…" class="headerlink" title="AutoGençš„å®‰è£…"></a>AutoGençš„å®‰è£…</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… AutoGen çš„ Python åŒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyautogen docker</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p><h1 id="AutoGençš„ä½¿ç”¨"><a href="#AutoGençš„ä½¿ç”¨" class="headerlink" title="AutoGençš„ä½¿ç”¨"></a>AutoGençš„ä½¿ç”¨</h1><h2 id="åŠ è½½é…ç½®æ•°æ®"><a href="#åŠ è½½é…ç½®æ•°æ®" class="headerlink" title="åŠ è½½é…ç½®æ•°æ®"></a>åŠ è½½é…ç½®æ•°æ®</h2><p>ä½¿ç”¨ AutoGen æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åŠ è½½é…ç½®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> autogen</span><br><span class="line"></span><br><span class="line"><span class="comment"># config_list = [</span></span><br><span class="line"><span class="comment">#     &#123;</span></span><br><span class="line"><span class="comment">#         "model": "gpt-4-32k",</span></span><br><span class="line"><span class="comment">#         "api_key": os.environ["OPENAI_API_KEY"],</span></span><br><span class="line"><span class="comment">#         "tags": ["gpt-4-32"]</span></span><br><span class="line"><span class="comment">#     &#125;,</span></span><br><span class="line"><span class="comment">#     &#123;</span></span><br><span class="line"><span class="comment">#         "model": "gpt-4",</span></span><br><span class="line"><span class="comment">#         "api_key": os.environ["OPENAI_API_KEY"],</span></span><br><span class="line"><span class="comment">#         "tags": ["gpt-4"]</span></span><br><span class="line"><span class="comment">#     &#125;,</span></span><br><span class="line"><span class="comment">#     &#123;</span></span><br><span class="line"><span class="comment">#          "model": "llama2",</span></span><br><span class="line"><span class="comment">#          "tags": ["llama2"]</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹©éœ€è¦ä½¿ç”¨çš„æ¨¡å‹</span></span><br><span class="line">filter_dict = &#123;</span><br><span class="line">    <span class="string">"model"</span>: <span class="string">"gpt-4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config_list = autogen.config_list_from_json(</span><br><span class="line">    <span class="string">"OAI_CONFIG_LIST"</span>,</span><br><span class="line">    filter_dict=filter_dict,   <span class="comment"># æŒ‡å®šéœ€è¦ä½¿ç”¨çš„æ¨¡å‹</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># agentè®¿é—® LLM çš„ç›¸å…³é…ç½®</span></span><br><span class="line">llm_config = &#123;</span><br><span class="line">    <span class="string">"timeout"</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="string">"cache_seed"</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="string">"config_list"</span>: config_list,   <span class="comment"># LLM é…ç½®åˆ—è¡¨</span></span><br><span class="line">    <span class="string">"temperature"</span>: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ config_list ä¸­ï¼Œå¯ä»¥é…ç½®å¾ˆå¤šæ¨¡å‹ä¾›ä¸åŒçš„ task ä½¿ç”¨ã€‚config_list å¯ä»¥ç›´æ¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ autogen.config_list_from_json() ä» OAI_CONFIG_LIST ä¸­åŠ è½½é…ç½®æ•°æ®ï¼ŒOAI_CONFIG_LIST å¯ä»¥æ˜¯ä¸€ä¸ªjsonæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;model&quot;: &quot;gpt-4-32k&quot;,</span><br><span class="line">        &quot;api_key&quot;: &quot;xxx&quot;,</span><br><span class="line">        &quot;tags&quot;: [&quot;gpt-4-32&quot;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;model&quot;: &quot;gpt-4&quot;,</span><br><span class="line">        &quot;api_key&quot;: &quot;xxx&quot;,</span><br><span class="line">        &quot;tags&quot;: [&quot;gpt-4&quot;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;model&quot;: &quot;llama2&quot;,</span><br><span class="line">        &quot;tage&quot;: [&quot;llama2&quot;, &quot;local&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>agent ä¼šä½¿ç”¨ config_list ä¸­å¯ç”¨çš„ç¬¬ä¸€ä¸ªæ¨¡å‹ï¼Œå¹¶é’ˆå¯¹è¯¥æ¨¡å‹è¿›è¡Œ LLM è°ƒç”¨ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¨¡å‹è°ƒç”¨å¤±è´¥ï¼Œagent å°†é’ˆå¯¹ç¬¬äºŒä¸ªæ¨¡å‹é‡è¯•è¯·æ±‚ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°æ”¶åˆ°æç¤ºå®Œæˆæ¶ˆæ¯ã€‚</p><p>å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª LLMï¼Œä½†æ˜¯æƒ³æŒ‡å®šä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªï¼Œå¯ä»¥ä½¿ç”¨ filter_dict è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚è¦æŒ‡å®šä½¿ç”¨ gpt-4 è¿™ä¸ªæ¨¡å‹ï¼Œå°±å¯ä»¥è¿™æ ·é…ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€‰æ‹©éœ€è¦ä½¿ç”¨çš„æ¨¡å‹</span></span><br><span class="line">filter_dict = &#123;</span><br><span class="line">    <span class="string">"model"</span>: <span class="string">"gpt-4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config_list = autogen.config_list_from_json(</span><br><span class="line">    <span class="string">"OAI_CONFIG_LIST"</span>,</span><br><span class="line">    filter_dict=filter_dict,   <span class="comment"># æŒ‡å®šéœ€è¦ä½¿ç”¨çš„æ¨¡å‹</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ tags è¿›è¡Œè¿‡æ»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filter_dict = &#123;</span><br><span class="line">    <span class="string">"tags"</span>: [<span class="string">"gpt-4"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ tags è¿›è¡Œè¿‡æ»¤æ—¶ï¼Œtags çš„å€¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­å¯ä»¥æŒ‡å®šå¤šä¸ª LLMã€‚</p><h2 id="åˆ›å»ºå¹¶è¿è¡Œagent"><a href="#åˆ›å»ºå¹¶è¿è¡Œagent" class="headerlink" title="åˆ›å»ºå¹¶è¿è¡Œagent"></a>åˆ›å»ºå¹¶è¿è¡Œagent</h2><p>åˆ›å»º agent æ—¶ï¼Œä¸Šé¢çš„ llm_config é…ç½®éœ€è¦ä½œä¸ºå‚æ•°ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">assistant = autogen.AssistantAgent(</span><br><span class="line">    name=<span class="string">"assistant"</span>,   <span class="comment"># agentåç§°</span></span><br><span class="line">    llm_config=llm_config,   <span class="comment"># agenté…ç½®</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç”¨æˆ·ä»£ç†ï¼Œè¯¥ä»£ç†å¯ä»¥æ‰§è¡Œä»£ç ï¼Œå¹¶å°†ç»“æœåé¦ˆç»™å…¶ä»–ä»£ç†</span></span><br><span class="line">user_proxy = autogen.UserProxyAgent(</span><br><span class="line">    name=<span class="string">"user_proxy"</span>,</span><br><span class="line">    human_input_mode=<span class="string">"NEVER"</span>,</span><br><span class="line">    max_consecutive_auto_reply=<span class="number">10</span>,</span><br><span class="line">    is_termination_msg=<span class="keyword">lambda</span> x: x.get(<span class="string">"content"</span>, <span class="string">""</span>).rstrip().endswith(<span class="string">"TERMINATE"</span>),</span><br><span class="line">    code_execution_config=&#123;</span><br><span class="line">        <span class="string">"work_dir"</span>: <span class="string">"web"</span>,</span><br><span class="line">        <span class="string">"use_docker"</span>: <span class="literal">False</span>,</span><br><span class="line">    &#125;, </span><br><span class="line">    llm_config=llm_config,</span><br><span class="line">    system_message=<span class="string">"""Reply TERMINATE if the task has been solved at full satisfaction.</span></span><br><span class="line"><span class="string">Otherwise, reply CONTINUE, or the reason why the task is not solved yet."""</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>åˆ›å»º UserProxyAgent å¯¹è±¡æ—¶ï¼Œå‚æ•°çš„å«ä¹‰ä¸ºï¼š</p><p>nameï¼šæŒ‡å®šç”¨æˆ·ä»£ç†çš„åç§°</p><p>human_input_modeï¼šç”¨æˆ·è¾“å…¥çš„æ¨¡å¼ï¼Œå³æ˜¯å¦åœ¨æ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯æ—¶è¯·æ±‚äººå·¥è¾“å…¥ã€‚å¯èƒ½çš„å€¼æœ‰ â€œALWAYSâ€ï¼Œâ€NEVERâ€ï¼Œâ€TERMINATEâ€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALWAYSï¼šè¡¨ç¤ºæ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä»£ç†éƒ½ä¼šæç¤ºäººå·¥è¾“å…¥ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“ç”¨æˆ·è¾“å…¥ exit æˆ–è€… is_termination_msg å‚æ•°ä¸º True æ—¶ï¼Œå¯¹è¯ä¼šé€€å‡ºã€‚</span><br><span class="line">NEVERï¼šè¡¨ç¤ºä»£ç†æ°¸è¿œä¸ä¼šæç¤ºäººå·¥è¾“å…¥ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“è‡ªåŠ¨å›å¤æ¬¡æ•°è¾¾åˆ° max_consecutive_auto_reply è®¾ç½®çš„å€¼æˆ–è€… is_termination_msg ä¸º True æ—¶ï¼Œå¯¹è¯ä¼šåœæ­¢ã€‚</span><br><span class="line">TERMINATEï¼šè¡¨ç¤ºä»…å½“æ”¶åˆ°ç»ˆæ­¢æ¶ˆæ¯æˆ–è‡ªåŠ¨å›å¤æ•°é‡è¾¾åˆ° max_consecutive_auto_reply è®¾ç½®çš„å€¼æ—¶ï¼Œä»£ç†æ‰ä¼šæç¤ºäººå·¥è¾“å…¥ã€‚</span><br></pre></td></tr></table></figure><p>max_consecutive_auto_replyï¼šä¸€ä¸ª int å€¼ï¼Œè®¾ç½®æœ€å¤§è¿ç»­è‡ªåŠ¨å›å¤æ•°ï¼Œé»˜è®¤ä¸º Noneï¼Œæ²¡æœ‰é™åˆ¶ã€‚è¯¥é™åˆ¶ä»…åœ¨ human_input_mode ä¸æ˜¯â€œALWAYSâ€æ—¶èµ·ä½œç”¨ã€‚</p><p>is_termination_msgï¼šè¯¥å‚æ•°å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—å­—å…¸å½¢å¼çš„æ¶ˆæ¯å¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ”¶åˆ°çš„æ¶ˆæ¯æ˜¯å¦æ˜¯ç»ˆæ­¢æ¶ˆæ¯ï¼Œè¯¥å­—å…¸å¯ä»¥åŒ…å«ä»¥ä¸‹é”®ï¼šâ€œcontentâ€ã€â€œroleâ€ã€â€œnameâ€ã€â€œfunction_callâ€ã€‚</p><p>code_execution_configï¼šæ˜¯ä¸€ä¸ªå­—å…¸æˆ–è€… Falseï¼Œè¡¨ç¤ºæ‰§è¡Œçš„ä»£ç éœ€è¦çš„é…ç½®ã€‚å­—å…¸ä¸­çš„é…ç½®é¡¹æœ‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">work_dirï¼ˆå¯é€‰ï¼Œstrï¼‰ï¼šä»£ç æ‰§è¡Œçš„å·¥ä½œç›®å½•ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°†ä½¿ç”¨é»˜è®¤å·¥ä½œç›®å½•ã€‚é»˜è®¤å·¥ä½œç›®å½•æ˜¯â€œpath_to_autogenâ€ä¸‹çš„â€œextensionsâ€ç›®å½•ã€‚</span><br><span class="line">use_dockerï¼ˆå¯é€‰ï¼Œlistã€str æˆ– boolï¼‰ï¼šç”¨äºæ‰§è¡Œä»£ç çš„ docker å®¹å™¨ã€‚é»˜è®¤å€¼ä¸º Trueï¼Œè¿™æ„å‘³ç€ä»£ç å°†åœ¨ docker å®¹å™¨ä¸­æ‰§è¡Œã€‚å°†ä½¿ç”¨é»˜è®¤çš„é•œåƒåˆ—è¡¨ã€‚å¦‚æœæä¾›äº†é•œåƒåç§°çš„åˆ—è¡¨æˆ–å­—ç¬¦ä¸²ï¼Œåˆ™ä»£ç å°†åœ¨ docker å®¹å™¨ä¸­æ‰§è¡Œï¼Œå¹¶æˆåŠŸæ‹‰å–ç¬¬ä¸€ä¸ªé•œåƒã€‚å¦‚æœä¸º Falseï¼Œåˆ™ä»£ç å°†åœ¨å½“å‰ç¯å¢ƒä¸­æ‰§è¡Œã€‚</span><br><span class="line">timeoutï¼ˆå¯é€‰ï¼Œintç±»å‹ï¼‰ï¼šæœ€å¤§æ‰§è¡Œæ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</span><br><span class="line">last_n_messagesï¼ˆå¯é€‰ï¼Œintç±»å‹ï¼‰ï¼šè¦å›é¡¾ä»£ç æ‰§è¡Œçš„æ¶ˆæ¯æ•°ã€‚é»˜è®¤ä¸º 1ã€‚</span><br></pre></td></tr></table></figure><p>llm_configï¼šLLM çš„é…ç½®ä¿¡æ¯</p><p>system_messageï¼šstr æˆ–è€… list ç±»å‹ï¼Œç”¨äº ChatCompletion èŠå¤©çš„ç³»ç»Ÿæ¶ˆæ¯ï¼Œä»…å½“ llm_config ä¸ä¸º False æ—¶ä½¿ç”¨ã€‚</p><p>æœ€åï¼Œæ‰§è¡Œ user agent åˆå§‹åŒ–èŠå¤©ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user_proxy.initiate_chat(</span><br><span class="line">    assistant,   <span class="comment"># æ¥æ”¶æ¶ˆæ¯çš„ agentï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„ assistant agent</span></span><br><span class="line">    message=<span class="string">"""å¸®æˆ‘åˆ†æä¸€ä¸‹è¿‡å»ä¸€ä¸ªæœˆAè‚¡ä¸­è¯æ˜åº·å¾·è¿™åªè‚¡ç¥¨çš„å˜åŒ–æƒ…å†µ"""</span>,   <span class="comment"># ä¼ é€’çš„æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å®ƒçš„è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">[user_proxy[0m (to assistant):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¸®æˆ‘åˆ†æä¸€ä¸‹è¿‡å»ä¸€ä¸ªæœˆAè‚¡ä¸­è¯æ˜åº·å¾·è¿™åªè‚¡ç¥¨çš„å˜åŒ–æƒ…å†µ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[assistant[0m (to user_proxy):</span><br><span class="line"></span><br><span class="line">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä»ç½‘ç»œä¸Šè·å–è‚¡ç¥¨æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Pythonçš„pandas_datareaderåº“æ¥è·å–è¿™äº›æ•°æ®ã€‚ä»¥ä¸‹æ˜¯è·å–è¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·ï¼ˆè‚¡ç¥¨ä»£ç ï¼š603259.SHï¼‰è‚¡ç¥¨æ•°æ®çš„ä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line"># filename: stock_analysis.py</span><br><span class="line"></span><br><span class="line">import pandas_datareader as pdr</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line"># Define the stock to be analyzed</span><br><span class="line">stock_code &#x3D; &#39;603259.SS&#39;</span><br><span class="line"></span><br><span class="line"># Define the time period</span><br><span class="line">end_date &#x3D; datetime.datetime.now()</span><br><span class="line">start_date &#x3D; end_date - datetime.timedelta(days&#x3D;30)</span><br><span class="line"></span><br><span class="line"># Get the stock data</span><br><span class="line">stock_data &#x3D; pdr.get_data_yahoo(stock_code, start_date, end_date)</span><br><span class="line"></span><br><span class="line"># Print the stock data</span><br><span class="line">print(stock_data)</span><br><span class="line">&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">è¯·è¿è¡Œè¿™æ®µä»£ç ï¼Œå®ƒå°†è¾“å‡ºè¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·çš„è‚¡ç¥¨æ•°æ®ï¼ŒåŒ…æ‹¬æ¯å¤©çš„å¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·å’Œæˆäº¤é‡ã€‚</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[31m</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING CODE BLOCK 0 (inferred language is python)...[0m</span><br><span class="line">[33muser_proxy[0m (to assistant):</span><br><span class="line"></span><br><span class="line">exitcode: 1 (execution failed)</span><br><span class="line">Code output: </span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;stock_analysis.py&quot;, line 14, in &lt;module&gt;</span><br><span class="line">    stock_data &#x3D; pdr.get_data_yahoo(stock_code, start_date, end_date)</span><br><span class="line">                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File &quot;&#x2F;Users&#x2F;zanwang&#x2F;dev&#x2F;AutoGenproject&#x2F;pyautogen&#x2F;lib&#x2F;python3.11&#x2F;site-packages&#x2F;pandas_datareader&#x2F;data.py&quot;, line 80, in get_data_yahoo</span><br><span class="line">    return YahooDailyReader(*args, **kwargs).read()</span><br><span class="line">           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File &quot;&#x2F;Users&#x2F;zanwang&#x2F;dev&#x2F;AutoGenproject&#x2F;pyautogen&#x2F;lib&#x2F;python3.11&#x2F;site-packages&#x2F;pandas_datareader&#x2F;base.py&quot;, line 253, in read</span><br><span class="line">    df &#x3D; self._read_one_data(self.url, params&#x3D;self._get_params(self.symbols))</span><br><span class="line">         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File &quot;&#x2F;Users&#x2F;zanwang&#x2F;dev&#x2F;AutoGenproject&#x2F;pyautogen&#x2F;lib&#x2F;python3.11&#x2F;site-packages&#x2F;pandas_datareader&#x2F;yahoo&#x2F;daily.py&quot;, line 153, in _read_one_data</span><br><span class="line">    data &#x3D; j[&quot;context&quot;][&quot;dispatcher&quot;][&quot;stores&quot;][&quot;HistoricalPriceStore&quot;]</span><br><span class="line">           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">TypeError: string indices must be integers, not &#39;str&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[33massistant[0m (to user_proxy):</span><br><span class="line"></span><br><span class="line">çœ‹èµ·æ¥æˆ‘ä»¬åœ¨è·å–Yahooè´¢ç»æ•°æ®æ—¶é‡åˆ°äº†é—®é¢˜ã€‚è¿™å¯èƒ½æ˜¯ç”±äºYahooè´¢ç»çš„APIå‘ç”Ÿäº†å˜åŒ–æˆ–è€…æ˜¯ç”±äºç½‘ç»œé—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨å¦ä¸€ä¸ªåº“ï¼Œå¦‚yfinanceï¼Œå®ƒä¸“é—¨ç”¨äºä»Yahooè´¢ç»è·å–æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">ä»¥ä¸‹æ˜¯ä½¿ç”¨yfinanceåº“è·å–è¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·ï¼ˆè‚¡ç¥¨ä»£ç ï¼š603259.SSï¼‰è‚¡ç¥¨æ•°æ®çš„ä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line"># filename: stock_analysis.py</span><br><span class="line"></span><br><span class="line">import yfinance as yf</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line"># Define the stock to be analyzed</span><br><span class="line">stock_code &#x3D; &#39;603259.SS&#39;</span><br><span class="line"></span><br><span class="line"># Define the time period</span><br><span class="line">end_date &#x3D; datetime.datetime.now()</span><br><span class="line">start_date &#x3D; end_date - datetime.timedelta(days&#x3D;30)</span><br><span class="line"></span><br><span class="line"># Get the stock data</span><br><span class="line">stock_data &#x3D; yf.download(stock_code, start_date, end_date)</span><br><span class="line"></span><br><span class="line"># Print the stock data</span><br><span class="line">print(stock_data)</span><br><span class="line">&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">è¯·è¿è¡Œè¿™æ®µä»£ç ï¼Œå®ƒå°†è¾“å‡ºè¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·çš„è‚¡ç¥¨æ•°æ®ï¼ŒåŒ…æ‹¬æ¯å¤©çš„å¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·å’Œæˆäº¤é‡ã€‚</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[31m</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING CODE BLOCK 0 (inferred language is python)...[0m</span><br><span class="line">[33muser_proxy[0m (to assistant):</span><br><span class="line"></span><br><span class="line">exitcode: 0 (execution succeeded)</span><br><span class="line">Code output: </span><br><span class="line">                 Open       High        Low      Close  Adj Close     Volume</span><br><span class="line">Date                                                                        </span><br><span class="line">2024-01-29  63.000000  63.980000  59.360001  59.360001  59.360001  106097922</span><br><span class="line">2024-01-30  56.400002  58.599998  56.180000  56.849998  56.849998   87396491</span><br><span class="line">2024-01-31  56.000000  56.549999  53.900002  54.200001  54.200001   65697194</span><br><span class="line">2024-02-01  54.560001  56.939999  53.730000  55.799999  55.799999   58337298</span><br><span class="line">2024-02-02  56.910000  57.430000  50.220001  50.220001  50.220001   65707485</span><br><span class="line">2024-02-05  46.279999  51.730000  45.200001  48.230000  48.230000  159302508</span><br><span class="line">2024-02-06  46.860001  52.810001  45.369999  52.250000  52.250000  113259142</span><br><span class="line">2024-02-07  53.610001  56.380001  53.610001  55.250000  55.250000  111295644</span><br><span class="line">2024-02-08  53.650002  54.500000  52.000000  53.119999  53.119999   99007432</span><br><span class="line">2024-02-19  50.500000  51.279999  48.619999  50.049999  50.049999  132806402</span><br><span class="line">2024-02-20  49.849998  51.639999  49.330002  51.570000  51.570000  100319873</span><br><span class="line">2024-02-21  51.000000  55.500000  50.820000  53.740002  53.740002  108874573</span><br><span class="line">2024-02-22  53.090000  54.360001  52.880001  54.110001  54.110001   62886204</span><br><span class="line">2024-02-23  54.040001  54.180000  52.549999  53.580002  53.580002   69410659</span><br><span class="line">2024-02-26  53.840000  55.299999  53.750000  55.000000  55.000000   50604459</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[assistant[0m (to user_proxy):</span><br><span class="line"></span><br><span class="line">æ ¹æ®è¾“å‡ºçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·ï¼ˆè‚¡ç¥¨ä»£ç ï¼š603259.SSï¼‰çš„è‚¡ç¥¨æ¯å¤©çš„å¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·å’Œæˆäº¤é‡ã€‚è¿™äº›æ•°æ®å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£è‚¡ç¥¨çš„å˜åŒ–æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›æ•°æ®è¿›è¡Œä¸€äº›åŸºæœ¬çš„åˆ†æï¼Œä¾‹å¦‚è®¡ç®—å¹³å‡æ”¶ç›˜ä»·ã€æœ€é«˜ä»·å’Œæœ€ä½ä»·ï¼Œä»¥åŠæˆäº¤é‡ã€‚ä»¥ä¸‹æ˜¯è¿›è¡Œè¿™äº›è®¡ç®—çš„ä»£ç ï¼š</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line"># filename: stock_analysis.py</span><br><span class="line"></span><br><span class="line">import yfinance as yf</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line"># Define the stock to be analyzed</span><br><span class="line">stock_code &#x3D; &#39;603259.SS&#39;</span><br><span class="line"></span><br><span class="line"># Define the time period</span><br><span class="line">end_date &#x3D; datetime.datetime.now()</span><br><span class="line">start_date &#x3D; end_date - datetime.timedelta(days&#x3D;30)</span><br><span class="line"></span><br><span class="line"># Get the stock data</span><br><span class="line">stock_data &#x3D; yf.download(stock_code, start_date, end_date)</span><br><span class="line"></span><br><span class="line"># Calculate the average close price</span><br><span class="line">average_close &#x3D; stock_data[&#39;Close&#39;].mean()</span><br><span class="line"></span><br><span class="line"># Calculate the highest price</span><br><span class="line">highest_price &#x3D; stock_data[&#39;High&#39;].max()</span><br><span class="line"></span><br><span class="line"># Calculate the lowest price</span><br><span class="line">lowest_price &#x3D; stock_data[&#39;Low&#39;].min()</span><br><span class="line"></span><br><span class="line"># Calculate the average volume</span><br><span class="line">average_volume &#x3D; stock_data[&#39;Volume&#39;].mean()</span><br><span class="line"></span><br><span class="line"># Print the results</span><br><span class="line">print(f&#39;Average close price: &#123;average_close&#125;&#39;)</span><br><span class="line">print(f&#39;Highest price: &#123;highest_price&#125;&#39;)</span><br><span class="line">print(f&#39;Lowest price: &#123;lowest_price&#125;&#39;)</span><br><span class="line">print(f&#39;Average volume: &#123;average_volume&#125;&#39;)</span><br><span class="line">&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">è¯·è¿è¡Œè¿™æ®µä»£ç ï¼Œå®ƒå°†è¾“å‡ºè¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·çš„å¹³å‡æ”¶ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·å’Œå¹³å‡æˆäº¤é‡ã€‚</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[31m</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING CODE BLOCK 0 (inferred language is python)...[0m</span><br><span class="line">[33muser_proxy[0m (to assistant):</span><br><span class="line"></span><br><span class="line">exitcode: 0 (execution succeeded)</span><br><span class="line">Code output: </span><br><span class="line">Average close price: 53.55533345540365</span><br><span class="line">Highest price: 63.97999954223633</span><br><span class="line">Lowest price: 45.20000076293945</span><br><span class="line">Average volume: 92733552.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[assistant[0m (to user_proxy):</span><br><span class="line"></span><br><span class="line">æ ¹æ®è¾“å‡ºçš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹åˆ†æï¼š</span><br><span class="line"></span><br><span class="line">- è¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·çš„å¹³å‡æ”¶ç›˜ä»·ä¸º53.56å…ƒã€‚</span><br><span class="line">- è¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·çš„æœ€é«˜ä»·ä¸º63.98å…ƒã€‚</span><br><span class="line">- è¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·çš„æœ€ä½ä»·ä¸º45.20å…ƒã€‚</span><br><span class="line">- è¿‡å»ä¸€ä¸ªæœˆè¯æ˜åº·å¾·çš„å¹³å‡æˆäº¤é‡ä¸º92733552.4è‚¡ã€‚</span><br><span class="line"></span><br><span class="line">è¿™äº›æ•°æ®å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£è¯æ˜åº·å¾·åœ¨è¿‡å»ä¸€ä¸ªæœˆçš„è‚¡ç¥¨è¡¨ç°ã€‚ç„¶è€Œï¼Œè¿™åªæ˜¯åŸºæœ¬çš„åˆ†æï¼Œå¦‚æœéœ€è¦æ›´æ·±å…¥çš„åˆ†æï¼Œå¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„å› ç´ ï¼Œå¦‚å¸‚åœºç¯å¢ƒã€å…¬å¸åŸºæœ¬é¢ã€è¡Œä¸šåŠ¨æ€ç­‰ã€‚</span><br><span class="line"></span><br><span class="line">TERMINATE</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œassistant agent ç¼–å†™äº†æ•°æ®æŠ“å–ä»£ç å’Œæ•°æ®åˆ†æä»£ç å¹¶æ‰§è¡Œäº†å®ƒä»¬ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†é‡åˆ°çš„é”™è¯¯ï¼Œè¿˜æ˜¯éå¸¸å¼ºå¤§çš„ã€‚è¿™ä¸ªé—®é¢˜å¦‚æœç›´æ¥é—® ChatGPTï¼Œå®ƒæ˜¯ä¸ä¼šç›´æ¥ç»™å‡ºç­”æ¡ˆçš„ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ AutoGen å°±å¯ä»¥è·å–ç­”æ¡ˆï¼Œç”¨æ¥è·å–å’Œåˆ†æå®æ—¶æ•°æ®æ˜¯éå¸¸ä¸é”™çš„ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ª chat groupï¼Œè¿™ä¸ª chat group ä¸­å¯ä»¥æœ‰å¤šä¸ª assistant agentï¼Œæ¯ä¸ª assistant agent å¯ä»¥æœ‰ä¸åŒçš„åŠŸèƒ½ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">user_proxy = autogen.UserProxyAgent(</span><br><span class="line">    name=<span class="string">"User_proxy"</span>,</span><br><span class="line">    system_message=<span class="string">"A human admin."</span>,</span><br><span class="line">    code_execution_config=&#123;</span><br><span class="line">        <span class="string">"last_n_messages"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">"work_dir"</span>: <span class="string">"groupchat"</span>,</span><br><span class="line">        <span class="string">"use_docker"</span>: <span class="literal">False</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    human_input_mode=<span class="string">"TERMINATE"</span>,</span><br><span class="line">)</span><br><span class="line">coder = autogen.AssistantAgent(</span><br><span class="line">    name=<span class="string">"Coder"</span>,</span><br><span class="line">    llm_config=llm_config,</span><br><span class="line">)</span><br><span class="line">pm = autogen.AssistantAgent(</span><br><span class="line">    name=<span class="string">"Product_manager"</span>,</span><br><span class="line">    system_message=<span class="string">"Creative in software product ideas."</span>,</span><br><span class="line">    llm_config=llm_config,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªèŠå¤©ç»„</span></span><br><span class="line">groupchat = autogen.GroupChat(agents=[user_proxy, coder, pm], messages=[], max_round=<span class="number">12</span>)</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜</span></span><br><span class="line">manager = autogen.GroupChatManager(groupchat=groupchat, llm_config=llm_config)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹èŠå¤©</span></span><br><span class="line">user_proxy.initiate_chat(</span><br><span class="line">    manager, message=<span class="string">"Find a latest paper about gpt-4 on arxiv and find its potential applications in software."</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å…³äº AutoGen ä½¿ç”¨çš„æ›´å¤šä¾‹å­ï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://microsoft.github.io/autogen/docs/Examples" target="_blank" rel="noopener">https://microsoft.github.io/autogen/docs/Examples</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;AutoGen æ˜¯ç”±å¾®è½¯ã€å®¾å¤•æ³•å°¼äºšå·ç«‹å¤§å­¦å’Œåç››é¡¿å¤§å­¦åˆä½œå¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒæ”¯æŒä½¿ç”¨å¤šä¸ªä»£ç†æ¥å¼€å‘ LLM åº”ç”¨ç¨‹åºï¼Œè¿™äº›ä»£ç†å¯ä»¥ç›¸äº’å¯¹è¯æ¥å®Œæˆä»»åŠ¡ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Ollamaçš„ä»‹ç»å’Œä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2024/02/25/Ollama%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2024/02/25/Ollama%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/</id>
    <published>2024-02-25T02:32:44.000Z</published>
    <updated>2024-02-25T03:03:05.940Z</updated>
    
    <content type="html"><![CDATA[<p>Ollamaæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬åœ¨æœ¬åœ°æ­å»ºå’Œè¿è¡ŒLlama2ã€Mistralã€Gemmaç­‰å¼€æºLLMæœåŠ¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ„å»ºè‡ªå·±çš„ LLM åº”ç”¨ã€‚</p><p>ä»Šå¤©ä»‹ç»ä¸‹å®ƒçš„ä½¿ç”¨ã€‚</p><a id="more"></a><h1 id="Ollamaçš„å®‰è£…"><a href="#Ollamaçš„å®‰è£…" class="headerlink" title="Ollamaçš„å®‰è£…"></a>Ollamaçš„å®‰è£…</h1><p>Linuxç¯å¢ƒä¸‹ï¼ŒOllamaçš„å®‰è£…æ–¹å¼ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https:&#x2F;&#x2F;ollama.com&#x2F;install.sh | sh</span><br></pre></td></tr></table></figure><p>Macç¯å¢ƒä¸‹ï¼Œå»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…è¿›è¡Œå®‰è£…ï¼Œä¸‹è½½åœ°å€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;ollama.com&#x2F;download&#x2F;mac</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ ollama å‘½ä»¤æŸ¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  ollama [flags]</span><br><span class="line">  ollama [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  serve       Start ollama</span><br><span class="line">  create      Create a model from a Modelfile</span><br><span class="line">  show        Show information for a model</span><br><span class="line">  run         Run a model</span><br><span class="line">  pull        Pull a model from a registry</span><br><span class="line">  push        Push a model to a registry</span><br><span class="line">  list        List models</span><br><span class="line">  cp          Copy a model</span><br><span class="line">  rm          Remove a model</span><br><span class="line">  help        Help about any command</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -h, --help      help for ollama</span><br><span class="line">  -v, --version   Show version information</span><br><span class="line"></span><br><span class="line">Use &quot;ollama [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure><h1 id="Ollamaçš„ä½¿ç”¨"><a href="#Ollamaçš„ä½¿ç”¨" class="headerlink" title="Ollamaçš„ä½¿ç”¨"></a>Ollamaçš„ä½¿ç”¨</h1><p>é€šè¿‡æŸ¥çœ‹ Ollama çš„å‘½ä»¤ï¼Œå¯ä»¥å‘ç°å®ƒå¾ˆåƒ Dockerã€‚</p><p>éœ€è¦æ‹‰å–æ¨¡å‹åˆ°æœ¬åœ°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ollama pull å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ollama pull gemma</span><br><span class="line">ollama pull llama2</span><br><span class="line">ollama pull mistral</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æœ¬åœ°å·²å­˜åœ¨çš„æ¨¡å‹æ—¶ï¼Œå¯ä»¥è¿è¡Œï¼šollama list</p><p>åœ¨æœ¬åœ°è¿è¡Œä¸€ä¸ªæ¨¡å‹æ—¶ï¼Œå¯ä»¥æ‰§è¡Œï¼šollama run gemma</p><p>è¿è¡Œæ¨¡å‹åï¼Œä¼šå‡ºç°è¿™æ ·çš„å¯¹è¯ç•Œé¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">zanwang@zan ~ % ollama run gemma</span><br><span class="line">&gt;&gt;&gt; hello</span><br><span class="line">Hello, hello! ğŸ‘‹</span><br><span class="line">It&#39;s nice to hear from you. What would you like to talk about today?</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; who are you</span><br><span class="line">I am an AI language model, designed to provide you with information and </span><br><span class="line">engage in conversation on various topics. I am still under development, </span><br><span class="line">but I am constantly learning new things.</span><br><span class="line">Would you like me to tell you more about myself or would you like to ask </span><br><span class="line">me a question?</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¾“å…¥é—®é¢˜ï¼Œç„¶åç­‰å¾…æ¨¡å‹çš„å›ç­”ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ ollama create å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ª LLM.</p><p>é¦–å…ˆè¦ç¼–å†™ä¸€ä¸ª Modefile æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM qwen</span><br><span class="line"></span><br><span class="line"># set the temperature to 1 [higher is more creative, lower is more coherent]</span><br><span class="line">PARAMETER temperature 1</span><br><span class="line">PARAMETER max_tokens 10</span><br><span class="line"></span><br><span class="line"># set the system message</span><br><span class="line">SYSTEM &quot;&quot;&quot;</span><br><span class="line">You are Tracy, a execllent teacher. Answer as Tracy, the assistant, only.</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸Šé¢åŸºäºé€šä¹‰åƒé—®qwenæ¨¡å‹åˆ›å»ºäº†ä¸€ä¸ªLLMï¼Œè®¾ç½®å®ƒçš„ temperature ä¸º1ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¯¥æ¨¡å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama create tracy(æ¨¡å‹åç§°) -f .&#x2F;Modefile</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ ollama list æŸ¥çœ‹æ¨¡å‹åˆ—è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">zanwang@zan ollamaproject % ollama list</span><br><span class="line">NAME                 ID          SIZE  MODIFIED      </span><br><span class="line">codellama:latest     8fdf8f752f6e3.8 GB47 hours ago </span><br><span class="line">gemma:latest         430ed35350495.2 GB47 hours ago </span><br><span class="line">llama2:latest        78e26419b4463.8 GB2 days ago   </span><br><span class="line">llama2-chinese:latestcee11d703eee3.8 GB47 hours ago </span><br><span class="line">mistral:latest       61e88e8845074.1 GB47 hours ago </span><br><span class="line">qwen:latest          d53d042900642.3 GB46 hours ago </span><br><span class="line">tracy:latest         e941b7cd9ad82.3 GB9 seconds ago</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒäº†ï¼šollama run tracy</p><h1 id="Ollama-APIçš„ä½¿ç”¨"><a href="#Ollama-APIçš„ä½¿ç”¨" class="headerlink" title="Ollama APIçš„ä½¿ç”¨"></a>Ollama APIçš„ä½¿ç”¨</h1><p>é™¤äº†ç›´æ¥èŠå¤©ï¼Œollama è¿˜æä¾›äº† REST API ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åƒè°ƒç”¨ OpenAI æ¥å£é‚£æ ·è°ƒç”¨ ollama çš„æ¥å£ã€‚å¯åŠ¨ ollama æœåŠ¡ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨æ¥å£è·å– LLM çš„å“åº”ï¼Œ</p><p>æˆ‘ä»¬å¯ä»¥è°ƒç”¨èŠå¤©æ¥å£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zanwang@zan blog % curl http:&#x2F;&#x2F;localhost:11434&#x2F;api&#x2F;chat -d &#39;&#123;</span><br><span class="line">  &quot;model&quot;: &quot;qwen&quot;,</span><br><span class="line">  &quot;messages&quot;: [</span><br><span class="line">    &#123; &quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ å¥½ï¼Œä½ æ˜¯è°ï¼Ÿ&quot; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure><p>api/chat æ¥å£å¯ä»¥ä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model: æ¨¡å‹åç§°</span><br><span class="line">messages: æ¶ˆæ¯å†…å®¹</span><br><span class="line">format: å“åº”æ•°æ®çš„æ ¼å¼ï¼Œé»˜è®¤æ˜¯json</span><br><span class="line">template: promptçš„æ¨¡æ¿</span><br><span class="line">stream: æ˜¯å¦æµå¼è¾“å‡º, é»˜è®¤true</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è°ƒç”¨ generate æ¥å£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;localhost:11434&#x2F;api&#x2F;generate -d &#39;&#123;</span><br><span class="line">  &quot;model&quot;: &quot;llama2-chinese&quot;,</span><br><span class="line">  &quot;prompt&quot;:&quot;ä½ å¥½ï¼Œä½ æ˜¯è°&quot;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure><p>ollama rest apiæ–‡æ¡£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;ollama&#x2F;ollama&#x2F;blob&#x2F;main&#x2F;docs&#x2F;api.md</span><br></pre></td></tr></table></figure><h1 id="Ollama-UIçš„ä½¿ç”¨"><a href="#Ollama-UIçš„ä½¿ç”¨" class="headerlink" title="Ollama UIçš„ä½¿ç”¨"></a>Ollama UIçš„ä½¿ç”¨</h1><p>ä½¿ç”¨ Ollama åˆ›å»ºå¥½æ¨¡å‹åï¼Œæˆ‘ä»¬ç¦»åˆ›å»ºä¸€ä¸ªèŠå¤©åº”ç”¨å°±å·®webç•Œé¢äº†ï¼Œä¸‹é¢æ˜¯å‡ ä¸ªåŸºäº ollama çš„chat uiï¼Œæœ‰è¯·å…´è¶£çš„åŒå­¦å¯ä»¥è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chatbot ollamaï¼šhttps:&#x2F;&#x2F;github.com&#x2F;ivanfioravanti&#x2F;chatbot-ollama</span><br><span class="line">open webuiï¼šhttps:&#x2F;&#x2F;github.com&#x2F;open-webui&#x2F;open-webui</span><br><span class="line">ollama uiï¼šhttps:&#x2F;&#x2F;github.com&#x2F;ollama-webui&#x2F;ollama-webui-lite</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š</p><p>Ollamaå®˜ç½‘ï¼š<a href="https://ollama.com/" target="_blank" rel="noopener">https://ollama.com/</a></p><p>Ollama Githubï¼š<a href="https://github.com/ollama/ollama" target="_blank" rel="noopener">https://github.com/ollama/ollama</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Ollamaæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬åœ¨æœ¬åœ°æ­å»ºå’Œè¿è¡ŒLlama2ã€Mistralã€Gemmaç­‰å¼€æºLLMæœåŠ¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ„å»ºè‡ªå·±çš„ LLM åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©ä»‹ç»ä¸‹å®ƒçš„ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>LangChainçš„åŸºæœ¬ä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2024/02/22/LangChain%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2024/02/22/LangChain%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</id>
    <published>2024-02-22T03:46:53.000Z</published>
    <updated>2024-02-22T03:49:53.247Z</updated>
    
    <content type="html"><![CDATA[<p>LangChain æ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œå®ƒçš„å‡ºç°æ˜¯ä¸ºäº†ç®€åŒ–å’ŒåŠ é€Ÿå¤§è¯­è¨€æ¨¡å‹ç›¸å…³åº”ç”¨çš„å¼€å‘ï¼Œæ¯”å¦‚å¼€å‘åŸºäºOpenAIçš„åº”ç”¨ï¼Œå¼€å‘åŸºäºç™¾åº¦åƒå¸†å¤§æ¨¡å‹çš„åº”ç”¨ã€‚</p><a id="more"></a><p>é‚£ä½ å¯èƒ½ä¼šè¯´ï¼Œå¹³æ—¶æˆ‘ä»¬å¼€å‘åŸºäºå¤§æ¨¡å‹çš„åº”ç”¨æˆ–è€…åŠŸèƒ½æ—¶ï¼Œæ¯”å¦‚å¼€å‘åŸºäºOpenAIçš„çš„åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç›´æ¥è°ƒç”¨OpenAIçš„chatæ¥å£æˆ–è€…assistantsæ¥å£ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨LangChainæ¡†æ¶å’Œå®ƒçš„æ¥å£ã€‚æ˜¯çš„ï¼Œå¹³æ—¶æˆ‘ä»¬å¼€å‘æ—¶ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ç›¸åº”å¤§æ¨¡å‹çš„æ¥å£ï¼Œä½†å½“æˆ‘ä»¬è€ƒè™‘åˆ°æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ï¼Œä½¿ç”¨LangChainæ˜¯ä¸€ä¸ªæ›´å¥½åœ°é€‰æ‹©ï¼Œå¹¶ä¸”LangChainä¸­è¿˜æ•´åˆäº†å¾ˆå¤šç»„ä»¶å’ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼šæ”¯æŒå¤šç§å¤§è¯­è¨€æ¨¡å‹ã€æ”¯æŒå¤šç§æ•°æ®æºè¿æ¥ã€æ”¯æŒæ–‡æœ¬å¤„ç†æ•°æ®åˆ†æagentã€æä¾›éƒ¨ç½²å’Œè¿ç»´å·¥å…·ç­‰ã€‚</p><p>ä¸‹é¢åŸºäºPythonå’ŒOpenAIä»‹ç»ä¸‹LangChainçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ã€‚</p><p>å®‰è£…LangChainï¼špip install langchain</p><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤åï¼Œä¼šå®‰è£…langchainã€langchain-communityã€langchain-coreç­‰langchainç›¸å…³çš„åŒ…ã€‚</p><p>å®‰è£…openaiï¼špip install openai</p><h1 id="åˆ›å»ºä¸€ä¸ªllm"><a href="#åˆ›å»ºä¸€ä¸ªllm" class="headerlink" title="åˆ›å»ºä¸€ä¸ªllm"></a>åˆ›å»ºä¸€ä¸ªllm</h1><p>å®‰è£…å¥½åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨LangChainå°±è¡Œå¼€å‘äº†ï¼Œå…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.llms <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(prompt=<span class="string">''</span>)</span>:</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªåŸºäºOpenAIçš„llmæ¨¡å—</span></span><br><span class="line">    llm = OpenAI(openai_api_key=OPENAI_API_KEY, temperature=<span class="number">1</span>, max_tokens=<span class="number">10</span>, model_name=<span class="string">'gpt-3.5-turbo-instruct'</span>)</span><br><span class="line">    <span class="comment"># è°ƒç”¨æ¨¡å—çš„æ–¹æ³•è¿›è¡Œæé—®</span></span><br><span class="line">    resp = llm.predict(prompt)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    prompt = <span class="string">'ä½ æ˜¯è°ï¼Ÿ'</span></span><br><span class="line">    resp = call(prompt)</span><br><span class="line">    print(resp)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ OpenAI åˆ›å»ºäº†ä¸€ä¸ª llm å¯¹è±¡ï¼Œåˆ›å»º llm å¯¹è±¡æ—¶ä¼ å…¥çš„å‚æ•°å’Œç›´æ¥è°ƒç”¨ OpneAI Chat æ¥å£æ—¶ä¼ å…¥çš„å‚æ•°å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œå…·ä½“æœ‰å“ªäº›å‚æ•°ï¼Œå¯ä»¥æŸ¥çœ‹Pythonæºç æˆ–è€… LangChain æ–‡æ¡£ã€‚</p><p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ langchain-openai åº“æ¥å®ç°ã€‚</p><p>é¦–å…ˆå®‰è£… langchain-openaiï¼špip install langchain-openai</p><p>å®‰è£…å¥½åï¼Œä½¿ç”¨ langchain-openai å¼€å‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(prompt=<span class="string">''</span>)</span>:</span></span><br><span class="line">    llm = OpenAI(openai_api_key=OPENAI_API_KEY, temperature=<span class="number">1</span>)</span><br><span class="line">    resp = llm.predict(prompt)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    prompt = <span class="string">'ä½ æ˜¯è°ï¼Ÿ'</span></span><br><span class="line">    resp = call(prompt)</span><br><span class="line">    print(resp)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ langchain.llms çš„ OpenAI å’Œ langchain_openai çš„ OpenAI è¾“å‡ºçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ä¸ªç±»æœ€ç»ˆéƒ½æ˜¯ç»§æ‰¿çš„ BaseLLM ç±»ã€‚</p><h1 id="åˆ›å»ºä¸€ä¸ªchat-llm"><a href="#åˆ›å»ºä¸€ä¸ªchat-llm" class="headerlink" title="åˆ›å»ºä¸€ä¸ªchat llm"></a>åˆ›å»ºä¸€ä¸ªchat llm</h1><p>åœ¨ langchain ä¸­ï¼Œchatæ¶ˆæ¯æœ‰å››ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼šAIMessage, HumanMessage, SystemMessageã€ChatMessageï¼Œ</p><p>å…¶ä¸­ï¼ŒAIMessageæ˜¯ llm çš„æ¶ˆæ¯ï¼ŒHumanMessageæ˜¯ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯ï¼ŒSystemMessageæ˜¯ç³»ç»Ÿçš„æ¶ˆæ¯ï¼ŒChatMessageæ˜¯è‡ªå®šä¹‰çš„æ¶ˆæ¯ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ langchain.chat_models ä¸­çš„ ChatOpenAI åˆ›å»ºä¸€ä¸ª chat llmï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chat_models <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(prompt=<span class="string">''</span>)</span>:</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªåŸºäºChat OpenAIçš„llmæ¨¡å—</span></span><br><span class="line">    llm = ChatOpenAI(openai_api_key=OPENAI_API_KEY, temperature=<span class="number">1</span>)</span><br><span class="line">    resp = llm.predict(prompt)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    prompt = <span class="string">'ä»Šå¤©æ™šé¥­åƒä»€ä¹ˆ'</span></span><br><span class="line">    resp = call(prompt)</span><br><span class="line">    print(resp)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„ langchain.chat_models æ›¿æ¢æˆ langchain_openaiï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><p>åˆ›å»ºchat llmåï¼Œé™¤äº†ç®€å•çš„è°ƒç”¨ predict() èŠå¤©ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ HumanMessageã€SystemMessage è¿›è¡ŒèŠå¤©ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chat_models <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> HumanMessage, SystemMessage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(prompt=<span class="string">''</span>)</span>:</span></span><br><span class="line">    llm = ChatOpenAI(openai_api_key=OPENAI_API_KEY, temperature=<span class="number">1</span>)</span><br><span class="line">    system_msg = <span class="string">'ä½ æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç»éªŒçš„é«˜çº§å¨å¸ˆï¼Œè¯·å¸®æˆ‘æ¨èæœ‰ç›Šå¥åº·çš„èœè°±ï¼'</span></span><br><span class="line"></span><br><span class="line">    messages = [SystemMessage(content=system_msg), HumanMessage(content=prompt)]</span><br><span class="line">    resp = llm.predict_messages(messages)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    prompt = <span class="string">'ä»Šå¤©æ™šé¥­åƒä»€ä¹ˆ'</span></span><br><span class="line">    resp = call(prompt)</span><br><span class="line">    print(resp)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ generate() æ–¹æ³•è¿›è¡Œå¤šç»„chatï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chat_models <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> HumanMessage, SystemMessage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(prompt1=<span class="string">''</span>, prompt2=<span class="string">''</span>)</span>:</span></span><br><span class="line">    llm = ChatOpenAI(openai_api_key=OPENAI_API_KEY, temperature=<span class="number">1</span>)</span><br><span class="line">    system_msg1 = <span class="string">'ä½ æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç»éªŒçš„é«˜çº§å¨å¸ˆï¼Œè½»è½»å¸®æˆ‘æ¨èæœ‰ç›Šå¥åº·çš„èœè°±ï¼'</span></span><br><span class="line">    system_msg2 = <span class="string">'ä½ æ˜¯ä¸€ä¸ªèµ„æ·±è®­ç»ƒå¸ˆï¼Œè¯·ç»™å‡ºå¦‚ä½•ä¿æŒèº«æçš„å»ºè®®ï¼'</span></span><br><span class="line"></span><br><span class="line">    batch_messages = [</span><br><span class="line">        [</span><br><span class="line">            SystemMessage(content=system_msg1),</span><br><span class="line">            HumanMessage(content=prompt1)</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">            SystemMessage(content=system_msg2),</span><br><span class="line">            HumanMessage(content=prompt2)</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">    resp = llm.generate(batch_messages)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    prompt1 = <span class="string">'ä»Šå¤©æ™šé¥­åƒä»€ä¹ˆ'</span></span><br><span class="line">    prompt2 = <span class="string">'ä»Šå¤©æœ‰ä»€ä¹ˆé”»ç‚¼è®¡åˆ’'</span></span><br><span class="line">    resp = call(prompt1, prompt2)</span><br><span class="line">    print(resp.generations[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">"==================="</span>)</span><br><span class="line">    print(resp.generations[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨promptæ¨¡æ¿"><a href="#ä½¿ç”¨promptæ¨¡æ¿" class="headerlink" title="ä½¿ç”¨promptæ¨¡æ¿"></a>ä½¿ç”¨promptæ¨¡æ¿</h1><p>ä¸Šé¢çš„å‡ ä¸ªä¾‹å­ä¸­ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„å›ºå®šçš„promptï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ›´åŠ çµæ´»çš„ä½¿ç”¨promptï¼Œå¯ä»¥ä½¿ç”¨promptæ¨¡æ¿ï¼Œçœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.llms <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(who)</span>:</span></span><br><span class="line">    llm = OpenAI(openai_api_key=OPENAI_API_KEY, temperature=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªpromptæ¨¡æ¿</span></span><br><span class="line">    prompt = PromptTemplate.from_template(<span class="string">"å¦‚æœ&#123;who&#125;ç”Ÿæ°”äº†ï¼Œæˆ‘è¯¥æ€ä¹ˆå“„å¥¹ï¼Ÿ"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªllm chainå¯¹è±¡</span></span><br><span class="line">    chain = LLMChain(llm=llm, prompt=prompt)</span><br><span class="line">    <span class="comment"># è¿è¡Œchainæ—¶ï¼Œå°†promptæ¨¡æ¿çš„å‚æ•°ä¼ å…¥</span></span><br><span class="line">    resp = chain.run(who=who)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    resp = call(<span class="string">"å¥³æœ‹å‹"</span>)</span><br><span class="line">    print(resp)</span><br><span class="line">    print(<span class="string">"========================="</span>)</span><br><span class="line">    resp = call(<span class="string">"å°çŒ«"</span>)</span><br><span class="line">    print(resp)</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­ä½¿ç”¨ PromptTemplate åˆ›å»ºäº†ä¸€ä¸ª prompt æ¨¡æ¿ï¼Œé€šè¿‡ä½¿ç”¨ LLMChain æ¨¡å—ï¼Œå°† prompt å’Œ llm ä¸²è”èµ·æ¥ï¼Œæœ€åæ‰§è¡Œå¹¶è·å–ç»“æœã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°äº† LangChainä¸­çš„ chain æ¨¡å—ï¼šLLMChainã€‚chainæ˜¯ LangChain ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†çŸ¥è¯†ï¼Œé€šè¿‡ä½¿ç”¨ chainï¼Œæˆ‘ä»¬å°†ä»¥æ¨¡å—åŒ–çš„æ–¹å¼è°ƒç”¨å¤§æ¨¡å‹ï¼Œå³æŠŠ prompt åˆ†æˆä¸€ä¸ªæ¨¡å—ï¼Œè°ƒç”¨ llm åˆ†æˆä¸€ä¸ªæ¨¡å—ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—ä¹‹é—´äº’ä¸å½±å“ï¼Œæˆ‘ä»¬ä¿®æ”¹ prompt æ—¶ä¸ä¼šå½±å“ llmï¼Œåˆ‡æ¢ llm æ—¶ä¹Ÿä¸ä¼šå½±å“ promptã€‚chain é€šè¿‡æŠŠè°ƒç”¨å¤§æ¨¡å‹çš„è¿‡ç¨‹åˆ‡åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œé™ä½äº†è¿™å‡ ä¸ªéƒ¨åˆ†ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œæ›´åŠ çµæ´»ï¼Œé™ä½äº†åæœŸæ›´æ–°å’Œä¿®æ”¹çš„æˆæœ¬ã€‚</p><p>LangChainä¸­ä¸åªæœ‰ LLMChainï¼Œè¿˜æœ‰LLMRouterChainã€LLMCheckerChainç­‰ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£äº†è§£æ›´å¤šã€‚</p><h1 id="åˆ›å»ºä¸€ä¸ªConversationChain"><a href="#åˆ›å»ºä¸€ä¸ªConversationChain" class="headerlink" title="åˆ›å»ºä¸€ä¸ªConversationChain"></a>åˆ›å»ºä¸€ä¸ªConversationChain</h1><p>åœ¨ LangChain ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ConversationChain åˆ›å»ºä¸€ä¸ªç”¨äºå¯¹è¯çš„åº”ç”¨ã€‚ä½¿ç”¨ ConversationChain çš„å¥½å¤„åœ¨äºï¼Œå®ƒä¼šç¼“å­˜èŠå¤©è®°å½•çš„ä¸Šä¸‹æ–‡ï¼Œä½¿æˆ‘ä»¬åœ¨å¯¹è¯æ—¶ï¼Œå¤§æ¨¡å‹èƒ½å¤ŸçŸ¥é“ä¹‹å‰çš„èŠå¤©æ•°æ®ï¼Œä»è€Œç»™å‡ºæ›´å¥½åœ°å›ç­”ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.llms <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationChain</span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line">llm = OpenAI(openai_api_key=OPENAI_API_KEY)</span><br><span class="line">conversion = ConversationChain(llm=llm)</span><br><span class="line">conversion.run(<span class="string">"ä½ å¥½å‘€"</span>)</span><br><span class="line">conversion.run(<span class="string">"æˆ‘å«å°æ˜"</span>)</span><br><span class="line">conversion.run(<span class="string">"å¸®æˆ‘å†™ä¸€ä»½ç®€å†"</span>)</span><br><span class="line">conversion.run(<span class="string">"æˆ‘æ˜¯è°"</span>)</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­ä½¿ç”¨äº† ConversationChain ï¼ŒæŸ¥çœ‹æºç ä¼šå‘ç°ï¼ŒConversationChain ä¸­æœ‰ä¸€ä¸ª memory å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†èŠå¤©è®°å½•çš„ç¼“å­˜ä¿¡æ¯ï¼Œä½¿å¤§æ¨¡å‹èƒ½å¤ŸçŸ¥é“ä¹‹å‰å¯¹è¯çš„å†…å®¹ã€‚memory å‚æ•°çš„é»˜è®¤å€¼å°±æ˜¯ ConversationBufferMemoryã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æŸ¥çœ‹ memory ä¸­ç¼“å­˜çš„æ‰€æœ‰å†…å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(conversation.memory.load_memory_variables(&#123;&#125;))</span><br></pre></td></tr></table></figure><p>memory é™¤äº†ä½¿ç”¨ ConversationBufferMemoryä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ ConversationBufferWindowMemoryï¼Œå®ƒå¯ä»¥æŒ‡å®šç¼“å­˜æœ€å n è½®çš„å¯¹è¯å†…å®¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.llms <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationChain</span><br><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferWindowMemory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENAI_API_KEY = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªllmå¯¹è±¡</span></span><br><span class="line">    llm = OpenAI(openai_api_key=OPENAI_API_KEY, temperature=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># åªç¼“å­˜æœ€è¿‘ä¸€è½®çš„å¯¹è¯å†…å®¹</span></span><br><span class="line">    memory = ConversationBufferWindowMemory(k=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªConversationChainå¯¹è±¡</span></span><br><span class="line">    conversation = ConversationChain(llm=llm, memory=memory)</span><br><span class="line">    <span class="comment"># è¿è¡Œconversation chain</span></span><br><span class="line">    resp = conversation.run(<span class="string">"ä½ å¥½å‘€"</span>)</span><br><span class="line">    print(resp)</span><br><span class="line">    print(<span class="string">"==========="</span>)</span><br><span class="line">    resp = conversation.run(<span class="string">"æˆ‘æ˜¯å°æ˜"</span>)</span><br><span class="line">    print(resp)</span><br><span class="line">    print(<span class="string">"==========="</span>)</span><br><span class="line">    resp = conversation.run(<span class="string">"ä½ èƒ½åšä»€ä¹ˆ"</span>)</span><br><span class="line">    print(resp)</span><br><span class="line">    print(<span class="string">"==========="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æŸ¥çœ‹memoryä¸­çš„å†…å®¹</span></span><br><span class="line">    print(conversation.memory.load_memory_variables(&#123;&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    call()</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡ä»‹ç»çš„ LangChain çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ã€‚</p><p>LangChain å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://python.langchain.com/docs/get_started/introduction" target="_blank" rel="noopener">https://python.langchain.com/docs/get_started/introduction</a></p><p>LangChain GitHubä»“åº“ï¼š<a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener">https://github.com/langchain-ai/langchain</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;LangChain æ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œå®ƒçš„å‡ºç°æ˜¯ä¸ºäº†ç®€åŒ–å’ŒåŠ é€Ÿå¤§è¯­è¨€æ¨¡å‹ç›¸å…³åº”ç”¨çš„å¼€å‘ï¼Œæ¯”å¦‚å¼€å‘åŸºäºOpenAIçš„åº”ç”¨ï¼Œå¼€å‘åŸºäºç™¾åº¦åƒå¸†å¤§æ¨¡å‹çš„åº”ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>é€šè¿‡cloudflareçš„tunnelæŠ€æœ¯å®ç°å†…ç½‘ç©¿é€</title>
    <link href="http://wyzane.gitee.io/blog/2024/02/02/%E9%80%9A%E8%BF%87cloudflare%E7%9A%84tunnel%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
    <id>http://wyzane.gitee.io/blog/2024/02/02/%E9%80%9A%E8%BF%87cloudflare%E7%9A%84tunnel%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</id>
    <published>2024-02-02T06:25:31.000Z</published>
    <updated>2024-02-22T03:51:33.862Z</updated>
    
    <content type="html"><![CDATA[<p>cloudflareæ˜¯ä¸€å®¶æä¾›ä¸€ç³»åˆ—é¢å‘ç½‘ç«™ã€åº”ç”¨ç¨‹åºå’ŒAPIçš„äº’è”ç½‘å®‰å…¨æ€§å’Œæ€§èƒ½å¢å¼ºæœåŠ¡çš„å…¬å¸ï¼Œå®ƒæä¾›çš„æœåŠ¡ä¸»è¦åŒ…æ‹¬å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰ã€åˆ†å¸ƒå¼åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰æœåŠ¡ã€é˜²å¾¡åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ï¼ˆDDoSï¼‰æ”»å‡»çš„è§£å†³æ–¹æ¡ˆå’Œå®‰å…¨é˜²æŠ¤æªæ–½ç­‰ã€‚</p><a id="more"></a><p>æˆ‘ä»¬åœ¨cloudflareä¸Šè´­ä¹°åŸŸååï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„ tunnel æŠ€æœ¯å®ç°å†…ç½‘ç©¿é€ï¼Œå°†æˆ‘ä»¬çš„åŸŸåç»‘å®šåˆ°ä¸€ä¸ªæœ¬åœ°æœåŠ¡ä¸Šã€‚</p><p>ä¸‹é¢åˆ†äº«ä¸€ä¸‹æ“ä½œæ­¥éª¤ã€‚</p><p>æ“ä½œæ­¥éª¤ï¼ˆä»¥windowsä¸ºä¾‹ï¼‰ï¼š</p><ol><li><p>å®‰è£… cloudflaredï¼ˆåœ¨å®˜ç½‘æˆ–è€…githubä¸‹è½½å¹¶å®‰è£…ï¼Œ<a href="https://github.com/cloudflare/cloudflared/releasesï¼‰" target="_blank" rel="noopener">https://github.com/cloudflare/cloudflared/releasesï¼‰</a></p></li><li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç™»å½•åˆ°cloudflareè¿›è¡Œæˆæƒ</p><p>cloudflared tunnel login<br>æ‰§è¡Œåä¼šå¼¹å‡ºä¸€ä¸ªé¡µé¢ï¼Œè¿›è¡Œæˆæƒå³å¯ã€‚æˆæƒå®Œæˆåï¼Œä¼šåœ¨ .cloudflare ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª cert.pem æ–‡ä»¶</p></li><li><p>åˆ›å»ºéš§é“ tunnel</p><p>cloudflared tunnel create &lt;éš§é“åå­—&gt;<br>åˆ›å»ºå®Œæˆåï¼Œä¼šåœ¨ .cloudflare ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª uuid.json çš„æ–‡ä»¶</p></li><li><p>æŠŠåŸŸåæŒ‡å‘å¯¹åº”çš„éš§é“</p><p>cloudflared tunnel route dns &lt;éš§é“åå­—&gt; &lt;åŸŸå&gt;<br>å®Œæˆåï¼Œcloudflare ä¼šè‡ªåŠ¨æ·»åŠ ä¸€æ¡ CNAME è®°å½•åˆ°å¯¹åº”çš„åŸŸå</p></li><li><p>é…ç½® cloudflared</p><p>ç¼–è¾‘æ–‡ä»¶ .\cloudflared\config.ymlï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tunnel:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">credentials-file:</span> <span class="string">C:\Users\10579\.cloudflared\e9e54272-7145-485d-af9f-d620558d5c7a.json</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ingress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostname:</span> <span class="string">blog.wangzan.net</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">http://localhost:8080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">service:</span> <span class="string">http_status:404</span></span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œå¯ä»¥æµ‹è¯•ä¸€ä¸‹æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼š</p><p>cloudflared tunnel â€“config .\cloudflared\config.yml ingress validate</p><p>æµ‹è¯•è§„åˆ™æ˜¯å¦å‘½ä¸­ï¼š</p><p>cloufdlared tunnel â€“config .\cloudflared\config.yml ingress rule <a href="http://wangzan.net" target="_blank" rel="noopener">http://wangzan.net</a></p></li><li><p>æµ‹è¯•è¿è¡Œ</p><p>.\cloudflared.exe â€“loglevel debug â€“transport-loglevel warn â€“config C:\Users\wyzane.cloudflared\config.yml tunnel run &lt;éš§é“UUID&gt;</p></li></ol><p>ä»¥ä¸Šå°±æ˜¯é€šè¿‡cloudflareé…ç½®å†…ç½‘ç©¿é€çš„æ­¥éª¤ã€‚</p><p>å‚è€ƒï¼š</p><p><a href="https://blog.cloudflare.com/zh-cn/elevate-load-balancing-with-private-ips-and-cloudflare-tunnels-a-secure-path-to-efficient-traffic-distribution-zh-cn/" target="_blank" rel="noopener">https://blog.cloudflare.com/zh-cn/elevate-load-balancing-with-private-ips-and-cloudflare-tunnels-a-secure-path-to-efficient-traffic-distribution-zh-cn/</a></p><p><a href="https://bra.live/setup-home-server-with-cloudflare-tunnel/" target="_blank" rel="noopener">https://bra.live/setup-home-server-with-cloudflare-tunnel/</a></p><p><a href="https://github.com/anderspitman/awesome-tunneling" target="_blank" rel="noopener">https://github.com/anderspitman/awesome-tunneling</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;cloudflareæ˜¯ä¸€å®¶æä¾›ä¸€ç³»åˆ—é¢å‘ç½‘ç«™ã€åº”ç”¨ç¨‹åºå’ŒAPIçš„äº’è”ç½‘å®‰å…¨æ€§å’Œæ€§èƒ½å¢å¼ºæœåŠ¡çš„å…¬å¸ï¼Œå®ƒæä¾›çš„æœåŠ¡ä¸»è¦åŒ…æ‹¬å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰ã€åˆ†å¸ƒå¼åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰æœåŠ¡ã€é˜²å¾¡åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ï¼ˆDDoSï¼‰æ”»å‡»çš„è§£å†³æ–¹æ¡ˆå’Œå®‰å…¨é˜²æŠ¤æªæ–½ç­‰ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç½‘ç»œ" scheme="http://wyzane.gitee.io/blog/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="ç½‘ç»œ" scheme="http://wyzane.gitee.io/blog/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>LinuxæœåŠ¡å™¨ä¹‹é—´å…å¯†ç™»å½•çš„é…ç½®</title>
    <link href="http://wyzane.gitee.io/blog/2021/09/04/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B9%8B%E9%97%B4%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E7%9A%84%E9%85%8D%E7%BD%AE/"/>
    <id>http://wyzane.gitee.io/blog/2021/09/04/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B9%8B%E9%97%B4%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E7%9A%84%E9%85%8D%E7%BD%AE/</id>
    <published>2021-09-04T08:34:49.000Z</published>
    <updated>2024-02-02T09:00:05.808Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸‹é¢çš„æ­¥éª¤ä¸­ä»¥ ubuntu1804 ä¸ºä¾‹ï¼Œä»‹ç»æœåŠ¡å™¨ä¹‹é—´é…ç½®å…å¯†ç™»å½•çš„æ­¥éª¤ã€‚</p><a id="more"></a><p>ä¸‰å°æœåŠ¡å™¨çš„ ip ä¸ºï¼š192.168.0.101ã€192.168.0.103ã€192.168.0.104ï¼Œé…ç½®ä½¿101å¯ä»¥åœ¨ä¸éœ€è¦å¯†ç ï¼ˆé€šè¿‡é…ç½®å¯†é’¥ï¼‰çš„æƒ…å†µä¸‹è®¿é—®103å’Œ104ã€‚</p><h2 id="é…ç½®æ­¥éª¤"><a href="#é…ç½®æ­¥éª¤" class="headerlink" title="é…ç½®æ­¥éª¤"></a>é…ç½®æ­¥éª¤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1. ä¸‰å°æœåŠ¡å™¨éƒ½å®‰è£… ssh æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯</span><br><span class="line"></span><br><span class="line">2. ä¿®æ”¹ 103 å’Œ 104 æœåŠ¡å™¨çš„ ssh é…ç½® &#x2F;etc&#x2F;ssh&#x2F;sshd_configï¼Œå¢åŠ å¦‚ä¸‹é…ç½®ï¼š</span><br><span class="line">PermitRootLogin yes  # å…è®¸ root ç”¨æˆ·é€šè¿‡ ssh ç™»å½•</span><br><span class="line">   ä¿®æ”¹å®Œæˆä¿å­˜åï¼Œé‡å¯ ssh æœåŠ¡ï¼šservice ssh restart</span><br><span class="line">   </span><br><span class="line">3. åœ¨ 101 ä¸Šåˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œç„¶åæ‰§è¡Œï¼šssh-keygen -t rsaï¼Œæ‰§è¡Œåä¸€è·¯å›è½¦ï¼Œç”Ÿæˆå…¬é’¥å’Œç§é’¥å¯¹</span><br><span class="line"></span><br><span class="line">4. åœ¨ 101 ä¸Šæ‰§è¡Œï¼šssh-copy-id 192.168.0.103</span><br><span class="line">   è¾“å…¥ 103 çš„ root å¯†ç åï¼ˆå¦‚æœå¿˜è®° root å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨ sudo passwd root é‡æ–°è®¾ç½® root å¯†ç ï¼‰ï¼Œä¼šå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: Source of key(s) to be installed: &quot;&#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub&quot;</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@192.168.0.103&#39;s password: </span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &#39;192.168.0.103&#39;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line">  </span><br><span class="line">   ä¸Šé¢çš„ä¿¡æ¯è¡¨ç¤ºï¼Œå·²ç»æˆåŠŸå°† 101 çš„å…¬é’¥æ·»åŠ åˆ°äº† 103 æœåŠ¡å™¨çš„ &#x2F;root&#x2F;.ssh&#x2F;authored_keys æ–‡ä»¶ä¸­ã€‚</span><br><span class="line">   </span><br><span class="line">5. æ‰§è¡Œ: ssh 192.168.0.103 å³å¯ç™»å½• 103 æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œ scp file 192.168.0.103:&#x2F;home&#x2F;wyzane å°†éœ€è¦çš„æ–‡ä»¶æ‹·è´åˆ° 103 æœåŠ¡å™¨ä¸Š</span><br><span class="line"></span><br><span class="line">6. é…ç½® 104 æœåŠ¡å™¨æ—¶ï¼Œ é‡å¤æ‰§è¡Œæ­¥éª¤ 4 å³å¯ã€‚</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯é…ç½®æœåŠ¡å™¨ä¹‹é—´å…å¯†ç™»å½•çš„æ­¥éª¤ï¼Œå½“æˆ‘ä»¬åœ¨ 101 æœåŠ¡å™¨çš„ /etc/hosts æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.0.103  app-01</span><br><span class="line">192.168.0.104  app-02</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ ssh app-01 å’Œ ssh app-02 ä¹‹ç±»çš„å‘½ä»¤é€šè¿‡ DNS è§£ææ¥è®¿é—® 103 å’Œ 104 æœåŠ¡å™¨ã€‚</p><h2 id="ansibleçš„ä½¿ç”¨"><a href="#ansibleçš„ä½¿ç”¨" class="headerlink" title="ansibleçš„ä½¿ç”¨"></a>ansibleçš„ä½¿ç”¨</h2><p>å¦‚æœæœ‰å¤šå°æœåŠ¡å™¨éœ€è¦é…ç½®å¯†é’¥ç™»å½•ï¼Œå¯ä»¥ä½¿ç”¨Ansibleè¿›è¡Œæ‰¹é‡é…ç½®ã€‚</p><p>Ansible æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–å¹³å°ï¼Œå®ƒç”¨äºé…ç½®ç®¡ç†ã€åº”ç”¨éƒ¨ç½²ã€ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œç­‰ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨å®ƒè¿›è¡Œæ‰¹é‡å¯†é’¥ç™»å½•çš„é…ç½®ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰è‹¥å¹²ä¸ªå‘˜å·¥ï¼Œéœ€è¦å¯†é’¥ç™»å½•å¤šå°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠå¤šä¸ªå‘˜å·¥çš„å…¬é’¥ä¸Šä¼ åˆ°å¤šå°æœåŠ¡å™¨ä¸Šã€‚</p><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªhostsæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­ä¿å­˜äº†æœåŠ¡å™¨çš„ä¿¡æ¯ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[test]</span><br><span class="line">test_ip ansible_user&#x3D;test_user ansible_ssh_pass&#x3D;test_pass ansible_port&#x3D;22</span><br><span class="line"></span><br><span class="line">[preprod]</span><br><span class="line">preprod_ip ansible_user&#x3D;preprod_user ansible_ssh_pass&#x3D;preprod_pass ansible_port&#x3D;2000</span><br><span class="line"></span><br><span class="line">[prod]</span><br><span class="line">prod_ip ansible_user&#x3D;prod_user ansible_ssh_pass&#x3D;prod_pass ansible_port&#x3D;22</span><br><span class="line"></span><br><span class="line">[nginx]</span><br><span class="line">nginx_ip ansible_user&#x3D;nginx_user ansible_ssh_pass&#x3D;nginx_pass ansible_port&#x3D;22</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸­ï¼Œä¸­æ‹¬å·çš„å†…å®¹å¯ä»¥ç†è§£ä¸ºæœåŠ¡å™¨åç§°ï¼Œè¿™ä¸ªåç§°åœ¨ä¸‹é¢çš„æ–‡ä»¶ä¸­ä¼šç”¨åˆ°ï¼Œåç§°ä¸‹é¢åˆ†åˆ«æŒ‡å®šäº†å¯¹åº”çš„æœåŠ¡å™¨ipã€ç”¨æˆ·åã€å¯†ç ã€ç«¯å£ä¿¡æ¯ã€‚</p><ol start="2"><li>åˆ›å»ºä¸€ä¸ª Ansible playbook é…ç½®æ–‡ä»¶ test.ymlï¼Œç”¨äºä¿å­˜éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</li></ol><p>å†…å®¹å¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">SSH</span> <span class="string">Keys</span>   <span class="comment"># æ“ä½œçš„åç§°</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">test:preprod</span>        <span class="comment"># æŒ‡å®šhostsæ–‡ä»¶ä¸­çš„å“ªäº›æœåŠ¡å™¨æ‰§è¡Œè¿™ä¸ªæ“ä½œ</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span>                <span class="comment"># becomeè¡¨ç¤ºæ˜¯å¦ä½¿ç”¨ç‰¹æƒæå‡ï¼Œyesè¡¨ç¤ºä»»åŠ¡å°†ä»¥è¶…çº§ç”¨æˆ·æƒé™è¿è¡Œ</span></span><br><span class="line">  <span class="attr">vars:</span>                      <span class="comment"># playbookè¿è¡Œæ—¶ä½¿ç”¨çš„å˜é‡</span></span><br><span class="line">    <span class="attr">ansible_become_pass:</span> <span class="string">"Dy18Zz@!@"</span>   <span class="comment"># åœ¨æå‡æƒé™æ—¶ä½¿ç”¨çš„å¯†ç </span></span><br><span class="line">  <span class="attr">tasks:</span>                               <span class="comment"># è¿™ä¸ªæ“ä½œä¸­æœ‰å“ªäº›ä»»åŠ¡éœ€è¦æ‰§è¡Œ</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">authorized</span> <span class="string">key</span>         <span class="comment"># ä»»åŠ¡åç§°ï¼Œè®¾ç½®sshæˆæƒå¯†é’¥</span></span><br><span class="line">      <span class="attr">authorized_key:</span></span><br><span class="line">        <span class="attr">user:</span> <span class="string">lxtech</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">"<span class="template-variable">&#123;&#123; lookup('file', item) &#125;&#125;</span>"</span>    <span class="comment"># ä½¿ç”¨äº†lookupä»æ–‡ä»¶ä¸­è¯»å–å¯†é’¥</span></span><br><span class="line">      <span class="attr">loop:</span>                                  <span class="comment"># é€šè¿‡å¾ªç¯æ·»åŠ å¤šä¸ªå¯†é’¥æ–‡ä»¶ï¼Œé…ç½®è¿™äº›å‘˜å·¥å¯†é’¥ç™»å½•testå’ŒpreprodæœåŠ¡å™¨</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../pub/001.pub</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../pub/002.pub</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../pub/003.pub</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">PubkeyAuthentication</span> <span class="string">is</span> <span class="string">enabled</span>   <span class="comment"># ä»»åŠ¡åç§°ï¼Œæ›´æ–°sshd_configæ–‡ä»¶ï¼Œè®¾ç½®PubkeyAuthentication yesï¼Œå…è®¸å¯†é’¥ç™»å½•</span></span><br><span class="line">      <span class="attr">lineinfile:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/etc/ssh/sshd_config</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">'^#?PubkeyAuthentication'</span></span><br><span class="line">        <span class="attr">line:</span> <span class="string">'PubkeyAuthentication yes'</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Disable</span> <span class="string">Password</span> <span class="string">Authentication</span>   <span class="comment"># ç¦æ­¢è´¦å·å¯†ç ç™»å½•</span></span><br><span class="line">      <span class="attr">lineinfile:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/etc/ssh/sshd_config</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">'^#?PasswordAuthentication'</span></span><br><span class="line">        <span class="attr">line:</span> <span class="string">'PasswordAuthentication no'</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Disable</span> <span class="string">Root</span> <span class="string">SSH</span> <span class="string">Login</span>   <span class="comment"># ç¦æ­¢ä½¿ç”¨rootç”¨æˆ·ç™»å½•</span></span><br><span class="line">      <span class="attr">lineinfile:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/etc/ssh/sshd_config</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">'^#?PermitRootLogin'</span></span><br><span class="line">        <span class="attr">line:</span> <span class="string">'PermitRootLogin no'</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">SSH</span> <span class="string">service</span>    <span class="comment"># é‡å¯sshæœåŠ¡</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">sshd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">Nginx</span> <span class="string">SSH</span> <span class="string">Keys</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">nginx:prod</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">ansible_become_pass:</span> <span class="string">"!zE4s678g@"</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">authorized</span> <span class="string">key</span></span><br><span class="line">      <span class="attr">authorized_key:</span></span><br><span class="line">        <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">"<span class="template-variable">&#123;&#123; lookup('file', item) &#125;&#125;</span>"</span></span><br><span class="line">      <span class="attr">loop:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/home/dytech/pkgs/ansible/pub/005.pub</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/home/dytech/pkgs/ansible/pub/006.pub</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/home/dytech/pkgs/ansible/pub/007.pub</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">PubkeyAuthentication</span> <span class="string">is</span> <span class="string">enabled</span></span><br><span class="line">      <span class="attr">lineinfile:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/etc/ssh/sshd_config</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">'^#?PubkeyAuthentication'</span></span><br><span class="line">        <span class="attr">line:</span> <span class="string">'PubkeyAuthentication yes'</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Disable</span> <span class="string">Password</span> <span class="string">Authentication</span></span><br><span class="line">      <span class="attr">lineinfile:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/etc/ssh/sshd_config</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">'^#?PasswordAuthentication'</span></span><br><span class="line">        <span class="attr">line:</span> <span class="string">'PasswordAuthentication no'</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">SSH</span> <span class="string">service</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">sshd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œæ‰§è¡Œå‘½ä»¤ ansible-playbook -i hosts test.yml æ‰¹é‡æ‰§è¡Œä»»åŠ¡å°±è¡Œäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸‹é¢çš„æ­¥éª¤ä¸­ä»¥ ubuntu1804 ä¸ºä¾‹ï¼Œä»‹ç»æœåŠ¡å™¨ä¹‹é—´é…ç½®å…å¯†ç™»å½•çš„æ­¥éª¤ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="http://wyzane.gitee.io/blog/categories/Linux/"/>
    
    
      <category term="linux" scheme="http://wyzane.gitee.io/blog/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>jenkinsçš„å®‰è£…ä¸ç®€å•ä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2021/08/24/jenkins%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2021/08/24/jenkins%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</id>
    <published>2021-08-24T14:09:49.000Z</published>
    <updated>2021-08-24T14:33:36.249Z</updated>
    
    <content type="html"><![CDATA[<p>jenkinsæ˜¯ä¸€ä¸ªæŒç»­é›†æˆå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²çš„å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿæ–¹ä¾¿çš„éƒ¨ç½²é¡¹ç›®ã€‚ä¸‹é¢ä»‹ç»ä¸‹ jenkins çš„å®‰è£…ã€gitä¸­å¤®ä»“åº“çš„åˆ›å»ºï¼ŒåŠä½¿ç”¨ jenkins å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</p><a id="more"></a><p>ä»¥ä¸‹ä¾‹å­ä¸­ä½¿ç”¨çš„æœåŠ¡å™¨æ˜¯ Ubuntu 18.04ã€‚</p><h2 id="å®‰è£…jenkins"><a href="#å®‰è£…jenkins" class="headerlink" title="å®‰è£…jenkins"></a>å®‰è£…jenkins</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1. å»å®˜ç½‘ä¸‹è½½ jdk: jdk-8u251-linux-i586.tar.gz</span><br><span class="line">2. è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡ï¼Œåœ¨é…ç½®æ–‡ä»¶ &#x2F;etc&#x2F;profile ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼ˆè·¯å¾„å¯æ ¹æ®è‡ªå·±æƒ…å†µæ›´æ”¹ï¼‰ï¼š</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0</span><br><span class="line">export JRE_HOME&#x3D;$&#123;JAVA_HOME&#125;&#x2F;jre</span><br><span class="line">export CLASSPATH&#x3D;.:$&#123;JAVA_HOME&#125;&#x2F;lib:$&#123;JRE_HOME&#125;&#x2F;lib:$CLASSPATH</span><br><span class="line">export JAVA_PATH&#x3D;$&#123;JAVA_HOME&#125;&#x2F;bin:$&#123;JRE_HOME&#125;&#x2F;bin</span><br><span class="line">export PATH&#x3D;$PATH:$&#123;JAVA_PATH&#125;</span><br><span class="line">3. æ‰§è¡Œ source &#x2F;etc&#x2F;profileï¼Œå¹¶æ‰§è¡Œ java æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span><br><span class="line">4. å®‰è£…æˆåŠŸåï¼Œé…ç½®è½¯è¿æ¥ ln -s &#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0&#x2F;bin&#x2F;java &#x2F;usr&#x2F;bin&#x2F;java</span><br><span class="line">5. å®‰è£… jenkins</span><br><span class="line">1) wget -q -O - https:&#x2F;&#x2F;pkg.jenkins.io&#x2F;debian&#x2F;jenkins.io.key | sudo apt-key add -</span><br><span class="line">2) sudo sh -c &#39;echo deb http:&#x2F;&#x2F;pkg.jenkins.io&#x2F;debian-stable binary&#x2F; &gt; &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;jenkins.list&#39;</span><br><span class="line">3) sudo apt-get update</span><br><span class="line">4) sudo apt-get install jenkins</span><br><span class="line">6. å®‰è£…å®Œæˆåï¼ŒæŸ¥çœ‹jenkinsçš„çŠ¶æ€ï¼Œjenkinsé»˜è®¤è¿è¡Œåœ¨8080ç«¯å£ï¼ˆå¯ä»¥åœ¨ &#x2F;etc&#x2F;default&#x2F;jenkinsæ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤ç«¯å£ï¼‰</span><br><span class="line">service jenkins status</span><br><span class="line">service jenkins start</span><br><span class="line">service jenkins restart</span><br></pre></td></tr></table></figure><h2 id="gitä¸­å¤®ä»“åº“çš„æ­å»º"><a href="#gitä¸­å¤®ä»“åº“çš„æ­å»º" class="headerlink" title="gitä¸­å¤®ä»“åº“çš„æ­å»º"></a>gitä¸­å¤®ä»“åº“çš„æ­å»º</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. å®‰è£… git</span><br><span class="line">sudo apt install git</span><br><span class="line">2. æ·»åŠ  git ç”¨æˆ·ï¼Œæ·»åŠ æ—¶è¾“å…¥å¯†ç </span><br><span class="line">adduser git</span><br><span class="line">3. æœåŠ¡å™¨æ‰“å¼€ RSA éªŒè¯ï¼š vim &#x2F;etc&#x2F;ssh&#x2F;sshd_configï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile  .ssh&#x2F;authorized_keys</span><br><span class="line">4. åˆ‡æ¢åˆ°gitç”¨æˆ·ï¼Œ</span><br><span class="line">1ï¼‰åˆ›å»ºç›®å½•ï¼šmkdir .ssh</span><br><span class="line">2ï¼‰ç”Ÿæˆå¯†é’¥å¯¹ï¼šssh-keygen -t rsa -C &quot;12345678@qq.com&quot;</span><br><span class="line">5. åœ¨ .ssh ç›®å½•ä¸‹æ·»åŠ  authorized_keys æ–‡ä»¶ï¼Œå¹¶æŠŠå®¢æˆ·ç«¯çš„å…¬é’¥æ·»åŠ åˆ°æ–‡ä»¶ä¸­</span><br><span class="line">6. åˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼šgit init --bare pro1.git</span><br><span class="line">7. åœ¨å®¢æˆ·ç«¯å…‹éš†ä»“åº“ï¼š git clone git@192.168.0.104:&#x2F;home&#x2F;git&#x2F;pro1.git</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨jenkinså®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#ä½¿ç”¨jenkinså®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="ä½¿ç”¨jenkinså®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>ä½¿ç”¨jenkinså®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²</h2><p>å®ç°åŠŸèƒ½ï¼šä½¿ç”¨jenkinså°†ä»£ç ä»ä¸€å°æœåŠ¡å™¨æ‹‰å–åˆ°å¦ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå¹¶å°†ä»£ç ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•ä¸­ã€‚</p><p>ä¸Šé¢æ­¥éª¤ä¸­åˆ›å»ºçš„ git ä¸­å¤®ä»“åº“å°±æ˜¯æ­¤æ¬¡ä¾‹å­ä¸­çš„æºä»£ç ä»“åº“ã€‚</p><p>é…ç½® jenkins å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä¿®æ”¹ jenkins çš„é…ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿ä½¿ç”¨ jenkins ç”¨æˆ·æ‰§è¡Œ shell è„šæœ¬æ—¶ä¸ä¼šå‡ºç°æƒé™é—®é¢˜ã€‚ä¿®æ”¹æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. ä¿®æ”¹é…ç½®æ–‡ä»¶ &#x2F;etc&#x2F;default&#x2F;jenkinsï¼Œè®© jenkins ä»¥ root ç”¨æˆ·æ‰§è¡Œè„šæœ¬</span><br><span class="line">JENKINS_USER&#x3D;&quot;root&quot;</span><br><span class="line">JENKINS_GROUP&#x3D;&quot;root&quot;</span><br><span class="line"></span><br><span class="line">2. ä¿®æ”¹ jenkins ç›¸å…³ç›®å½•çš„å±æ€§</span><br><span class="line">chown -R root:root &#x2F;var&#x2F;lib&#x2F;jenkins</span><br><span class="line">chown -R root:root &#x2F;var&#x2F;cache&#x2F;jenkins</span><br><span class="line">chown -R root:root &#x2F;var&#x2F;log&#x2F;jenkins</span><br><span class="line"></span><br><span class="line">3. é‡å¯ jenkins æœåŠ¡: service jenkins restart</span><br><span class="line">é‡å¯åï¼Œå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</span><br><span class="line">1ï¼‰mesg: ttyname failed: Inappropriate ioctl for device</span><br><span class="line">å¤„ç†ï¼šä½¿ç”¨ root ç”¨æˆ·ä¿®æ”¹æ–‡ä»¶ &#x2F;root&#x2F;.profileï¼Œå°† mesg n || true æ›¿æ¢æˆ tty -s &amp;&amp; mesg nã€‚</span><br><span class="line">2ï¼‰daemon: fatal: refusing to execute unsafe program: &#x2F;usr&#x2F;bin&#x2F;java (&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0&#x2F;bin is group and world writable)</span><br><span class="line">å¤„ç†ï¼šæ‰§è¡Œ chmod -R 755 &#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0&#x2F;bin</span><br><span class="line"></span><br><span class="line">4. æ‰§è¡Œä»¥ä¸Šæ­¥éª¤åï¼Œé‡å¯æœåŠ¡å™¨å’Œ jenkins æœåŠ¡å°±è¡Œäº†ï¼Œä¸‹é¢å°±èƒ½ä½¿ç”¨ jenkins æ‰§è¡Œ shell è„šæœ¬äº†ã€‚</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ jenkins æœåŠ¡åï¼Œè®¿é—® 127.0.0.1:8080ï¼Œè¾“å…¥å¯†ç åè¿›å…¥jenkinsã€‚é…ç½®æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œåœ¨ Dashboard ä¸Šåˆ›å»ºä¸€ä¸ª Itemï¼Œè¾“å…¥ Item åç§°å¹¶é€‰æ‹© Freestyle projectã€‚</p><p><img src="new_item.png" alt="new_item"></p><p>é€‰æ‹©å¥½ä»¥åï¼Œç‚¹å‡» OKã€‚è¿›å…¥ Item åï¼Œä¸»è¦é…ç½®ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><p>ç„¶åï¼Œé…ç½®æºä»£ç çš„ git åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="source_code_git.png" alt="source_code_git"></p><p>é…ç½® git åœ°å€å‰ï¼Œéœ€è¦å…ˆåœ¨ jenkins ç”¨æˆ·ä¸‹åˆ›å»ºç§˜é’¥ï¼ˆå‘½ä»¤ï¼šssh-keygen -t rsa -C â€œ<a href="mailto:12345678@qq.com">12345678@qq.com</a>â€œï¼‰ï¼Œç„¶åå°†ç”Ÿæˆçš„å…¬é’¥æ”¾å…¥ 192.168.0.104 gitç”¨æˆ·ä¸‹çš„ authorized_keys æ–‡ä»¶ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™æç¤ºæ²¡æœ‰æƒé™ã€‚</p><p>ç„¶åï¼Œå†é…ç½®æ„å»ºæ—¶è¦æ‰§è¡Œçš„ shell è„šæœ¬ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="build_shell.png" alt="build_shell"></p><p>ä¸Šé¢çš„ shell è„šæœ¬å°±ä¸€è¡Œï¼Œå°†è¿œç¨‹æœåŠ¡å™¨ä¸Š git ä»“åº“çš„ä»£ç æ‹‰å–åï¼ˆtestç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œjenkins ä¼šæŠŠæ‹‰å–çš„ä»£ç æ”¾åˆ°å…¶ workspace ç›®å½•ä¸‹ï¼‰ï¼Œå†å°†ä»£ç æ”¾åˆ° /home/wyzane/GitProject ç›®å½•ä¸‹ã€‚</p><p>ä¸Šå›¾çš„ shell è„šæœ¬å¾ˆç®€å•ï¼Œè‹¥éœ€è¦æ‰§è¡Œå…¶ä»–çš„ä¸€äº›éƒ¨ç½²ã€é‡å¯æœåŠ¡ç­‰å‘½ä»¤ï¼Œå¯ä»¥å†æ ¹æ®éœ€è¦æ·»åŠ ã€‚</p><p>æœ€åï¼Œå¯ä»¥ä¿å­˜å¹¶ Build ä¸€ä¸‹ Itemï¼Œä¸Šé¢ä¾‹å­ä¸­æ§åˆ¶å°çš„è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Started by user wyzane</span><br><span class="line">Running as SYSTEM</span><br><span class="line">Building in workspace &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;test</span><br><span class="line">[WS-CLEANUP] Deleting project workspace...</span><br><span class="line">[WS-CLEANUP] Deferred wipeout is used...</span><br><span class="line">The recommended git tool is: NONE</span><br><span class="line">No credentials specified</span><br><span class="line">Cloning the remote Git repository</span><br><span class="line">Cloning repository git@192.168.0.104:&#x2F;home&#x2F;git&#x2F;GitProject&#x2F;pro1.git</span><br><span class="line"> &gt; git init &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;test # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from git@192.168.0.104:&#x2F;home&#x2F;git&#x2F;GitProject&#x2F;pro1.git</span><br><span class="line"> &gt; git --version # timeout&#x3D;10</span><br><span class="line"> &gt; git --version # &#39;git version 2.17.1&#39;</span><br><span class="line"> &gt; git fetch --tags --progress -- git@192.168.0.104:&#x2F;home&#x2F;git&#x2F;GitProject&#x2F;pro1.git +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;* # timeout&#x3D;10</span><br><span class="line"> &gt; git config remote.origin.url git@192.168.0.104:&#x2F;home&#x2F;git&#x2F;GitProject&#x2F;pro1.git # timeout&#x3D;10</span><br><span class="line"> &gt; git config --add remote.origin.fetch +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;* # timeout&#x3D;10</span><br><span class="line">Avoid second fetch</span><br><span class="line"> &gt; git rev-parse refs&#x2F;remotes&#x2F;origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line">Checking out Revision 8d114db052b5c4914e56a1e5848a2c5df9bca69e (refs&#x2F;remotes&#x2F;origin&#x2F;master)</span><br><span class="line"> &gt; git config core.sparsecheckout # timeout&#x3D;10</span><br><span class="line"> &gt; git checkout -f 8d114db052b5c4914e56a1e5848a2c5df9bca69e # timeout&#x3D;10</span><br><span class="line">Commit message: &quot;add test03&quot;</span><br><span class="line"> &gt; git rev-list --no-walk 8d114db052b5c4914e56a1e5848a2c5df9bca69e # timeout&#x3D;10</span><br><span class="line">[test] $ &#x2F;bin&#x2F;sh -xe &#x2F;tmp&#x2F;jenkins7411340475787087463.sh</span><br><span class="line">+ cp -r &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;test &#x2F;home&#x2F;wyzane&#x2F;GitProject</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure><p>jenkins ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–é…ç½®é¡¹å’Œæ’ä»¶ï¼Œåœ¨åé¢è¿˜ä¼šæ•´ç†ä¸€éƒ¨åˆ†å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;jenkinsæ˜¯ä¸€ä¸ªæŒç»­é›†æˆå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²çš„å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿæ–¹ä¾¿çš„éƒ¨ç½²é¡¹ç›®ã€‚ä¸‹é¢ä»‹ç»ä¸‹ jenkins çš„å®‰è£…ã€gitä¸­å¤®ä»“åº“çš„åˆ›å»ºï¼ŒåŠä½¿ç”¨ jenkins å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>æé«˜æ–‡æœ¬æŸ¥è¯¢æ•ˆç‡çš„å‡ ä¸ªå‘½ä»¤</title>
    <link href="http://wyzane.gitee.io/blog/2021/05/22/%E6%8F%90%E9%AB%98%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2%E6%95%88%E7%8E%87%E7%9A%84%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4/"/>
    <id>http://wyzane.gitee.io/blog/2021/05/22/%E6%8F%90%E9%AB%98%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2%E6%95%88%E7%8E%87%E7%9A%84%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4/</id>
    <published>2021-05-22T13:15:54.000Z</published>
    <updated>2021-05-25T13:51:56.199Z</updated>
    
    <content type="html"><![CDATA[<p> æŸ¥æ‰¾æ—¥å¿—å®šä½é—®é¢˜æ—¶ï¼Œå¾€å¾€è¢«æŸ¥è¯¢çš„æ—¥å¿—å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶æˆ–è€…æ˜¯å‹ç¼©æ–‡ä»¶ï¼ŒæŸ¥æ‰¾æ—¶ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ moreã€zgrep ç­‰å‘½ä»¤æ¥æŸ¥æ‰¾ã€‚</p><a id="more"></a><h1 id="more"><a href="#more" class="headerlink" title="more"></a>more</h1><p>more å‘½ä»¤ä¸ cat å‘½ä»¤ç±»ä¼¼ï¼Œä½†æ˜¯æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œmore æ˜¯ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºï¼Œè¿™æ ·æ›´æ–¹ä¾¿æˆ‘ä»¬æŸ¥æ‰¾ã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œ more â€“help ï¼Œå¯ä»¥çœ‹çœ‹ more æœ‰å“ªäº›å‚æ•°å¯ä»¥ä½¿ç”¨ã€‚</p><p>more çš„åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. ç©ºæ ¼é”®ï¼šå¾€ä¸‹æ˜¾ç¤ºä¸€é¡µ</span><br><span class="line">2. bé”®ï¼šå¾€ä¸Šæ˜¾ç¤ºä¸€é¡µ</span><br><span class="line">3. more +nï¼šä»ç¬¬nè¡Œå¼€å§‹æ˜¾ç¤º</span><br><span class="line">4. more -n: è‡ªå®šä¹‰æ¯é¡µæ˜¾ç¤ºè¡Œæ•°</span><br><span class="line">5. &#x2F;å¾…æŸ¥æ‰¾å­—ç¬¦ä¸²ï¼šæŸ¥æ‰¾ç‰¹å®šçš„å­—ç¬¦ä¸²</span><br><span class="line">6. qï¼šé€€å‡ºmoreå‘½ä»¤</span><br><span class="line"></span><br><span class="line">è¿˜å¯ä»¥ä½¿ç”¨ more --help æŸ¥çœ‹æ›´å¤šå‚æ•°ã€‚</span><br></pre></td></tr></table></figure><h1 id="zgrep"><a href="#zgrep" class="headerlink" title="zgrep"></a>zgrep</h1><p>zgrep å‘½ä»¤ä¸ grep å‘½ä»¤åŠŸèƒ½ä¸€æ ·ï¼Œåªä¸è¿‡ zgrep å¯ä»¥ç”¨æ¥æŸ¥æ‰¾å‹ç¼©æ–‡ä»¶ä¸­çš„ç‰¹å®šå†…å®¹è€Œä¸ç”¨å°†æ–‡ä»¶è§£å‹ï¼Œè¿™å¯¹äºæŸ¥è¯¢å¤§å‹ç¼©æ–‡ä»¶çš„æŸ¥æ‰¾å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>zgrep çš„åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. zgrep å¾…æŸ¥æ‰¾å†…å®¹ å‹ç¼©æ–‡ä»¶ï¼ˆè‹¥æŸ¥æ‰¾çš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦åŠ ä¸Šå‚æ•° -aï¼Œä¸‹åŒï¼‰</span><br><span class="line">2. zgrep -A n å¾…æŸ¥æ‰¾å†…å®¹ å‹ç¼©æ–‡ä»¶ ï¼ˆè·å–å¾…æŸ¥æ‰¾å†…å®¹çš„åé¢ n è¡Œå†…å®¹ï¼‰</span><br><span class="line">3. zgrep -B n å¾…æŸ¥æ‰¾å†…å®¹ å‹ç¼©æ–‡ä»¶ ï¼ˆè·å–å¾…æŸ¥æ‰¾å†…å®¹çš„å‰é¢ n è¡Œå†…å®¹ï¼‰</span><br><span class="line">4. zgrep -C n å¾…æŸ¥æ‰¾å†…å®¹ å‹ç¼©æ–‡ä»¶ ï¼ˆè·å–å¾…æŸ¥æ‰¾å†…å®¹çš„å‰å n è¡Œå†…å®¹ï¼‰</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„å‘½ä»¤è¿˜æœ‰ zmoreã€zcat ç­‰ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ä¸‹å»å­¦ä¹ ä¸€ä¸‹ã€‚</p><h2 id="less"><a href="#less" class="headerlink" title="less"></a>less</h2><p>less  å‘½ä»¤ä¸ more å‘½ä»¤ç±»ä¼¼ï¼Œä½†æ˜¯åŠŸèƒ½æ¯” more æ›´å¼ºå¤§ï¼Œå®ƒçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">lessç”¨æ³•ï¼š</span><br><span class="line">1. less æ–‡ä»¶å æŸ¥æ‰¾æŒ‡å®šçš„æ–‡ä»¶</span><br><span class="line">å¸¸ç”¨å‚æ•°ï¼š</span><br><span class="line"> -iï¼šæœç´¢æ—¶å¿½ç•¥å¤§å°å†™</span><br><span class="line"> -mï¼šå¢åŠ ç™¾åˆ†æ¯”çš„æ˜¾ç¤º</span><br><span class="line"> -sï¼šåˆå¹¶è¿ç»­ç©ºè¡Œä¸ºä¸€è¡Œ</span><br><span class="line"> -Nï¼šæ˜¾ç¤ºè¡Œå·</span><br><span class="line">2. d å‘ä¸‹ç¿»é¡µ</span><br><span class="line">3. u å‘ä¸Šç¿»é¡µ</span><br><span class="line">4. g è·³åˆ°ç¬¬ä¸€è¡Œ</span><br><span class="line">5. G è·³åˆ°æœ€åä¸€è¡Œ</span><br><span class="line">6. &#x2F;å­—ç¬¦ä¸²ï¼šå‘ä¸‹æœç´¢å­—ç¬¦ä¸²</span><br><span class="line">7. ?å­—ç¬¦ä¸²ï¼šå‘ä¸Šæœç´¢å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure><p>less çš„æ›´å¤šç”¨æ³•ï¼Œå¯ä»¥æ‰§è¡Œ less â€“help æŸ¥çœ‹ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æ–‡æœ¬æŸ¥æ‰¾ä¸­å¯èƒ½å¸¸ç”¨åˆ°çš„å‡ ä¸ªæŸ¥æ‰¾å‘½ä»¤ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; æŸ¥æ‰¾æ—¥å¿—å®šä½é—®é¢˜æ—¶ï¼Œå¾€å¾€è¢«æŸ¥è¯¢çš„æ—¥å¿—å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶æˆ–è€…æ˜¯å‹ç¼©æ–‡ä»¶ï¼ŒæŸ¥æ‰¾æ—¶ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ moreã€zgrep ç­‰å‘½ä»¤æ¥æŸ¥æ‰¾ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="http://wyzane.gitee.io/blog/categories/Linux/"/>
    
    
      <category term="linux" scheme="http://wyzane.gitee.io/blog/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Rediså“¨å…µæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2021/05/19/Redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2021/05/19/Redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/</id>
    <published>2021-05-19T14:23:08.000Z</published>
    <updated>2021-05-22T12:57:46.219Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©ä»‹ç»ä¸‹ Redis å“¨å…µæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨æ–¹æ³•ã€‚</p><p>åœ¨ Redis ä¸­ï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå®ƒç”¨æ¥ç›‘æ§ Redis é›†ç¾¤ä¸­ä¸­ä¸»ä»æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“å‘ç° Redis ä¸»æœåŠ¡å™¨å®•æœºåï¼Œå“¨å…µä¼šä»é›†ç¾¤å‰©ä¸‹æœåŠ¡å™¨ä¸­é‡æ–°é€‰æ‹©ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œä»è€Œä¿è¯é›†ç¾¤çš„æ­£å¸¸è¿è¡Œï¼Œå³ä¿è¯ Redis é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p><a id="more"></a><p>ä»¥ä¸‹ä¾‹å­ä¸­ä½¿ç”¨çš„ Redis ç‰ˆæœ¬å‡ä¸º 6.0ã€‚</p><h1 id="å“¨å…µæ¨¡å¼çš„é…ç½®"><a href="#å“¨å…µæ¨¡å¼çš„é…ç½®" class="headerlink" title="å“¨å…µæ¨¡å¼çš„é…ç½®"></a>å“¨å…µæ¨¡å¼çš„é…ç½®</h1><p>ä»¥æ­å»ºä¸‰ä¸ªå“¨å…µä¸ºä¾‹ï¼ŒRedis å“¨å…µæ¨¡å¼çš„é…ç½®æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1. é¦–å…ˆï¼Œè¿›å…¥ Redis æ‰€åœ¨ç›®å½•ï¼Œå¤åˆ¶ä¸‰ä»½ sentinel.conf æ–‡ä»¶ï¼Œåˆ†åˆ«å‘½åä¸º sentinel01.confã€sentinel02.confã€sentinel03.conf</span><br><span class="line"></span><br><span class="line">2. é…ç½® sentinel01.conf æ–‡ä»¶çš„å¦‚ä¸‹å†…å®¹ï¼š</span><br><span class="line">sentinel monitor mymaster 192.168.172.130 6379 2</span><br><span class="line"># ç›‘æ§åä¸º mymaster çš„ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨ipå’Œç«¯å£ä¸º192.168.172.130ï¼Œ6379ï¼Œå½“è‡³å°‘æœ‰ä¸¤ä¸ªsentinelåŒæ„æ—¶ï¼Œè¯¥ä¸»æœåŠ¡å™¨æ‰ä¼šè¢«åˆ¤å®šä¸ºå¤±æ•ˆ</span><br><span class="line"></span><br><span class="line">sentinel auth-pass mymaster &quot;wyzane&quot;</span><br><span class="line"># è®¾ç½®è¿æ¥ä¸»æœåŠ¡å™¨çš„å¯†ç </span><br><span class="line"></span><br><span class="line">sentinel down-after-milliseconds mymaster 10000</span><br><span class="line"># å¦‚æœæœåŠ¡å™¨åœ¨ç»™å®šçš„æ¯«ç§’æ•°ä¹‹å†…ï¼Œæ²¡æœ‰è¿”å› Sentinel å‘é€çš„ PING å‘½ä»¤çš„å›å¤ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆ Sentinel å°†è¿™ä¸ªæœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆsubjectively downï¼Œç®€ç§° SDOWN ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"># æŒ‡å®šäº†åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªä»æœåŠ¡å™¨åŒæ—¶å¯¹æ–°çš„ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆæ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ã€‚</span><br><span class="line"></span><br><span class="line">3. å¯¹ sentinel02.conf å’Œ sentinel03.conf è¿›è¡ŒåŒæ ·çš„é…ç½®</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¯åŠ¨å“¨å…µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ–¹å¼ä¸€ï¼Œåˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">redis-sentinel sentinel01.conf</span><br><span class="line">redis-sentinel sentinel02.conf</span><br><span class="line">redis-sentinel sentinel03.conf</span><br><span class="line">æ–¹å¼äºŒï¼Œåˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">redis-server sentinel01.conf --sentinel</span><br><span class="line">redis-server sentinel02.conf --sentinel</span><br><span class="line">redis-server sentinel03.conf --sentinel</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ Redis å“¨å…µçš„é…ç½®å’Œå¯åŠ¨ï¼Œä¸‹é¢ä»‹ç»ä¸‹ Redis å“¨å…µæ¨¡å¼çš„å·¥ä½œåŸç†ã€‚</p><h1 id="å“¨å…µæ¨¡å¼çš„åŸç†"><a href="#å“¨å…µæ¨¡å¼çš„åŸç†" class="headerlink" title="å“¨å…µæ¨¡å¼çš„åŸç†"></a>å“¨å…µæ¨¡å¼çš„åŸç†</h1><p>å“¨å…µæ¨¡å¼è¿è¡Œçš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><p>å½“ Redis é›†ç¾¤å’Œ Redis å“¨å…µå¯åŠ¨åï¼Œå“¨å…µé€šè¿‡å‘ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼Œæ¥è·å–ä¸»ã€ä»æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€ï¼Œå‚æ•° sentinel down-after-milliseconds ç”¨æ¥æ§åˆ¶ï¼Œä¸»ã€ä»æœåŠ¡å™¨æ”¶åˆ°å‘½ä»¤åè¿”å›å“åº”çš„æ—¶é—´ã€‚å¦‚æœåœ¨ç»™å®šæ—¶é—´å†…ï¼Œå“¨å…µæ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨å‘å›çš„å“åº”ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥å“¨å…µå°±å°†å¯¹åº”çš„æœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿çŠ¶æ€(subjectively downï¼Œç®€ç§° SDOWN ï¼‰ï¼Œå½“æœ‰å¤šä¸ªï¼ˆä¸€èˆ¬æ˜¯åŠæ•°ä»¥ä¸Šï¼‰å“¨å…µéƒ½æŠŠè¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å™¨å°±è¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆobjectively downï¼Œ ç®€ç§° ODOWNï¼‰ï¼Œæ­¤æ—¶æ‰ä¼šå‘ç”Ÿæ•…éšœè¿ç§»æ“ä½œã€‚</p><p>Redis çš„ Sentinel ä¸­å…³äºä¸‹çº¿ï¼ˆdownï¼‰æœ‰ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. ä¸»è§‚ä¸‹çº¿ï¼ˆSubjectively Downï¼Œ ç®€ç§° SDOWNï¼‰æŒ‡çš„æ˜¯å•ä¸ª Sentinel å®ä¾‹å¯¹æœåŠ¡å™¨åšå‡ºçš„ä¸‹çº¿åˆ¤æ–­ã€‚</span><br><span class="line">2. å®¢è§‚ä¸‹çº¿ï¼ˆObjectively Downï¼Œ ç®€ç§° ODOWNï¼‰æŒ‡çš„æ˜¯å¤šä¸ª Sentinel å®ä¾‹åœ¨å¯¹åŒä¸€ä¸ªæœåŠ¡å™¨åšå‡º SDOWN åˆ¤æ–­ï¼Œ å¹¶ä¸”é€šè¿‡ SENTINEL is-master-down-by-addr å‘½ä»¤äº’ç›¸äº¤æµä¹‹åï¼Œ å¾—å‡ºçš„æœåŠ¡å™¨ä¸‹çº¿åˆ¤æ–­ã€‚ ï¼ˆä¸€ä¸ª Sentinel å¯ä»¥é€šè¿‡å‘å¦ä¸€ä¸ª Sentinel å‘é€ SENTINEL is-master-down-by-addr å‘½ä»¤æ¥è¯¢é—®å¯¹æ–¹æ˜¯å¦è®¤ä¸ºç»™å®šçš„æœåŠ¡å™¨å·²ä¸‹çº¿ã€‚ï¼‰</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ªå«æœ‰ä¸€ä¸»ä¸¤ä»çš„ Redis é›†ç¾¤ï¼Œå¹¶é…ç½®ä¸‰ä¸ªå“¨å…µï¼Œçœ‹ä¸€ä¸‹å“¨å…µæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‚</p><p>Redis ä¸»ä»çš„é…ç½®å°±ä¸å¤šåšä»‹ç»äº†ï¼Œä¸‹é¢ç›´æ¥çœ‹å¯åŠ¨åçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>Redis ä¸»ä»ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸»ï¼š192.168.172.131 6380</span><br><span class="line">ä»ï¼š192.168.172.131 6381</span><br><span class="line">ä»ï¼š192.168.172.131 6382</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ 192.168.172.131 6380 å’Œ 192.168.172.131 6381 åï¼Œä¸»æœåŠ¡å™¨çš„æ—¥å¿—ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">16243:M 22 May 2021 00:56:23.056 * Replica 192.168.172.131:6381 asks for synchronization</span><br><span class="line">16243:M 22 May 2021 00:56:23.056 * Full resync requested by replica 192.168.172.131:6381</span><br><span class="line">16243:M 22 May 2021 00:56:23.056 * Replication backlog created, my new replication IDs are &#39;b643fa0d90a895b29c82b71446167e6b60d52283&#39; and &#39;0000000000000000000000000000000000000000&#39;</span><br><span class="line">16243:M 22 May 2021 00:56:23.056 * Starting BGSAVE for SYNC with target: disk</span><br><span class="line">16243:M 22 May 2021 00:56:23.056 * Background saving started by pid 16254</span><br><span class="line">16254:C 22 May 2021 00:56:23.058 * DB saved on disk</span><br><span class="line">16254:C 22 May 2021 00:56:23.059 * RDB: 0 MB of memory used by copy-on-write</span><br><span class="line">16243:M 22 May 2021 00:56:23.095 * Background saving terminated with success</span><br><span class="line">16243:M 22 May 2021 00:56:23.097 * Synchronization with replica 192.168.172.131:6381 succeeded</span><br></pre></td></tr></table></figure><p>192.168.172.131 6381 æœåŠ¡å™¨çš„æ—¥å¿—ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">16249:S 22 May 2021 00:56:23.054 * Master replied to PING, replication can continue...</span><br><span class="line">16249:S 22 May 2021 00:56:23.055 * Partial resynchronization not possible (no cached master)</span><br><span class="line">16249:S 22 May 2021 00:56:23.057 * Full resync from master: b643fa0d90a895b29c82b71446167e6b60d52283:0</span><br><span class="line">16249:S 22 May 2021 00:56:23.096 * MASTER &lt;-&gt; REPLICA sync: receiving 680 bytes from master to disk</span><br><span class="line">16249:S 22 May 2021 00:56:23.096 * MASTER &lt;-&gt; REPLICA sync: Flushing old data</span><br><span class="line">16249:S 22 May 2021 00:56:23.097 * MASTER &lt;-&gt; REPLICA sync: Loading DB in memory</span><br><span class="line">16249:S 22 May 2021 00:56:23.097 * Loading RDB produced by version 6.0.6</span><br><span class="line">16249:S 22 May 2021 00:56:23.097 * RDB age 0 seconds</span><br><span class="line">16249:S 22 May 2021 00:56:23.097 * RDB memory usage when created 1.83 Mb</span><br><span class="line">16249:S 22 May 2021 00:56:23.097 * MASTER &lt;-&gt; REPLICA sync: Finished with success</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿‡ç¨‹è¡¨ç¤ºï¼Œä»æœåŠ¡å™¨è¿æ¥ä¸Šä¸»æœåŠ¡å™¨åï¼Œè¿›è¡Œäº†æ•°æ®çš„å…¨é‡åŒæ­¥ã€‚åŒæ ·çš„ï¼Œå¯åŠ¨ 192.168.172.131 6382 åï¼Œæ•°æ®ä¹Ÿä¼šè¿›è¡Œå…¨é‡åŒæ­¥ã€‚</p><p>ä¸‹é¢å†å¯åŠ¨ Redis å“¨å…µã€‚</p><p>æ‰§è¡Œ redis-sentinel sentinel.conf åï¼Œå“¨å…µæœåŠ¡å™¨çš„æ—¥å¿—ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">16392:X 22 May 2021 01:13:36.020 # WARNING: The TCP backlog setting of 511 cannot be enforced because &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;somaxconn is set to the lower value of 128.</span><br><span class="line">16392:X 22 May 2021 01:13:36.020 # Sentinel ID is 8fd93d8d9547434177903ba11cb5ae0bf603f358</span><br><span class="line">16392:X 22 May 2021 01:13:36.020 # +monitor master mymaster 192.168.172.131 6380 quorum 2</span><br><span class="line">16392:X 22 May 2021 01:13:36.022 * +slave slave 192.168.172.131:6381 192.168.172.131 6381 @ mymaster 192.168.172.131 6380</span><br><span class="line">16392:X 22 May 2021 01:13:36.024 * +slave slave 192.168.172.131:6382 192.168.172.131 6382 @ mymaster 192.168.172.131 6380</span><br></pre></td></tr></table></figure><p>è‹¥å°†ä¸»æœåŠ¡å™¨çš„è¿›ç¨‹å…³æ‰ï¼Œåˆ™å“¨å…µçš„æ—¥å¿—ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">16481:X 22 May 2021 01:24:02.032 # +sdown master mymaster 192.168.172.131 6380ï¼ˆå½“å‰å“¨å…µè®¤ä¸ºä¸»æœåŠ¡å™¨å®•æœºï¼Œä¸»è§‚ä¸‹çº¿ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.093 # +odown master mymaster 192.168.172.131 6380 ï¼ˆæœ‰ä¸‰ä¸ªå“¨å…µè®¤ä¸ºä¸»æœåŠ¡å™¨å®•æœºï¼Œè¶…è¿‡äº†ä¸¤ä¸ªï¼Œå®¢è§‚ä¸‹çº¿ï¼‰#quorum 3&#x2F;2</span><br><span class="line">16481:X 22 May 2021 01:24:02.093 # +new-epoch 9ï¼ˆé€’å¢çš„é›†ç¾¤ç‰ˆæœ¬å·ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.093 # +try-failover master mymaster 192.168.172.131 6380ï¼ˆå¼€å§‹å°è¯•å¯¹é›†ç¾¤è¿›è¡Œæ•…éšœè¿ç§»ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.097 # +vote-for-leader 12e1af953d931b8ac097876d7bdf803ba39c52f6 9ï¼ˆé€‰å‡ºä¸€ä¸ªå“¨å…µï¼Œä½œä¸ºæ•…éšœè¿ç§»çš„leaderï¼Œå½“å‰å“¨å…µï¼ŒæŠ•ç¥¨ç»™ Sentinel ID ä¸º 12e1af953d931b8ac097876d7bdf803ba39c52f6 çš„å“¨å…µï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.103 # 2c2c810af7936fba2facbeb159b0f7fa1e87d325 voted for 2c2c810af7936fba2facbeb159b0f7fa1e87d325 9ï¼ˆå…¶å®ƒå“¨å…µæŠ•ç¥¨ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.106 # 8fd93d8d9547434177903ba11cb5ae0bf603f358 voted for 12e1af953d931b8ac097876d7bdf803ba39c52f6 9ï¼ˆå…¶å®ƒå“¨å…µæŠ•ç¥¨ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.187 # +elected-leader master mymaster 192.168.172.131 6380ï¼ˆå½“å‰çš„ä¸»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.188 # +failover-state-select-slave master mymaster 192.168.172.131 6380ï¼ˆåˆ†æä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.265 # +selected-slave slave 192.168.172.131:6382 192.168.172.131 6382 @ mymaster 192.168.172.131 6380ï¼ˆé€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.265 * +failover-state-send-slaveof-noone slave 192.168.172.131:6382 192.168.172.131 6382 @ mymaster 192.168.172.131 6380ï¼ˆå°†ä¸Šé¢é€‰å‡ºçš„ä»èŠ‚ç‚¹ä¸ç°åœ¨çš„ä¸»èŠ‚ç‚¹è¿›è¡Œä¸»ä»åˆ‡æ¢ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.355 * +failover-state-wait-promotion slave 192.168.172.131:6382 192.168.172.131 6382 @ mymaster 192.168.172.131 6380ï¼ˆç­‰å¾…ä»èŠ‚ç‚¹å‡çº§æˆä¸»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.531 # +promoted-slave slave 192.168.172.131:6382 192.168.172.131 6382 @ mymaster 192.168.172.131 6380ï¼ˆä»èŠ‚ç‚¹å·²ç»å‡çº§ä¸ºä¸»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.532 # +failover-state-reconf-slaves master mymaster 192.168.172.131 6380ï¼ˆä¿®æ”¹åŸæ¥ä¸»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:02.586 * +slave-reconf-sent slave 192.168.172.131:6381 192.168.172.131 6381 @ mymaster 192.168.172.131 6380ï¼ˆé‡å†™ä»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œå³ä¸ºä»èŠ‚ç‚¹é…ç½®æ–°çš„ä¸»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:03.229 # -odown master mymaster 192.168.172.131 6380</span><br><span class="line">16481:X 22 May 2021 01:24:03.565 * +slave-reconf-inprog slave 192.168.172.131:6381 192.168.172.131 6381 @ mymaster 192.168.172.131 6380ï¼ˆä»èŠ‚ç‚¹æ­£åœ¨é‡æ–°æŒ‡å‘ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:03.565 * +slave-reconf-done slave 192.168.172.131:6381 192.168.172.131 6381 @ mymaster 192.168.172.131 6380ï¼ˆä»èŠ‚ç‚¹é…ç½®å®Œæ¯•ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:03.648 # +failover-end master mymaster 192.168.172.131 6380ï¼ˆæ•…éšœè¿ç§»ç»“æŸï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:03.648 # +switch-master mymaster 192.168.172.131 6380 192.168.172.131 6382ï¼ˆæ•…éšœè¿ç§»æˆåŠŸï¼Œå“¨å…µå¼€å§‹ç›‘æ§æ–°çš„ä¸»æœåŠ¡å™¨ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:03.648 * +slave slave 192.168.172.131:6381 192.168.172.131 6381 @ mymaster 192.168.172.131 6382ï¼ˆç¡®è®¤æ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:03.648 * +slave slave 192.168.172.131:6380 192.168.172.131 6380 @ mymaster 192.168.172.131 6382ï¼ˆç¡®è®¤æ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼‰</span><br><span class="line">16481:X 22 May 2021 01:24:08.662 # +sdown slave 192.168.172.131:6380 192.168.172.131 6380 @ mymaster 192.168.172.131 6382ï¼ˆåŸä¸»èŠ‚ç‚¹å˜ä¸ºslaveèŠ‚ç‚¹å¹¶ä¸”ä¸»è§‚ä¸‹çº¿ï¼‰</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ—¥å¿—æ˜¯å“¨å…µå‘ç°ä¸»æœåŠ¡å™¨å®•æœºåï¼Œæ•…éšœæ¢å¤çš„çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©ä»‹ç»ä¸‹ Redis å“¨å…µæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Redis ä¸­ï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå®ƒç”¨æ¥ç›‘æ§ Redis é›†ç¾¤ä¸­ä¸­ä¸»ä»æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“å‘ç° Redis ä¸»æœåŠ¡å™¨å®•æœºåï¼Œå“¨å…µä¼šä»é›†ç¾¤å‰©ä¸‹æœåŠ¡å™¨ä¸­é‡æ–°é€‰æ‹©ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œä»è€Œä¿è¯é›†ç¾¤çš„æ­£å¸¸è¿è¡Œï¼Œå³ä¿è¯ Redis é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Redis" scheme="http://wyzane.gitee.io/blog/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Python3ä¸­ç”Ÿæˆå™¨å’Œåç¨‹çš„ä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2020/09/13/Python3%E4%B8%AD%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8C%E5%8D%8F%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2020/09/13/Python3%E4%B8%AD%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8C%E5%8D%8F%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-09-13T13:24:11.000Z</published>
    <updated>2024-02-25T03:03:54.810Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ•´ç†ä¸‹ Python3 ä¸­ç”Ÿæˆå™¨å’Œåç¨‹çš„ä½¿ç”¨ã€‚</p><a id="more"></a><h1 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h1><h2 id="ç”Ÿæˆå™¨è¾“å‡ºæ•°æ®"><a href="#ç”Ÿæˆå™¨è¾“å‡ºæ•°æ®" class="headerlink" title="ç”Ÿæˆå™¨è¾“å‡ºæ•°æ®"></a>ç”Ÿæˆå™¨è¾“å‡ºæ•°æ®</h2><p>python ä¸­å¯ä»¥ä½¿ç”¨ yield å…³é”®å­—å®ç°ç”Ÿæˆå™¨ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯ï¼šä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå¦‚æœåŒ…å« yield å…³é”®å­—ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""ç”Ÿæˆå™¨ï¼šyieldçš„ä½¿ç”¨</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    print(<span class="string">"=======start======="</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">"=====flag:"</span>, flag)</span><br><span class="line">        flag += <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        print(<span class="string">"========end========="</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""è°ƒç”¨ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    t = test()</span><br><span class="line">    print(t)</span><br><span class="line">    print(next(t))</span><br><span class="line">    print(next(t))</span><br><span class="line">    print(next(t))</span><br><span class="line">       </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;generator object test at 0x000001726581C2B0&gt;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;flag: 0</span><br><span class="line">0</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;end&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;flag: 1</span><br><span class="line">1</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;end&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;flag: 2</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡è°ƒç”¨next()ï¼Œéƒ½ä¼šä»ä¸Šä¸€æ¬¡ç»“æŸçš„åœ°æ–¹æ‰§è¡Œã€‚ ç›¸å½“äºé‡åˆ° yield æ—¶ï¼Œä¼šè·³å‡ºå½“å‰ä»£ç çš„æ‰§è¡Œï¼Œå†æ¬¡è°ƒç”¨next()æ—¶ï¼Œä¼šä»ä¸Šä¸€æ¬¡è·³å‡ºçš„åœ°æ–¹å¼€å§‹æ‰§è¡Œ (å³print(â€œ========end=========â€)è¿™è¡Œä»£ç è¯•ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„å¼€å§‹)ã€‚è°ƒç”¨ç”Ÿæˆå™¨æ—¶å¯ä»¥ä½¿ç”¨ next() å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨çš„ <code>__next__</code>() æ–¹æ³•æ¥è·å–å€¼ã€‚</p><h2 id="ç”Ÿæˆå™¨æ¥æ”¶å¤–éƒ¨æ•°æ®"><a href="#ç”Ÿæˆå™¨æ¥æ”¶å¤–éƒ¨æ•°æ®" class="headerlink" title="ç”Ÿæˆå™¨æ¥æ”¶å¤–éƒ¨æ•°æ®"></a>ç”Ÿæˆå™¨æ¥æ”¶å¤–éƒ¨æ•°æ®</h2><p>åœ¨ç”Ÿæˆå™¨ä¸­ï¼Œyield è¿˜å¯ä»¥æ¥æ”¶å¤–éƒ¨ä¼ è¿›æ¥çš„å€¼ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""ç”Ÿæˆå™¨ï¼šyieldæ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„å€¼</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">        x = <span class="keyword">yield</span> i</span><br><span class="line">        print(<span class="string">"=====x:"</span>, x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"OK"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    t = test()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ç¬¬ä¸€æ¬¡è°ƒç”¨ç”Ÿæˆå™¨çš„send()æ–¹æ³•æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªNoneå€¼ï¼Œç”¨äºå¯åŠ¨ç”Ÿæˆå™¨ã€‚</span></span><br><span class="line">        <span class="comment"># è°ƒç”¨ send()ï¼Œç›¸å½“äºè°ƒç”¨ next()ï¼Œæ‰§è¡Œåˆ° yield æ—¶ï¼Œä¼šè¿”å› yield åé¢çš„å€¼</span></span><br><span class="line">        ret = t.send(<span class="literal">None</span>)</span><br><span class="line">        print(<span class="string">"=====ret1:"</span>, ret)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¬¬äºŒæ¬¡è°ƒç”¨ send() æ—¶ï¼Œæ‰§è¡Œåˆ° x = yield i éƒ¨åˆ†ï¼Œç›¸å½“äº x æ¥æ”¶åˆ°äº†é€šè¿‡ send() ä¼ å…¥çš„å€¼</span></span><br><span class="line">        ret = t.send(<span class="number">9</span>)</span><br><span class="line">        print(<span class="string">"=====ret2:"</span>, ret)</span><br><span class="line"></span><br><span class="line">        ret = t.send(<span class="number">8</span>)</span><br><span class="line">        print(<span class="string">"=====ret3:"</span>, ret)</span><br><span class="line"></span><br><span class="line">        ret = t.send(<span class="number">7</span>)</span><br><span class="line">        print(<span class="string">"=====ret4:"</span>, ret)</span><br><span class="line">    <span class="keyword">except</span> StopIteration <span class="keyword">as</span> exp:</span><br><span class="line">        print(<span class="string">"=====value:"</span>, exp.value)</span><br><span class="line">            </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¾“å‡ºä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;ret1: 0</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;x: 9</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;ret2: 1</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;x: 8</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;value: OK</span><br></pre></td></tr></table></figure><p>å½“ç”Ÿæˆå™¨ä¸­ yield åæ²¡æœ‰å€¼è¿”å›æ—¶ï¼Œå†è°ƒç”¨ send() æˆ–è€… next() ä¼šæŠ›å‡º StopIteration å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ•è·è¯¥å¼‚å¸¸ã€‚è‹¥ç”Ÿæˆå™¨ä¸­æœ‰è¿”å›å€¼ï¼Œå¯ä»¥åœ¨æ•è·å¼‚å¸¸æ—¶è·å–å®ƒã€‚</p><h2 id="ä½¿ç”¨forå¾ªç¯éå†ç”Ÿæˆå™¨"><a href="#ä½¿ç”¨forå¾ªç¯éå†ç”Ÿæˆå™¨" class="headerlink" title="ä½¿ç”¨forå¾ªç¯éå†ç”Ÿæˆå™¨"></a>ä½¿ç”¨forå¾ªç¯éå†ç”Ÿæˆå™¨</h2><p>ç”Ÿæˆå™¨ä¸­çš„å€¼ä¹Ÿå¯ä»¥é€šè¿‡ for å¾ªç¯è·å–ï¼Œç±»ä¼¼äºè°ƒç”¨ next() æ–¹æ³•ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        </span><br><span class="line">      </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""ä½¿ç”¨ for å¾ªç¯è°ƒç”¨ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    t = test()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">        print(i)</span><br><span class="line">          </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>åç¨‹ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œç±»ä¼¼çº¿ç¨‹å’Œè¿›ç¨‹ï¼Œåç¨‹æ˜¯ç”±è°ƒç”¨æ–¹æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå’Œåˆ‡æ¢çš„è¿‡ç¨‹ã€‚python ä¸­çš„åç¨‹æ˜¯ç”±ç”Ÿæˆå™¨è½¬åŒ–è€Œæ¥ï¼Œå³é€šè¿‡æ‰©å±•ç”Ÿæˆå™¨çš„åŠŸèƒ½æ¥å®ç°åç¨‹ã€‚</p><p>pythonä¸­ï¼Œç”Ÿæˆå™¨å’Œåç¨‹ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨äº† yield å…³é”®å­—çš„å‡½æ•°ï¼Œä½†æ˜¯é€šå¸¸æ¥è¯´ï¼Œç”Ÿæˆå™¨ä»…ä»…æ˜¯å‘å¤–éƒ¨è¾“å‡ºæ•°æ®ï¼Œå¹¶å°†ä»£ç çš„æ‰§è¡Œäº¤ç»™è°ƒç”¨æ–¹ï¼Œåç¨‹ä¸ä»…å¯ä»¥å‘å¤–éƒ¨è¾“å‡ºæ•°æ®ï¼Œè¿˜èƒ½é€šè¿‡ send() æ–¹æ³•æ¥æ”¶å¤–éƒ¨ä¼ è¿›æ¥çš„æ•°æ®ï¼Œå³ yield data å’Œ x = yield dataã€‚yield ç±»ä¼¼äºä¸€ç§æ§åˆ¶æµç¨‹çš„æ–¹å¼ã€‚</p><h1 id="yield-from"><a href="#yield-from" class="headerlink" title="yield from"></a>yield from</h1><p>ä¸€ä¸ªå«æœ‰ yield from çš„æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä¸ yield ä¸åŒçš„æ˜¯ï¼Œyield from åé¢å¦‚æœè·Ÿä¸€ä¸ªç”Ÿæˆå™¨ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªç”Ÿæˆå™¨ï¼Œè€Œä¸å†éœ€è¦ next() å‡½æ•°ã€‚yield from åé¢ä¹Ÿå¯ä¸€è·Ÿä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæ­¤æ—¶ç›¸æ¯”äº for å¾ªç¯åŠ  yield è¾“å‡ºæ•°æ®è¦æ–¹ä¾¿ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test01</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""yield from åé¢å¯ä»¥è·Ÿä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"ok"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test02</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""yield from åé¢è·Ÿä¸€ä¸ªç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print(<span class="string">"=====start====="</span>)</span><br><span class="line">    ret = <span class="keyword">yield</span> <span class="keyword">from</span> test01()</span><br><span class="line">    <span class="comment"># è¿˜å¯ä»¥è·å–å­ç”Ÿæˆå™¨çš„å€¼</span></span><br><span class="line">    print(<span class="string">"=====ret:"</span>, ret)</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    t = test02()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">"=====t1:"</span>, next(t))</span><br><span class="line">        print(<span class="string">"=====t2:"</span>, next(t))</span><br><span class="line">        print(<span class="string">"=====t3:"</span>, next(t))</span><br><span class="line">        print(<span class="string">"=====t4:"</span>, next(t))</span><br><span class="line">        print(<span class="string">"=====t5:"</span>, next(t))</span><br><span class="line">        print(<span class="string">"=====t6:"</span>, next(t))</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;t1: 1</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;t2: 2</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;t3: 3</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;t4: 4</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;t5: 5</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;ret: ok</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œç”Ÿæˆå™¨ test02() é‡Œé¢åµŒå¥—äº†ä¸€ä¸ªç”Ÿæˆå™¨ test01()ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ•´ç†ä¸‹ Python3 ä¸­ç”Ÿæˆå™¨å’Œåç¨‹çš„ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="python" scheme="http://wyzane.gitee.io/blog/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>openrestryçš„å®‰è£…</title>
    <link href="http://wyzane.gitee.io/blog/2020/08/30/openresty%E7%9A%84%E5%AE%89%E8%A3%85/"/>
    <id>http://wyzane.gitee.io/blog/2020/08/30/openresty%E7%9A%84%E5%AE%89%E8%A3%85/</id>
    <published>2020-08-30T01:18:00.000Z</published>
    <updated>2020-09-06T07:45:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>OpenResty æ˜¯ä¸€ä¸ªåŸºäº Nginx çš„å¯ä¼¸ç¼©çš„ Web å¹³å°ï¼Œæä¾›äº†å¾ˆå¤šé«˜è´¨é‡çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼›å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Web åº”ç”¨æœåŠ¡å™¨ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€è°ƒç”¨ Nginx æ”¯æŒçš„å„ç§ C ä»¥åŠ Lua æ¨¡å—ã€‚</p><p>ä»Šå¤©ä»‹ç»ä¸‹ OpenResty åœ¨ Ubuntu 1804 ä¸Šçš„å®‰è£…ã€‚</p><a id="more"></a><h1 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h1><p>å®‰è£…ä¾èµ–æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libpcre3-dev libssl-dev perl make build-essential curl</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E: py3compile:243: Requested versions are not installed</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å®‰è£…çš„ python3 ç‰ˆæœ¬ä¸ py3compile ä¸ä¸€è‡´å¼•èµ·çš„ï¼Œpy3compile æ˜¯å±äº python3-minimal çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å®‰è£…å¯¹åº”çš„ python3-minimal å³å¯ã€‚python3-minimal çš„ä¸‹è½½åœ°å€ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;mirrors.edge.kernel.org&#x2F;ubuntu&#x2F;pool&#x2F;main&#x2F;p&#x2F;python3-defaults&#x2F;</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i python3-minimal_3.6.7-1~18.04_amd64.deb</span><br></pre></td></tr></table></figure><p>å®‰è£… python3-minimal å¯èƒ½è¿˜ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;info&#x2F;python3-minimal.postinst: py3compile: not found</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºå®‰è£…è¿‡ç¨‹ä¸­ï¼Œpython3-minimal ä¼šå¯»æ‰¾ python3.6ï¼ˆæ ¹æ®å®‰è£…ç‰ˆæœ¬ä¸åŒè€Œä¸åŒï¼‰ï¼Œæˆ‘çš„ç³»ç»Ÿä¸­ /usr/bin ä¸‹åªæœ‰python3ï¼Œè¿™æ—¶å€™æ·»åŠ ä¸€ä¸ª python3.6 çš„è½¯é“¾æ¥å³å¯ã€‚</p><h1 id="ä¸‹è½½åŠå®‰è£…"><a href="#ä¸‹è½½åŠå®‰è£…" class="headerlink" title="ä¸‹è½½åŠå®‰è£…"></a>ä¸‹è½½åŠå®‰è£…</h1><p>ä¾èµ–å®‰è£…å®Œæˆåï¼Œå¯ä»¥åˆ°ä»¥ä¸‹åœ°å€ä¸‹è½½ç›¸åº”ç‰ˆæœ¬çš„ OpenResty ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;openresty.org&#x2F;cn&#x2F;download.html</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåï¼Œè§£å‹ç¼©ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf openresty-1.17.8.2.tar.gz</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œé…ç½®åŠå®‰è£…å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty --with-luajit</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œåœ¨ /usr/local ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª openrestry ç›®å½•ï¼Œé‡Œé¢å°±è¡Œ openrestry çš„ä¸€äº›æºç æ–‡ä»¶ã€é…ç½®æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>å…¶å®ƒç³»ç»Ÿçš„å®‰è£…æ­¥éª¤å¯ä»¥å‚è€ƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;openresty.org&#x2F;cn&#x2F;installation.html</span><br></pre></td></tr></table></figure><h1 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h1><h2 id="hello-worldçš„ä¾‹å­"><a href="#hello-worldçš„ä¾‹å­" class="headerlink" title="hello worldçš„ä¾‹å­"></a>hello worldçš„ä¾‹å­</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨ /usr/local/openresty ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ conf/openrestry.conf é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"><span class="attribute">error_log</span> logs/error.log;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line">            <span class="section">content_by_lua_block</span> &#123;</span><br><span class="line">                ngx.say("&lt;p&gt;hello, world&lt;/p&gt;")</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨ openrestry æœåŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo .&#x2F;nginx -c &#x2F;usr&#x2F;local&#x2F;openresty&#x2F;conf&#x2F;openrestry.conf</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ï¼Œè¯·æ±‚ openrestry æœåŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;localhost:8080&#x2F;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚åï¼Œä¼šè¿”å›ä¸‹é¢çš„ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;hello, world&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure><h2 id="æ¥æ”¶è¯·æ±‚å‚æ•°"><a href="#æ¥æ”¶è¯·æ±‚å‚æ•°" class="headerlink" title="æ¥æ”¶è¯·æ±‚å‚æ•°"></a>æ¥æ”¶è¯·æ±‚å‚æ•°</h2><p>openresty ä¸­æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„é…ç½®ä¸ºï¼š</p><p>conf/params.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> /test &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line">            <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">                local params = ngx.req.get_uri_args();</span></span><br><span class="line"><span class="string">                ngx.print(params.name);</span></span><br><span class="line"><span class="string">                ngx.print(params.age);</span></span><br><span class="line"><span class="string">            '</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç»ˆç«¯è¯·æ±‚ <a href="http://localhost:8080/test/?name=aaa&amp;age=12" target="_blank" rel="noopener">http://localhost:8080/test/?name=aaa&amp;age=12</a> æ—¶ï¼Œè¿”å›çš„å†…å®¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa12</span><br></pre></td></tr></table></figure><p>ngx.req.get_uri_args çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">args, err &#x3D; ngx.req.get_uri_args()ï¼Œç”¨äºè·å–å®¢æˆ·ç«¯è¯·æ±‚ uri ä¸­çš„å‚æ•°ã€‚</span><br><span class="line"></span><br><span class="line">å®ƒçš„è¯´æ˜æ–‡æ¡£ä¸ºï¼šhttps:&#x2F;&#x2F;github.com&#x2F;openresty&#x2F;lua-nginx-module#ngxreqget_uri_args</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œngx.print() å‡½æ•°çš„åŠŸèƒ½æ˜¯å°†å‚æ•°ä½œä¸ºå“åº”ä½“è¿”å›ç»™è°ƒç”¨çš„å®¢æˆ·ç«¯ï¼Œæœªè¿”å›å“åº”å¤´æ—¶ï¼Œé¦–å…ˆè¿”å›å“åº”å¤´ï¼Œå†è¿”å›å“åº”ä½“ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ª ngx.say() æ–¹æ³•ï¼Œå®ƒä¸ ngx.print() æ–¹æ³•çš„åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ ngx.say() æœ€åä¼šè¿”å›ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚</p><p>ä¸Šé¢çš„æ–¹æ³• ngx.req.get_uri_args() æ˜¯æ¥æ”¶ get è¯·æ±‚çš„å‚æ•°ï¼Œæ¥æ”¶ post è¯·æ±‚å‚æ•°çš„é…ç½®ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> /test &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line">            <span class="section">content_by_lua_block</span> &#123;</span><br><span class="line">                ngx.req.read_body();</span><br><span class="line">                <span class="attribute">local</span> params = ngx.req.get_post_args();</span><br><span class="line">                ngx.say(params.name);</span><br><span class="line">                ngx.say(params.age);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;localhost:8080&#x2F;test -X POST -d &#39;name&#x3D;aaa&amp;age&#x3D;12&#39;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaa</span><br><span class="line">12</span><br></pre></td></tr></table></figure><p>æ¥æ”¶ post è¯·æ±‚ä½¿ç”¨çš„æ˜¯ ngx.req.get_post_args()ã€‚ï¼Œåœ¨ä½¿ç”¨è¯¥æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è°ƒç”¨æ–¹æ³•ï¼šngx.req.read_body()ã€‚ngx.req.read_body() çš„ä½œç”¨æ˜¯ï¼šåœ¨ä¸é˜»å¡ nginx event loop çš„è¯·æ±‚ä¸‹ï¼Œå¼‚æ­¥è¯»å–å®¢æˆ·ç«¯çš„è¯·æ±‚ä½“æ•°æ®ã€‚</p><h2 id="å†…éƒ¨è°ƒç”¨"><a href="#å†…éƒ¨è°ƒç”¨" class="headerlink" title="å†…éƒ¨è°ƒç”¨"></a>å†…éƒ¨è°ƒç”¨</h2><p>åœ¨ openresty ä¸­ï¼Œå¯ä»¥è¿›è¡Œå†…éƒ¨ location ä¹‹é—´çš„è°ƒç”¨ï¼Œé…ç½®ä¾‹å­å¦‚ä¸‹ï¼š</p><p>conf/inner.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> /test &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line">            <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">                local res = ngx.location.capture(</span></span><br><span class="line"><span class="string">                    "/getname", &#123;args=&#123;name=ngx.var["arg_name"], age=18&#125;&#125;</span></span><br><span class="line"><span class="string">                )</span></span><br><span class="line"><span class="string">                ngx.say(ngx.var["arg_name"]);</span></span><br><span class="line"><span class="string">                ngx.say("status:", res.status, " resp:", res.body)</span></span><br><span class="line"><span class="string">            '</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> /getname &#123;</span><br><span class="line">            <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">                local params = ngx.req.get_uri_args();</span></span><br><span class="line"><span class="string">                ngx.print(params.name);</span></span><br><span class="line"><span class="string">            '</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“è®¿é—® <a href="http://localhost:8080/test/?name=xxx" target="_blank" rel="noopener">http://localhost:8080/test/?name=xxx</a> æ—¶ï¼Œä¼šæ‰“å°å‡ºä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxx</span><br><span class="line">status:200 resp:aaa</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¸­ï¼Œngx.location.capture çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åŠŸèƒ½ï¼šåœ¨ nginx å†…éƒ¨è°ƒç”¨å…¶å®ƒ location å—</span><br><span class="line">è¯­æ³•ï¼šres &#x3D; ngx.location.capture(uri, options)</span><br><span class="line">ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå®ƒçš„ä½œç”¨åŸŸæ˜¯ content_by_lua å¼€å¤´çš„æ¨¡å—</span><br><span class="line"></span><br><span class="line">ngx.location.capture ä¼šè¿”å›ä¸€ä¸ª lua table å¯¹è±¡ï¼Œæœ‰ä»¥ä¸‹4ä¸ªå±æ€§ï¼šres.status, res.header, res.body, and res.truncated</span><br><span class="line"></span><br><span class="line">ngx.location.capture çš„è¯´æ˜æ–‡æ¡£ä¸ºï¼šhttps:&#x2F;&#x2F;github.com&#x2F;openresty&#x2F;lua-nginx-module#ngxlocationcapture</span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®šluaè„šæœ¬æ–‡ä»¶"><a href="#æŒ‡å®šluaè„šæœ¬æ–‡ä»¶" class="headerlink" title="æŒ‡å®šluaè„šæœ¬æ–‡ä»¶"></a>æŒ‡å®šluaè„šæœ¬æ–‡ä»¶</h2><p>åœ¨ openresty çš„ location ä¸­ï¼Œå¯ä»¥æŒ‡å®š lua è„šæœ¬æ¥æ‰§è¡Œï¼Œé…ç½®ä¾‹å­ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> = /test &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line"></span><br><span class="line">            <span class="attribute">content_by_lua_file</span> /usr/local/openresty/lua_code/test.lua;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ content_by_lua_file æ¥æŒ‡å®šè¯·æ±‚è¿›æ¥æ—¶éœ€è¦è¿è¡Œçš„ lua è„šæœ¬æ–‡ä»¶ã€‚</p><p>test.lua çš„å†…å®¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngx.say(&quot;lua test file&quot;);</span><br></pre></td></tr></table></figure><p>åœ¨ç»ˆç«¯æ‰§è¡Œ  curl <a href="http://localhost:8080/test" target="_blank" rel="noopener">http://localhost:8080/test</a> åï¼Œä¼šè¿”å› lua test fileã€‚</p><h2 id="è¿æ¥redis"><a href="#è¿æ¥redis" class="headerlink" title="è¿æ¥redis"></a>è¿æ¥redis</h2><p>openresty ä¸­é€šè¿‡ lua è¿æ¥ redis çš„ä¾‹å­å¦‚ä¸‹ï¼šredis.luaï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">-- redis use</span><br><span class="line"></span><br><span class="line">local resty_redis &#x3D; require(&#39;resty.redis&#39;)</span><br><span class="line">local redis &#x3D; resty_redis:new()</span><br><span class="line"></span><br><span class="line">redis:settimeout(1000)</span><br><span class="line"></span><br><span class="line">local ok, err &#x3D; redis:connect(&#39;127.0.0.1&#39;, 6379)</span><br><span class="line">if not ok then</span><br><span class="line">        ngx.say(err)</span><br><span class="line">        ngx.eof()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">-- è¿æ¥ redis åè¿›è¡Œå¯†ç éªŒè¯</span><br><span class="line">local res, err &#x3D; redis:auth(&#39;wyzane&#39;)</span><br><span class="line">if not res then</span><br><span class="line">        ngx.say(&quot;failed to auth:&quot;, err)</span><br><span class="line">        return</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">local res, err &#x3D; redis:get(&quot;name&quot;)</span><br><span class="line">if not res then</span><br><span class="line">        ngx.say(&quot;failed to get name:&quot;, err)</span><br><span class="line">        return</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ngx.say(res)</span><br><span class="line"></span><br><span class="line">local ok, err &#x3D; redis:set_keepalive(10000, 100)</span><br><span class="line">if not ok then</span><br><span class="line">        ngx.say(&quot;failed to set keeplive:&quot;, err)</span><br><span class="line">        return</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>redis.confï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 8080;</span><br><span class="line"></span><br><span class="line">        location &#x3D; &#x2F;test &#123;</span><br><span class="line">            default_type text&#x2F;html;</span><br><span class="line"></span><br><span class="line">            content_by_lua_file &#x2F;home&#x2F;wyzane&#x2F;lua_code&#x2F;redis.lua;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿æ¥mysql"><a href="#è¿æ¥mysql" class="headerlink" title="è¿æ¥mysql"></a>è¿æ¥mysql</h2><p>openresty ä¸­ä½¿ç”¨ lua è¿æ¥ mysql çš„ä¾‹å­å¦‚ä¸‹ï¼šmysql.luaï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- mysql use</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> resty_mysql = <span class="built_in">require</span>(<span class="string">"resty.mysql"</span>)</span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span>(<span class="string">"cjson"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> db, err = resty_mysql:new()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> db <span class="keyword">then</span></span><br><span class="line">        ngx.say(<span class="string">'init mysql failed'</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">db:set_timeout(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ok, err, errcode, sqlstate = db:connect(&#123;</span><br><span class="line">    host = <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    post = <span class="number">3306</span>,</span><br><span class="line">    database = <span class="string">"test_koa"</span>,</span><br><span class="line">    user = <span class="string">"root"</span>,</span><br><span class="line">    password = <span class="string">"wyzane"</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">        ngx.say(<span class="string">"failed to connect mysql:"</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res, err, errcode, sqlstate = db:query(<span class="string">"select * from tb_user"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> res <span class="keyword">then</span></span><br><span class="line">        nga.say(<span class="string">"query failed:"</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">db:set_keepalive(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">ngx.say(cjson.encode(res))</span><br></pre></td></tr></table></figure><p>mysql.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> = /test &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line"></span><br><span class="line">            <span class="attribute">content_by_lua_file</span> /home/wyzane/lua_code/mysql.lua;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Openresty å®˜ç½‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;openresty.org&#x2F;cn&#x2F;</span><br></pre></td></tr></table></figure><p>Openrestyçš„ github åœ°å€ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;openresty</span><br></pre></td></tr></table></figure><p>Openrestyæœ€ä½³å®è·µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.kancloud.cn&#x2F;allanyu&#x2F;openresty-best-practices&#x2F;82658</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;OpenResty æ˜¯ä¸€ä¸ªåŸºäº Nginx çš„å¯ä¼¸ç¼©çš„ Web å¹³å°ï¼Œæä¾›äº†å¾ˆå¤šé«˜è´¨é‡çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼›å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Web åº”ç”¨æœåŠ¡å™¨ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€è°ƒç”¨ Nginx æ”¯æŒçš„å„ç§ C ä»¥åŠ Lua æ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©ä»‹ç»ä¸‹ OpenResty åœ¨ Ubuntu 1804 ä¸Šçš„å®‰è£…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="http://wyzane.gitee.io/blog/categories/Nginx/"/>
    
    
  </entry>
  
  <entry>
    <title>nginxä¸­å¤„ç†httpè¯·æ±‚çš„æµç¨‹</title>
    <link href="http://wyzane.gitee.io/blog/2020/08/02/nginx%E4%B8%AD%E5%A4%84%E7%90%86http%E8%AF%B7%E6%B1%82%E7%9A%84%E6%B5%81%E7%A8%8B/"/>
    <id>http://wyzane.gitee.io/blog/2020/08/02/nginx%E4%B8%AD%E5%A4%84%E7%90%86http%E8%AF%B7%E6%B1%82%E7%9A%84%E6%B5%81%E7%A8%8B/</id>
    <published>2020-08-02T13:27:23.000Z</published>
    <updated>2023-02-26T08:50:52.339Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ€»ç»“ä¸‹ nginx å¤„ç†httpè¯·æ±‚çš„æµç¨‹ï¼Œé‡ç‚¹ä»‹ç»ä¸‹å¤„ç† http è¯·æ±‚çš„11ä¸ªé˜¶æ®µã€‚</p><p>nginx å¤„ç† http è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¼šå¯¹è¯·æ±‚è¡Œå’Œè¯·æ±‚ä½“è¿›è¡Œè§£æï¼Œè§£æå®Œæˆåè¿›å…¥11 ä¸ªé˜¶æ®µï¼Œè¿™ 11 ä¸ªé˜¶æ®µä¼šæ ¹æ® nginx.conf ä¸­çš„é…ç½®ä¿¡æ¯è¿›è¡Œç›¸åº”çš„é‡å®šå‘ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ç­‰æ“ä½œã€‚</p><a id="more"></a><h1 id="httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ"><a href="#httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ" class="headerlink" title="httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ"></a>httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST_READï¼šè¯»å–åˆ°è¯·æ±‚å¤´ä¹‹åä¼šè¿›å…¥è¯¥é˜¶æ®µï¼Œrealipæ¨¡å—åœ¨è¯¥é˜¶æ®µä½¿ç”¨</span><br><span class="line">SERVER_REWRITEï¼šæ‰§è¡Œserverå—å†…ï¼Œlocationå—å¤–çš„æŒ‡ä»¤ï¼Œrewrite æ¨¡å—åœ¨è¯¥é˜¶æ®µç”Ÿæ•ˆ</span><br><span class="line">FIND_CONFIGï¼šæ ¹æ®é…ç½®ï¼Œå¯»æ‰¾å¯¹åº”çš„ location å—å¹¶æ‰§è¡Œ</span><br><span class="line">REWRITEï¼šæ‰§è¡Œ location å—ä¸­çš„é‡å†™æŒ‡ä»¤</span><br><span class="line">POST_REWRITEï¼šæ ¹æ®ä¸Šé˜¶æ®µçš„é‡å†™æŒ‡ä»¤è·³è½¬åˆ°åˆé€‚çš„é˜¶æ®µ</span><br><span class="line">PREACCESSï¼šè®¿é—®æƒé™æ§åˆ¶ä¹‹å‰çš„é˜¶æ®µï¼Œæ‰§è¡Œè®¿é—®é¢‘ç‡ã€è¿æ¥æ•°ç­‰æ§åˆ¶</span><br><span class="line">ACCESSï¼šè®¿é—®æƒé™çš„æ§åˆ¶é˜¶æ®µï¼Œä¾‹å¦‚åŸºäºipé»‘åå•çš„æƒé™æ§åˆ¶</span><br><span class="line">POST_ACCESSï¼šè®¿é—®æƒé™æ§åˆ¶çš„åä¸€é˜¶æ®µï¼Œè¯¥é˜¶æ®µæ ¹æ®æƒé™æ§åˆ¶é˜¶æ®µçš„æ‰§è¡Œç»“æœè¿›è¡Œç›¸åº”å¤„ç†</span><br><span class="line">PRECONTENTï¼štry_filesæŒ‡ä»¤çš„å¤„ç†é˜¶æ®µï¼Œå¦‚æœæ²¡æœ‰é…ç½®try_filesæŒ‡ä»¤ï¼Œåˆ™è¯¥é˜¶æ®µè¢«è·³è¿‡</span><br><span class="line">CONTENTï¼šå†…å®¹ç”Ÿæˆé˜¶æ®µï¼Œè¯¥é˜¶æ®µäº§ç”Ÿå“åº”ï¼Œå¹¶å‘é€åˆ°å®¢æˆ·ç«¯</span><br><span class="line">LOGï¼šè®°å½•è®¿é—®æ—¥å¿—</span><br></pre></td></tr></table></figure><p>å„ä¸ªè¯·æ±‚é˜¶æ®µçš„é¡ºåºå¦‚ä¸‹ï¼š</p><p><img src="nginx%E5%A4%84%E7%90%86http%E8%AF%B7%E6%B1%82%E7%9A%8411%E4%B8%AA%E9%98%B6%E6%AE%B52.png" alt="nginxå¤„ç†httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ2"></p><p>ä¸Šé¢ç®€å•ä»‹ç»äº† nginx å¤„ç† http è¯·æ±‚çš„å„ä¸ªé˜¶æ®µï¼Œä»¥åŠå„ä¸ªé˜¶æ®µä½¿ç”¨åˆ°çš„æ¨¡å—ï¼ˆå¯¼æ•°ç¬¬äºŒè¡Œæ˜¯ content é˜¶æ®µï¼Œæœ€åä¸€è¡Œæ˜¯ log é˜¶æ®µï¼‰ã€‚ä¸‹é¢å…·ä½“ä»‹ç»å„ä¸ªé˜¶æ®µçš„åŠŸèƒ½ã€‚</p><h2 id="POST-READ"><a href="#POST-READ" class="headerlink" title="POST_READ"></a>POST_READ</h2><p>è§£æå®Œè¯·æ±‚ä½“åï¼Œé¦–å…ˆä¼šè¿›å…¥ post_read é˜¶æ®µï¼Œè¯¥é˜¶æ®µä¸»è¦è·å–å®¢æˆ·ç«¯çœŸå® ipã€‚</p><h3 id="realipæ¨¡å—"><a href="#realipæ¨¡å—" class="headerlink" title="realipæ¨¡å—"></a>realipæ¨¡å—</h3><p>realip æ¨¡å—åœ¨ POST_READ èŠ‚ç‚¹ç”Ÿæ•ˆï¼Œå¯ä»¥ç”¨æ¥è·å–å®¢æˆ·ç«¯çš„çœŸå® ip åœ°å€ã€‚</p><p>åœ¨ http è¯·æ±‚ä¸­ï¼Œå¯ä»¥é€šè¿‡è¯·æ±‚å¤´ä¸­çš„ X-Forwarded-For å’Œ X-Real-IP è·å– ip åœ°å€ï¼ŒX-Forwarded-For ä¸­å¯èƒ½ä¿å­˜äº†å¤šä¸ª</p><p>ipï¼ŒX-Real-IP ä¸­ä¿å­˜äº†å®¢æˆ·ç«¯çš„çœŸå® ipã€‚realip æ¨¡å—ä¼šæŠŠä» X-Forwarded-For å’Œ X-Real-IP è·å–çš„å€¼èµ‹å€¼åˆ° nginx å˜é‡ binary_remote_addr å’Œ remote_addr ä¸­ï¼Œä»è€Œé€šè¿‡è¿™ä¸¤ä¸ªå˜é‡å°±èƒ½è·å–å®¢æˆ·ç«¯çœŸå® ip åœ°å€ï¼Œåç»­ä¼šè¿›ä¸€æ­¥åšé™æµã€é™é€Ÿç­‰å·¥ä½œï¼ˆåœ¨ limit_conn æ¨¡å—ä¸­ï¼‰ã€‚</p><p>realip æ¨¡å—é»˜è®¤æ²¡æœ‰ç¼–è¯‘è¿› nginx ï¼Œå¯ä»¥é€šè¿‡ â€“with-http_realip_module å‚æ•°å°†å…¶ç¼–è¯‘è¿› nginxã€‚</p><p>realip ä¸­çš„æŒ‡ä»¤ï¼ˆå…·ä½“è¯´æ˜å¯ä»¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://nginx.org/en/docs/http/ngx_http_realip_module.htmlï¼‰" target="_blank" rel="noopener">http://nginx.org/en/docs/http/ngx_http_realip_module.htmlï¼‰</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. set_real_ip_from addr|CIDR|unix;</span><br><span class="line">ä½œç”¨ï¼šè®¾ç½®ä¿¡ä»»åœ°å€ï¼Œä»è¯¥åœ°å€è¿‡æ¥çš„è¯·æ±‚ä¼šè¢«è·å–çœŸå®åœ°å€ï¼Œå¹¶æ›¿æ¢ remote_addr ä¸­çš„å€¼</span><br><span class="line">ä¾‹å­ï¼šset_real_ip_from  192.168.1.0&#x2F;24|192.168.2.1;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. real_ip_header field | X-Real-IP | X-Forwarded-For | proxy_protocol;</span><br><span class="line">ä½œç”¨ï¼šä»è¯·æ±‚å¤´çš„å“ªä¸ªå‚æ•°ä¸­è·å–çœŸå®ip</span><br><span class="line">ä¾‹å­ï¼šreal_ip_header X-Real-IPï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. real_ip_recursive on | off;</span><br><span class="line">ä½œç”¨ï¼šè®¾ç½®ä¸º off æ—¶ï¼ŒåŒ¹é…ä¿¡ä»»åœ°å€ï¼ˆç”± set_real_ip_from è®¾ç½®ï¼‰çš„çœŸå®å®¢æˆ·ç«¯åœ°å€ä¼šè¢«ä¸€ä¸ªå€¼æ›¿æ¢ï¼Œè¿™ä¸ªå€¼æ˜¯ real_ip_header æŒ‡å®šçš„è¯·æ±‚å¤´å‚æ•°ä¸­æœ€åä¸€ä¸ªå€¼ï¼›ä¸º on æ—¶ï¼ŒçœŸå®å®¢æˆ·ç«¯åœ°å€ä¼šè¢«ä¸€ä¸ªéä¿¡ä»»å€¼æ›¿ä»£ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯ real_ip_header æŒ‡å®šçš„è¯·æ±‚å¤´å‚æ•°ä¸­çš„å€¼</span><br></pre></td></tr></table></figure><p>realip ä¸­æŒ‡ä»¤çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> realip.wzblogs.cn;</span><br><span class="line">    <span class="attribute">set_real_ip_from</span> <span class="number">223.73.212.4</span>;</span><br><span class="line">    <span class="attribute">real_ip_recursive</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="comment"># real_ip_recursive on;</span></span><br><span class="line">    <span class="attribute">real_ip_header</span> X-Forwarded-For;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">"client real ip isï¼š<span class="variable">$remote_addr</span>\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SERVER-REWRITE"><a href="#SERVER-REWRITE" class="headerlink" title="SERVER_REWRITE"></a>SERVER_REWRITE</h2><p>è¯¥é˜¶æ®µä¸­ï¼Œåœ¨ server å—å†…ï¼Œlocation å—å¤–çš„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œã€‚</p><h3 id="rewriteæ¨¡å—"><a href="#rewriteæ¨¡å—" class="headerlink" title="rewriteæ¨¡å—"></a>rewriteæ¨¡å—</h3><p>rewrite æ¨¡å—åœ¨ server_write é˜¶æ®µç”Ÿæ•ˆï¼Œè¯¥æ¨¡å—ä¸»è¦åŠŸèƒ½æ˜¯æ”¹å˜è¯·æ±‚ URIï¼Œä¸»è¦æœ‰ä»¥ä¸‹æŒ‡ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1. return code URL | return URL | return code [text]</span><br><span class="line">ä½œç”¨ï¼šåœæ­¢è¯·æ±‚çš„è®¿é—®ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯çŠ¶æ€ç å’Œé‡å®šå‘url</span><br><span class="line">ä¾‹å­ï¼šreturn 302 &#x2F;redirect_url;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šserver, location, if</span><br><span class="line"></span><br><span class="line">return ä¸­çš„ä¸€äº›çŠ¶æ€ç ï¼š</span><br><span class="line">HTTP 1.0ï¼š</span><br><span class="line">301 æ°¸ä¹…é‡å®šå‘ï¼ˆè®¿é—®ç«™ç‚¹aæ—¶ï¼Œè¢«é‡å®šå‘åˆ°ç«™ç‚¹bï¼Œåˆ™ä¸‹æ¬¡é‡åˆ°è®¿é—®ç«™ç‚¹açš„è¯·æ±‚å°±ä¼šç›´æ¥è®¿é—®ç«™ç‚¹bï¼‰</span><br><span class="line">302 ä¸´æ—¶é‡å®šå‘ï¼Œç¦æ­¢è¢«ç¼“å­˜ï¼ˆè®¿é—®ç«™ç‚¹aæ—¶ï¼Œè¢«é‡å®šå‘åˆ°ç«™ç‚¹bï¼Œåˆ™ä¸‹æ¬¡è¿˜ä¼šå…ˆè®¿é—®ç«™ç‚¹aï¼Œå†è¢«é‡å®šå‘åˆ°bï¼‰</span><br><span class="line"></span><br><span class="line">HTTP 1.1:</span><br><span class="line">303 ä¸´æ—¶é‡å®šå‘ï¼Œå…è®¸æ”¹å˜è¯·æ±‚æ–¹æ³•ï¼Œç¦æ­¢è¢«ç¼“å­˜</span><br><span class="line">307 ä¸´æ—¶é‡å®šå‘ï¼Œä¸å…è®¸æ”¹å˜è¯·æ±‚æ–¹æ³•ï¼Œç¦æ­¢è¢«ç¼“å­˜</span><br><span class="line">308 æ°¸ä¹…é‡å®šå‘ï¼Œä¸å…è®¸æ”¹å˜è¯·æ±‚æ–¹æ³•</span><br><span class="line"></span><br><span class="line">error_page æŒ‡ä»¤ä¸ return æŒ‡ä»¤çš„ä¸åŒ</span><br><span class="line">error_page code uri;</span><br><span class="line">ä½œç”¨ï¼šnginxæ¥æ”¶åˆ°æŒ‡å®šçŠ¶æ€ç æ—¶ï¼Œè¿”å›ç‰¹å®šçš„é¡µé¢æˆ–è€…uri</span><br><span class="line">ä¾‹å­ï¼š error_page 404 &#x2F;404.html;|error_page 500 501 502 503 &#x2F;50x.html;</span><br><span class="line">error_page 404 &#x3D;200 &#x2F;empty.gif (æ¥æ”¶åˆ°404æ—¶ï¼Œè¿”å›ä¸€å¼ å›¾ç‰‡ï¼Œå“åº”çŠ¶æ€ç æ˜¯200)</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, if in location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. rewrite regex replacement [flag]</span><br><span class="line">ä½œç”¨ï¼šç”¨äºä¿®æ”¹æ¥æ”¶åˆ°çš„uriï¼Œå¦‚æœå¦‚æœæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…uriï¼Œåˆ™åŒ¹é…çš„uriä¼šè¢«replacementæ›¿æ¢ã€‚å…¶ä¸­ flag æœ‰ä»¥ä¸‹å‡ ä¸ªå€¼ï¼šlast,break,redirect,permanent</span><br><span class="line">lastï¼š ä½¿ç”¨ replacement ç»§ç»­è¿›è¡Œ locationåŒ¹é…</span><br><span class="line">break: åœæ­¢å½“å‰è„šæœ¬æŒ‡ä»¤çš„æ‰§è¡Œï¼Œç­‰ä»·äºç‹¬ç«‹çš„ break æŒ‡ä»¤</span><br><span class="line">redirect: è¿”å›302é‡å®šå‘</span><br><span class="line">permanent: è¿”å›301é‡å®šå‘</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šserver, location, if</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. rewrite_log on | off;</span><br><span class="line">ä½œç”¨ï¼šæ˜¯å¦è®°å½• rewrite æ¨¡å—äº§ç”Ÿçš„æ—¥å¿—ï¼Œé»˜è®¤ä¸º offï¼Œä¸º on æ—¶ï¼Œä¼šå°†æ—¥å¿—è®°å½•åœ¨ error_log æŒ‡å®šçš„æ–‡ä»¶ä¸­</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, if</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4. if (condition) &#123; ... &#125;</span><br><span class="line">ä½œç”¨ï¼šåˆ¤æ–­å˜é‡çš„å€¼ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™æ‰§è¡Œ if å—ä¸­çš„å†…å®¹</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šserver, location</span><br><span class="line">conditionä¸­å¯ä»¥æœ‰ä¸‹é¢çš„åŠŸèƒ½ï¼š</span><br><span class="line">1. æ£€æŸ¥å˜é‡ä¸ºç©ºæˆ–è€…ä¸º0</span><br><span class="line">2. å°†å˜é‡ä¸å­—ç¬¦ä¸²åšåŒ¹é…ï¼Œä½¿ç”¨&#x3D;æˆ–è€…!&#x3D;</span><br><span class="line">3. å°†å˜é‡ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span><br><span class="line">4. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨ -f æˆ–è€… !-f</span><br><span class="line">5. æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨ -d æˆ–è€… !-d</span><br><span class="line">6. æ£€æŸ¥æ–‡ä»¶ã€ç›®å½•ã€è½¯é“¾æ¥æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨ -e æˆ–è€… !-e</span><br><span class="line">7. æ£€æŸ¥æ˜¯å¦ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨ -x æˆ–è€… !-x</span><br><span class="line"></span><br><span class="line">if ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œæ­£åˆ™è¡¨è¾¾å¼è§„åˆ™å¦‚ä¸‹ï¼š</span><br><span class="line">&#x3D;&#x3D;:ç­‰å€¼æ¯”è¾ƒ;</span><br><span class="line">~ï¼šä¸æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…æ—¶è¿”å›â€œçœŸâ€ï¼Œåˆ¤æ–­åŒ¹é…ä¸å¦æ—¶åŒºåˆ†å­—ç¬¦å¤§å°å†™ï¼›</span><br><span class="line">~*ï¼šä¸æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…æ—¶è¿”å›â€œçœŸâ€ï¼Œåˆ¤æ–­åŒ¹é…ä¸å¦æ—¶ä¸åŒºåˆ†å­—ç¬¦å¤§å°å†™ï¼›</span><br><span class="line">!~ï¼šä¸æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸åŒ¹é…æ—¶è¿”å›â€œçœŸâ€ï¼Œåˆ¤æ–­åŒ¹é…ä¸å¦æ—¶åŒºåˆ†å­—ç¬¦å¤§å°å†™ï¼›</span><br><span class="line">!~*ï¼šä¸æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸åŒ¹é…æ—¶è¿”å›â€œçœŸâ€ï¼Œåˆ¤æ–­åŒ¹é…ä¸å¦æ—¶ä¸åŒºåˆ†å­—ç¬¦å¤§å°å†™ï¼›</span><br></pre></td></tr></table></figure><h3 id="error-pageä¸returnçš„ä¼˜å…ˆçº§"><a href="#error-pageä¸returnçš„ä¼˜å…ˆçº§" class="headerlink" title="error_pageä¸returnçš„ä¼˜å…ˆçº§"></a>error_pageä¸returnçš„ä¼˜å…ˆçº§</h3><p>return.conf çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8095</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> html/;</span><br><span class="line">    <span class="attribute">error_page</span>  <span class="number">404</span> /<span class="number">403</span>.html;</span><br><span class="line">    <span class="comment"># return 405;</span></span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">        <span class="comment"># return 404 "find nothing\n";</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ nginx åï¼Œæ‰§è¡Œè¯·æ±‚ curl localhost:8095/xxxï¼Œä¼šç›´æ¥è¿”å› html/403.html ä¸­çš„å†…å®¹ï¼›å½“æ‰“å¼€ location å—ä¸­çš„ return åï¼Œä¼šè¿”å› â€œfind nothingâ€ï¼›åŒæ ·çš„ï¼Œå°† server å—ä¸­çš„ return æ‰“å¼€ï¼ŒåŒæ ·çš„è¯·æ±‚ï¼Œä¼šè¿”å› 405 çš„é”™è¯¯ï¼›è¿™è¯´æ˜ return æŒ‡ä»¤ä¼šè¦†ç›– å®ƒå‰é¢çš„ error_page æŒ‡ä»¤ã€‚</p><h3 id="rewriteä¸returnçš„ä½¿ç”¨"><a href="#rewriteä¸returnçš„ä½¿ç”¨" class="headerlink" title="rewriteä¸returnçš„ä½¿ç”¨"></a>rewriteä¸returnçš„ä½¿ç”¨</h3><p>ä¸‹é¢çœ‹ä¸€ä¸ª rewrite æŒ‡ä»¤çš„ä½¿ç”¨ä¾‹å­ï¼Œrewrite.conf é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8096</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> html/;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /first &#123;</span><br><span class="line">        <span class="attribute">rewrite</span> /first(.*) /second<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'first\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /second &#123;</span><br><span class="line">        <span class="attribute">rewrite</span> /second(.*) /third<span class="variable">$1</span>;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'second\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /third &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'third\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> /redirect &#123;</span><br><span class="line">        <span class="attribute">rewrite</span> /redirect(.*) <span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œhtml ç›®å½•çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ 403.html</span><br><span class="line">â”œâ”€â”€ 50x.html</span><br><span class="line">â”œâ”€â”€ first</span><br><span class="line">â”‚Â Â  â””â”€â”€ 1.txt</span><br><span class="line">â”œâ”€â”€ index.html</span><br><span class="line">â”œâ”€â”€ second</span><br><span class="line">â”‚Â Â  â””â”€â”€ 2.txt</span><br><span class="line">â””â”€â”€ third</span><br><span class="line">    â””â”€â”€ 3.txt</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ nginx æœåŠ¡åï¼Œæ‰§è¡Œ curl localhost:8096/first/3.txtï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">second</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå…ˆåŒ¹é…åˆ°äº† location /firstï¼Œç„¶åå†å»åŒ¹é… location /secondï¼Œæœ€åæ‰§è¡Œäº† return æŒ‡ä»¤ï¼Œè¿”å›äº†ç»“æœã€‚</p><p>åœ¨ location /second ä¸­çš„ rewrite æŒ‡ä»¤ååŠ ä¸Š break åï¼Œè¿”å›çš„å†…å®¹å°±æ˜¯ third/3.txt æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæ­¤æ—¶è¯´æ˜ break æŒ‡ä»¤ç”Ÿæ•ˆäº†ï¼Œæ­¤æ—¶è®¿é—®  curl localhost:8096/second/3.txt ä¹Ÿä¼šå¾—åˆ°ç›¸åŒç»“æœã€‚</p><h3 id="if-æŒ‡ä»¤ä½¿ç”¨ä¾‹å­"><a href="#if-æŒ‡ä»¤ä½¿ç”¨ä¾‹å­" class="headerlink" title="if æŒ‡ä»¤ä½¿ç”¨ä¾‹å­"></a>if æŒ‡ä»¤ä½¿ç”¨ä¾‹å­</h3><p>if æŒ‡ä»¤ä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼Œserver_if.confï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 8097;</span><br><span class="line"></span><br><span class="line">    if ($request_uri ~* &#x2F;aaa&#x2F;test.html)&#123;</span><br><span class="line">        return 200 &quot;test.html returned\n&quot;;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        return 200 &quot;location returned\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œ curl localhost:8097/aaa/test.html æ—¶ï¼Œä¼šè¿›å…¥ if å—ä¸­ï¼Œè¿”å› test.html returnedã€‚</p><h2 id="FIND-CONFIG"><a href="#FIND-CONFIG" class="headerlink" title="FIND_CONFIG"></a>FIND_CONFIG</h2><p>find_config é˜¶æ®µä¸»è¦åŠŸèƒ½æ˜¯é€‰æ‹©å“ªä¸ª location å—ï¼Œå¹¶æ‰§è¡Œ location å—ä¸­çš„é…ç½®ã€‚location å—ä¸­å¸¸ç”¨æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">location </span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šserverï¼Œlocation</span><br><span class="line">location åé¢å¯ä»¥è·Ÿä»¥ä¸‹æ•°æ®ï¼š</span><br><span class="line">1. å‰ç¼€å­—ç¬¦ä¸²</span><br><span class="line">&#x3D;ï¼šç²¾ç¡®åŒ¹é…</span><br><span class="line">^~ï¼šåŒ¹é…æˆåŠŸåï¼Œåˆ™ä¸å†è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span><br><span class="line">å¸¸è§„å­—ç¬¦ä¸²</span><br><span class="line">2. æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">~ï¼šå¤§å°å†™æ•æ„Ÿ</span><br><span class="line">~*ï¼šå¿½ç•¥å¤§å°å†™</span><br><span class="line">3. å†…éƒ¨è·³è½¬çš„å‘½ålocationï¼ˆä½¿ç”¨@ç¬¦å· + åç§°ï¼‰</span><br></pre></td></tr></table></figure><p>å½“ nginx ä¸­é…ç½®äº†å¤šä¸ª location å—æ—¶ï¼Œå®ƒçš„åŒ¹é…è§„åˆ™æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. é¦–å…ˆä¼šéå†æ‰€æœ‰å‰ç¼€å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°åŒ¹é…çš„ location ï¼ˆä¸ location é¡ºåºæ— å…³ï¼‰</span><br><span class="line">1ï¼‰&#x3D; ç²¾ç¡®åŒ¹é…ä¼˜å…ˆçº§æœ€é«˜</span><br><span class="line">2ï¼‰æ²¡æœ‰ç²¾ç¡®åŒ¹é…æ—¶ä½¿ç”¨ ^~ åŒ¹é…ä¸Šçš„location</span><br><span class="line">3ï¼‰å½“æœ‰å¤šä¸ªåŒ¹é…ä¸Šæ—¶ï¼Œé€‰æ‹© location ä¸­ url æœ€é•¿çš„åŒ¹é… </span><br><span class="line">2. æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ˆæ­¤æ—¶ä¼šæ ¹æ® location çš„é¡ºåºè¿›è¡ŒåŒ¹é…ï¼‰</span><br><span class="line">1ï¼‰æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…ä¸Šåˆ™ä½¿ç”¨è¯¥ location</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çœ‹ä¸€ä¸‹ location æŒ‡ä»¤ä½¿ç”¨çš„å…·ä½“ä¾‹å­ï¼Œlocation.confçš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8099</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1</span></span><br><span class="line">    <span class="attribute">location</span> /aaa &#123;</span><br><span class="line">        <span class="comment"># å‰ç¼€åŒ¹é…</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'prefix string match\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /aaa/$</span> &#123;</span><br><span class="line">        <span class="comment"># æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå¤§å°å†™æ•æ„Ÿ</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'regex strict match\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~* /aaa/$</span> &#123;</span><br><span class="line">        <span class="comment"># æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå¿½ç•¥å¤§å°å†™</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'regex none strice match\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4</span></span><br><span class="line">    <span class="attribute">location</span> /aaa/bbb &#123;</span><br><span class="line">        <span class="comment"># å‰ç¼€æœ€é•¿åŒ¹é…</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'long prefix string match\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~* /aaa/(\w+)$</span> &#123;</span><br><span class="line">        <span class="comment"># æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'long regex match\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /aaa$</span> &#123;</span><br><span class="line">        <span class="comment"># æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'regex match\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 7</span></span><br><span class="line">    <span class="attribute">location</span> = /aaa &#123;</span><br><span class="line">        <span class="comment"># ç²¾ç¡®åŒ¹é…</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'exatc match\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 8</span></span><br><span class="line">    <span class="attribute">location</span><span class="regexp"> ^~</span> /aaa &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'^~ match \n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒ¹é…ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å½“æœ‰å‰ç¼€åŒ¹é…ã€æ­£åˆ™åŒ¹é…ã€^~åŒ¹é…ã€ç²¾ç¡®åŒ¹é…æ—¶ï¼Œä¼˜å…ˆç²¾ç¡®åŒ¹é…ã€å…¶æ¬¡^~åŒ¹é…ã€ç„¶åæ­£åˆ™åŒ¹é…ã€æœ€åå‰ç¼€åŒ¹é…ï¼Œå¯¹åº”ä¸Šé¢é…ç½®çš„é¡ºåºä¸º7861</span><br><span class="line">curl localhost:8099&#x2F;aaa                                 </span><br><span class="line">å“åº”ï¼šexatc match</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æ­£åˆ™åŒ¹é…ï¼Œä¼˜å…ˆåŒ¹é…åŒºåˆ†å¤§å°å†™çš„é…ç½®</span><br><span class="line">curl localhost:8099&#x2F;aaa&#x2F;                                </span><br><span class="line">å“åº”ï¼šregex strict match</span><br><span class="line"></span><br><span class="line"># æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line">curl localhost:8099&#x2F;Aaa&#x2F;</span><br><span class="line">å“åº”ï¼šregex none strice match</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æ­£åˆ™åŒ¹é…ï¼Œä¼˜å…ˆåŒ¹é…5ä¸­çš„é…ç½®è€Œä¸æ˜¯4</span><br><span class="line">curl localhost:8099&#x2F;aaa&#x2F;bbb</span><br><span class="line">å“åº”ï¼šlong regex match</span><br><span class="line"></span><br><span class="line"># æ­£åˆ™è¡¨è¾¾å¼æœªåŒ¹é…åˆ°ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…è§„åˆ™ï¼ŒåŒ¹é…4è€Œä¸æ˜¯5</span><br><span class="line">curl localhost:8099&#x2F;aaa&#x2F;bbb&#x2F;</span><br><span class="line">long prefix string match</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># ^~ï¼ŒåŒ¹é…åï¼Œåˆ™ä¸å†ä½¿ç”¨æ­£é€‰æ‹©åŒ¹é…</span><br><span class="line">curl localhost:8099&#x2F;aaa&#x2F;ccc                             </span><br><span class="line">å“åº”ï¼š^~ match </span><br><span class="line"></span><br><span class="line">å¦‚æœåŠ ä¸Šé…ç½®ï¼š</span><br><span class="line">location &#x2F;aaa&#x2F;ccc &#123;</span><br><span class="line">    # å‰ç¼€æœ€é•¿åŒ¹é…</span><br><span class="line">    return 200 &#39;long prefix string match ccc\n&#39;;</span><br><span class="line">&#125;</span><br><span class="line">åˆ™ curl localhost:8099&#x2F;aaa&#x2F;ccc ä¼šè¿”å› long prefix string match ccc</span><br></pre></td></tr></table></figure><h2 id="PREACCESS"><a href="#PREACCESS" class="headerlink" title="PREACCESS"></a>PREACCESS</h2><p>preaccess é˜¶æ®µä¸»è¦åŠŸèƒ½æ˜¯å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æˆ–è€…è¿æ¥æ•°è¿›è¡Œé™åˆ¶ã€‚</p><p>é™åˆ¶è¿æ¥æ•°æ—¶ï¼Œéœ€è¦ç”¨åˆ° nginx çš„ ngx_http_limit_conn_module æ¨¡å—ï¼Œé™åˆ¶è¯·æ±‚æ•°æ—¶ï¼Œè¦ä½¿ç”¨ ngx_http_limit_req_module æ¨¡å—ã€‚</p><h3 id="limit-conn"><a href="#limit-conn" class="headerlink" title="limit_conn"></a>limit_conn</h3><p>ngx_http_limit_conn_module æ¨¡å—çš„ç”Ÿæ•ˆèŒƒå›´æ˜¯å…¨éƒ¨workerï¼ˆåŸºäºå…±äº«å†…å­˜ï¼‰ï¼Œå¹¶ä¸”é™åˆ¶çš„æœ‰æ•ˆæ€§å–å†³äº key çš„è®¾è®¡ï¼ˆä¾èµ–äº postread é˜¶æ®µä¸­realipæ¨¡å—å–åˆ°çš„çœŸå®ipï¼‰ã€‚ </p><p>å¸¸ç”¨æŒ‡ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">limit_conn_zone key zone&#x3D;name:size;</span><br><span class="line">åŠŸèƒ½ï¼šä¸ºä¸€å—å…±äº«å†…å­˜æŒ‡å®šä¸€ä¸ª keyï¼Œä¼šè®°å½•æ¯ä¸ª key çš„çŠ¶æ€ï¼ˆçŠ¶æ€ä¸­åŒ…å«äº† key å¯¹åº”çš„å½“å‰è¿æ¥æ•°ï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">limit_conn zone number;</span><br><span class="line">åŠŸèƒ½ï¼šé™åˆ¶ key çš„å¹¶å‘è¿æ¥æ•°</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">limit_conn_log_level info | notice | warn | error;ï¼ˆé»˜è®¤ errorï¼‰</span><br><span class="line">åŠŸèƒ½ï¼šå‘ç”Ÿé™åˆ¶å¹¶å‘è¿æ¥æ—¶ï¼Œæ‰“å°æ—¥å¿—çš„æ ¼å¼</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">limit_conn_status code;ï¼ˆé»˜è®¤ 503ï¼‰</span><br><span class="line">åŠŸèƒ½ï¼šå‘ç”Ÿå¹¶å‘è¿æ¥æ•°é™åˆ¶æ—¶ï¼Œå‘å®¢æˆ·ç«¯è¿”å›çš„çŠ¶æ€ç </span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br></pre></td></tr></table></figure><p>é™åˆ¶å®¢æˆ·ç«¯è¿æ¥æ•°çš„é…ç½®ä¾‹å­ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">limit_conn_zone</span> <span class="variable">$binary_remote_addr</span> zone=addr:<span class="number">10m</span>;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8099</span>;</span><br><span class="line">    <span class="attribute">root</span> html/;</span><br><span class="line">    <span class="attribute">error_log</span>  logs/err_limit.log <span class="literal">info</span>;</span><br><span class="line">   </span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">limit_conn_status</span> <span class="number">503</span>;</span><br><span class="line">        <span class="attribute">limit_conn_log_level</span>  <span class="literal">warn</span>;</span><br><span class="line">        <span class="comment"># é™åˆ¶å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®çš„é€Ÿç‡ï¼ˆæ¯ç§’50å­—èŠ‚ï¼‰</span></span><br><span class="line">        <span class="attribute">limit_rate</span> <span class="number">50</span>;</span><br><span class="line">        <span class="attribute">limit_conn</span> addr <span class="number">1</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="limit-req"><a href="#limit-req" class="headerlink" title="limit_req"></a>limit_req</h3><p>ngx_http_limit_req_module æ¨¡å—çš„ç”Ÿæ•ˆèŒƒå›´ä¹Ÿæ˜¯å…¨éƒ¨ worker  è¿›ç¨‹ï¼Œä½¿ç”¨çš„ç®—æ³•æ˜¯ leaky bucket ç®—æ³•ã€‚</p><p>å¸¸ç”¨æŒ‡ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">limit_req_zone key zone&#x3D;name:size rate&#x3D;rate;</span><br><span class="line">åŠŸèƒ½ï¼šä¸ limit_conn_zone åŠŸèƒ½ç±»ä¼¼ï¼Œå®šä¹‰å…±äº«å†…å­˜å¤§å°ï¼Œä»¥åŠæ ¹æ® key å…³é”®å­—é™åˆ¶é€Ÿç‡ï¼Œrate æ˜¯æ¯ç§’æˆ–æ¯åˆ†é’Ÿå¤„ç†çš„è¯·æ±‚æ•°ï¼ˆr&#x2F;sã€r&#x2F;mï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">limit_req limit_req zone&#x3D;name [burst&#x3D;number] [nodelay | delay&#x3D;number];</span><br><span class="line">åŠŸèƒ½ï¼šé™åˆ¶å¹¶å‘è¿æ¥æ•°ï¼Œburstè¡¨ç¤ºæœ€å¤§è¯·æ±‚æ•°ï¼Œnodelayè¡¨ç¤ºå¯¹burstä¸­çš„è¯·æ±‚ç«‹åˆ»å¤„ç†</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">limit_req_log_level info | notice | warn | error;</span><br><span class="line">åŠŸèƒ½ï¼šé™åˆ¶å‘ç”Ÿæ—¶çš„æ—¥å¿—çº§åˆ«</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">limit_req_status code;</span><br><span class="line">åŠŸèƒ½ï¼šé™åˆ¶å‘ç”Ÿæ—¶ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯çš„çŠ¶æ€ç </span><br><span class="line">ä¸Šä¸‹æ–‡: http, server, location</span><br></pre></td></tr></table></figure><p>é™åˆ¶å®¢æˆ·ç«¯è¯·æ±‚æ•°çš„é…ç½®ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># æ¯åˆ†é’Ÿå¤„ç†ä¸¤æ¬¡è¯·æ±‚</span><br><span class="line">limit_req_zone $binary_remote_addr zone&#x3D;req:10m rate&#x3D;2r&#x2F;m;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 8099;</span><br><span class="line">    root html&#x2F;;</span><br><span class="line">    error_log  logs&#x2F;err_limit.log info;</span><br><span class="line">   </span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        limit_req zone&#x3D;req burst&#x3D;3 nodelay;</span><br><span class="line">        # limit_req zone&#x3D;req;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“åŒæ—¶é…ç½®äº† limit_conn å’Œ limit_req æ—¶ï¼Œç”±äº limt_req æ¨¡å—åœ¨ limit_conn æ¨¡å—ä¹‹å‰ï¼Œæ‰€ä»¥ limit_req æ¨¡å—ä¼šå…ˆè¿”å›ï¼Œlimit_conn æ¨¡å—åˆ™ä¸ä¼šè¿”å›ã€‚</p><h2 id="ACCESS"><a href="#ACCESS" class="headerlink" title="ACCESS"></a>ACCESS</h2><p>access é˜¶æ®µä¸»è¦è´Ÿè´£å¯¹ ip è®¿é—®çš„æƒé™æ§åˆ¶ï¼Œå¸¸ç”¨æ¨¡å— ngx_http_access_moduleï¼ˆç”¨æˆ·å¯¹ ip åšé™åˆ¶ï¼‰ã€ ngx_http_auth_basic_moduleï¼ˆæ ¡éªŒç”¨æˆ·åå’Œå¯†ç ï¼‰ã€ngx_http_auth_request_moduleï¼ˆä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æƒé™éªŒè¯ï¼‰</p><p>ä¸ access é˜¶æ®µç›¸å…³çš„ä¸€ä¸ªæŒ‡ä»¤ satisfy ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">satisfy all | any;</span><br><span class="line">åŠŸèƒ½ï¼šé…ç½®ä¸ºallæ—¶ï¼Œæ‰€æœ‰æ¨¡å—ï¼ˆngx_http_access_module, ngx_http_auth_basic_module, ngx_http_auth_request_module, ngx_http_auth_jwt_moduleï¼‰é€šè¿‡æ—¶ï¼Œè¯·æ±‚æ‰èƒ½ç»§ç»­ï¼›ä¸º any æ—¶ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªæ¨¡å—é€šè¿‡è¯·æ±‚æ‰èƒ½ç»§ç»­ã€‚é»˜è®¤ä¸º all</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br></pre></td></tr></table></figure><p>access ï¼ˆngx_http_access_moduleï¼‰æ¨¡å—å¸¸ç”¨æŒ‡ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">allow address | CIDR | unix: | all;</span><br><span class="line">åŠŸèƒ½ï¼šå…è®¸å“ªäº›åœ°å€è®¿é—®</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, limit_except</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">deny address | CIDR | unix: | all;</span><br><span class="line">åŠŸèƒ½ï¼šä¸å…è®¸å“ªäº›åœ°å€è®¿é—®</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, limit_except</span><br></pre></td></tr></table></figure><p>é…ç½®ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">    deny 192.168.1.1;</span><br><span class="line">    allow 192.168.1.0&#x2F;24;</span><br><span class="line">    allow 10.1.1.0&#x2F;16;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>auth_basicï¼ˆngx_http_auth_basic_moduleï¼‰ æ¨¡å—å¸¸ç”¨æŒ‡ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">auth_basic string | off;</span><br><span class="line">åŠŸèƒ½ï¼šå¼€å¯æˆ–è€…ç¦ç”¨ auth_basicï¼Œé»˜è®¤offï¼Œstringè¡¨ç¤ºæµè§ˆå™¨ä¸Šæ ‡ç­¾é¡µæ˜¾ç¤ºçš„å¯¹è¯æ¡†åç§°</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, limit_except</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auth_basic_user_file file;</span><br><span class="line">åŠŸèƒ½ï¼šæŒ‡å®šç”¨æˆ·åã€å¯†ç é…ç½®æ–‡ä»¶</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, limit_except</span><br></pre></td></tr></table></figure><p>é…ç½®ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 8099;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        satisfy any;</span><br><span class="line">        auth_basic &#39;auth_test&#39;;</span><br><span class="line">        # æŒ‡å®šå¯†ç æ–‡ä»¶ä¸º passwd&#x2F;user.pass</span><br><span class="line">        auth_basic_user_file passwd&#x2F;user.pass;</span><br><span class="line">        deny all;</span><br><span class="line">   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>auth_requestï¼ˆngx_http_auth_request_moduleï¼‰ æ¨¡å—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åŸç†ï¼šæ”¶åˆ°è¯·æ±‚åï¼Œç”Ÿæˆä¸€ä¸ªå­è¯·æ±‚ï¼Œé€šè¿‡åå‘ä»£ç†æŠŠå­è¯·æ±‚ä¼ åˆ°ä¸Šæ¸¸ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼Œæ ¹æ®ä¸Šæ¸¸æœåŠ¡å™¨è¿”å›çš„å“åº”æ¥å¤„ç†æ”¶åˆ°çš„åŸè¯·æ±‚ã€‚è‹¥ä¸Šæ¸¸æœåŠ¡å™¨èŒƒå›´çš„çŠ¶æ€ç ä¸º 2xxï¼Œåˆ™å…è®¸è¯·æ±‚ç»§ç»­ï¼Œè‹¥èŒƒå›´çš„æ˜¯ 401 æˆ–è€… 403ï¼Œåˆ™å°†è¯·æ±‚è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨æŒ‡ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">auth_request uri | off;</span><br><span class="line">åŠŸèƒ½ï¼šé…ç½®å­è¯·æ±‚è®¿é—®çš„urlï¼Œé»˜è®¤ä¸ºoff</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auth_request_set $variable value;</span><br><span class="line">åŠŸèƒ½ï¼šæƒé™æ ¡éªŒå®Œæˆåï¼Œè®¾ç½®æ–°çš„å˜é‡å’Œå€¼ï¼Œå€¼ä¸­å¯ä»¥åŒ…å«ä¸Šæ¸¸è¯·æ±‚çš„ä¸€äº›ä¿¡æ¯</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br></pre></td></tr></table></figure><h2 id="PRECONTENTé˜¶æ®µ"><a href="#PRECONTENTé˜¶æ®µ" class="headerlink" title="PRECONTENTé˜¶æ®µ"></a>PRECONTENTé˜¶æ®µ</h2><h3 id="try-filesæ¨¡å—"><a href="#try-filesæ¨¡å—" class="headerlink" title="try_filesæ¨¡å—"></a>try_filesæ¨¡å—</h3><p>try_files æ¨¡å—ä¸­æœ‰ä¸€ä¸ª try_files æŒ‡ä»¤ï¼Œå…¶åŠŸèƒ½å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŠŸèƒ½ï¼šä¾æ¬¡è®¿é—®æ–‡ä»¶ï¼Œå½“æ–‡ä»¶å­˜åœ¨æ—¶ï¼Œè¿”å›æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåé¢çš„æ–‡ä»¶å°†ä¸å†è®¿é—®ï¼Œè‹¥æ–‡ä»¶éƒ½ä¸å­˜åœ¨ï¼Œè¿”å›æœ€åçš„ url æˆ–è€… code</span><br><span class="line">è¯­æ³•ï¼štry_files file1 file2 file3 ... uri|&#x3D;code;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šserver, location</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8090</span>;</span><br><span class="line">    <span class="attribute">root</span> html/;</span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> /first &#123;</span><br><span class="line">        <span class="attribute">try_files</span> /tmp/index.html <span class="variable">$uri</span> <span class="variable">$uri</span>/index.html <span class="variable">$uri</span>.html <span class="variable">@lasturl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> <span class="variable">@lasturl</span> &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'lasturl \n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> /second &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/index.html =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mirroræ¨¡å—"><a href="#mirroræ¨¡å—" class="headerlink" title="mirroræ¨¡å—"></a>mirroræ¨¡å—</h3><p>mirror æ¨¡å—å…·æœ‰å®æ—¶æµé‡æ‹·è´çš„åŠŸèƒ½ï¼Œå¯ä»¥æŠŠç”Ÿäº§ç¯å¢ƒçš„è¯·æ±‚æ‹·è´ä¸€ä»½åˆ°æµ‹è¯•ç¯å¢ƒä¸­ã€‚è¯¥æ¨¡å—ä¸­æä¾›äº†ä»¥ä¸‹æŒ‡ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. mirror</span><br><span class="line">åŠŸèƒ½ï¼šå¤„ç†è¯·æ±‚æ—¶ï¼Œç”Ÿæˆå­è¯·æ±‚è®¿é—®å…¶ä»–æœåŠ¡ï¼Œå¯¹äºå­è¯·æ±‚çš„è¿”å›å€¼åˆ™ä¸åšå¤„ç†</span><br><span class="line">è¯­æ³•ï¼šmirror uri | off(é»˜è®¤);</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. mirror_request_body</span><br><span class="line">åŠŸèƒ½ï¼šæ˜¯å¦æŠŠè¯·æ±‚ä½“ä¹Ÿè½¬å‘åˆ°å…¶ä»–æœåŠ¡</span><br><span class="line">è¯­æ³•ï¼šmirror_request_body on(é»˜è®¤) | off;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br></pre></td></tr></table></figure><h2 id="CONTENTé˜¶æ®µ"><a href="#CONTENTé˜¶æ®µ" class="headerlink" title="CONTENTé˜¶æ®µ"></a>CONTENTé˜¶æ®µ</h2><h3 id="staticæ¨¡å—"><a href="#staticæ¨¡å—" class="headerlink" title="staticæ¨¡å—"></a>staticæ¨¡å—</h3><p>contenté˜¶æ®µä¸­æœ‰ä¸€ä¸ª static æ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸¤ä¸ªæˆ‘ä»¬å¸¸ç”¨çš„æŒ‡ä»¤ï¼šroot å’Œ aliasï¼Œè¿™ä¸¤ä¸ªæŒ‡ä»¤çš„åŠŸèƒ½éƒ½æ˜¯å°† url æ˜ å°„ä¸ºæ–‡ä»¶è·¯å¾„ï¼Œä»¥è¿”å›é™æ€æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚å…¶ä¸­ root å°†å®Œæ•´çš„ url æ˜ å°„ä¸ºæ–‡ä»¶è·¯å¾„ï¼Œalias å°† location åçš„ url æ˜ å°„ä¸ºæ–‡ä»¶è·¯å¾„ã€‚ä¸¤ä¸ªæŒ‡ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. root</span><br><span class="line">è¯­æ³•ï¼šroot path; ï¼ˆé»˜è®¤ï¼šroot htmlï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, if in location</span><br><span class="line"></span><br><span class="line">2. alias</span><br><span class="line">è¯­æ³•ï¼šalias path;ï¼ˆæ— é»˜è®¤å€¼ï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šlocation</span><br></pre></td></tr></table></figure><p>static æ¨¡å—ä¸­è¿˜æä¾›äº†ä¸‰ä¸ªé™æ€æ–‡ä»¶ç›¸å…³çš„å˜é‡ï¼šrequest_filenameï¼ˆå¾…è®¿é—®æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼‰ã€document_rootï¼ˆç”± URI å’Œ root/alias æŒ‡å®šçš„è§„åˆ™ç”Ÿæˆçš„æ–‡ä»¶å¯¹åº”çš„ç›®å½•ï¼‰ã€realpath_rootï¼ˆè‹¥document_rootä¸­æœ‰è½¯é“¾æ¥ï¼Œåˆ™ä¼šå°†è½¯é“¾æ¥æ›¿æ¢æˆçœŸå®è·¯å¾„ï¼‰ã€‚</p><p>staticæ¨¡å—ä¸­è¿˜æä¾›äº†ä»¥ä¸‹æŒ‡ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. types</span><br><span class="line">åŠŸèƒ½ï¼šæ˜ å°„æ–‡ä»¶æ‰©å±•åå’Œå“åº”ä¸­çš„ content-type</span><br><span class="line">è¯­æ³•ï¼štypes &#123;text&#x2F;html  html; image&#x2F;gif  gif; image&#x2F;jpeg jpg;&#125;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. default_type</span><br><span class="line">åŠŸèƒ½ï¼šè®¾ç½®å“åº”ä¸­é»˜è®¤çš„ content-type</span><br><span class="line">è¯­æ³•ï¼šdefault_type mime-type;</span><br><span class="line">é»˜è®¤ï¼šdefault_type text&#x2F;plain;</span><br><span class="line">ä¸Šä¸‹æ–‡: http, server, location</span><br></pre></td></tr></table></figure><h3 id="indexæ¨¡å—"><a href="#indexæ¨¡å—" class="headerlink" title="indexæ¨¡å—"></a>indexæ¨¡å—</h3><p>index æ¨¡å—çš„åŠŸèƒ½æ˜¯ï¼šå½“è®¿é—®çš„ url ä»¥ / ç»“å°¾æ—¶ï¼Œindex æ¨¡å—å°±ä¼šå¯»æ‰¾è¯¥ç›®å½•ä¸‹æ˜¯å¦æœ‰ index.html æ–‡ä»¶ï¼Œå¦‚æœæœ‰ï¼Œå°±ä¼šå°† index.html çš„å†…å®¹è¿”å›ã€‚å¯ä»¥é€šè¿‡ index æŒ‡ä»¤æŒ‡å®šè¦å¯»æ‰¾çš„æ–‡ä»¶åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼šindex file;</span><br><span class="line">é»˜è®¤ï¼šindex index.html;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br></pre></td></tr></table></figure><h3 id="autoindexæ¨¡å—"><a href="#autoindexæ¨¡å—" class="headerlink" title="autoindexæ¨¡å—"></a>autoindexæ¨¡å—</h3><p>audoindex æ¨¡å—çš„åŠŸèƒ½æ˜¯ï¼šå½“è¯·æ±‚ url ä»¥ / ç»“å°¾æ—¶ï¼Œä¼šå°è¯•ä»¥ html/xml/jspn/jsonp ç­‰å½¢å¼è¿”å› root/alias æ‰€æŒ‡å‘ç›®å½•çš„ç›®å½•ç»“æ„ã€‚æŒ‡ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1. autoindex</span><br><span class="line">åŠŸèƒ½ï¼šå±•ç¤ºæˆ–è€…ä¸å±•ç¤ºç›®å½•ç»“æ„</span><br><span class="line">ç”¨æ³•ï¼šautoindex on | off;ï¼ˆé»˜è®¤ offï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. autoindex_format</span><br><span class="line">åŠŸèƒ½ï¼šæ˜¾ç¤ºçš„æ ¼å¼</span><br><span class="line">ç”¨æ³•ï¼šautoindex_format html | xml | json | jsonp;ï¼ˆé»˜è®¤ htmlï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. autoindex_localtime</span><br><span class="line">åŠŸèƒ½ï¼šæ˜¯å¦æ˜¾ç¤ºæœ¬åœ°æ—¶é—´ï¼ˆä»… html æ ¼å¼ç”Ÿæ•ˆï¼‰</span><br><span class="line">ç”¨æ³•ï¼šautoindex_localtime on | off;ï¼ˆé»˜è®¤ offï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4. autoindex_exact_size</span><br><span class="line">åŠŸèƒ½ï¼šæ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼ˆä»… html æ ¼å¼ç”Ÿæ•ˆï¼‰</span><br><span class="line">ç”¨æ³•ï¼šautoindex_exact_size on | off;ï¼ˆé»˜è®¤ offï¼Œæ˜¾ç¤ºå­—èŠ‚æ•°ï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br></pre></td></tr></table></figure><h3 id="concat-æ¨¡å—"><a href="#concat-æ¨¡å—" class="headerlink" title="concat æ¨¡å—"></a>concat æ¨¡å—</h3><p>concat æ¨¡å—çš„åŠŸèƒ½æ˜¯ï¼šå¯ä»¥æŠŠå¤šä¸ªå°æ–‡ä»¶çš„å†…å®¹åˆå¹¶åˆ°ä¸€ä¸ª http å“åº”ä¸­è¿”å›ã€‚è¯¥æ¨¡å—çš„ github åœ°å€ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;nginx-http-concat</span><br></pre></td></tr></table></figure><p>å½“è¯·æ±‚å¤šä¸ªæ–‡ä»¶å†…å®¹æ—¶ï¼Œè¯·æ±‚urlåéœ€è¦è·Ÿä¸¤ä¸ª?ï¼Œå†é…åˆè¯¥æ¨¡å—ï¼Œå°±å¯ä»¥æ¥æ”¶å¤šä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;example.com&#x2F;??style1.css,style2.css,foo&#x2F;style3.css</span><br><span class="line">http:&#x2F;&#x2F;example.com&#x2F;xxx&#x2F;??style1.css,style2.css,foo&#x2F;style3.css</span><br></pre></td></tr></table></figure><p>ä¸‹è½½åï¼Œå¯ä»¥é€šè¿‡ â€“add-modules æ¥å®‰è£…è¯¥æ¨¡å—ã€‚å®ƒæä¾›çš„æŒ‡ä»¤æœ‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1. concat</span><br><span class="line">åŠŸèƒ½ï¼šæ˜¯å¦å¯ç”¨åˆå¹¶åŠŸèƒ½</span><br><span class="line">ç”¨æ³•ï¼šconcat on | off;ï¼ˆé»˜è®¤ offï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. concat_types</span><br><span class="line">åŠŸèƒ½ï¼šæŒ‡å®šå¯¹å“ªäº›æ–‡ä»¶ç±»å‹åšåˆå¹¶</span><br><span class="line">ç”¨æ³•ï¼šconcat_types MIME types</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. concat_delimiter</span><br><span class="line">åŠŸèƒ½ï¼šè¿”å›å¤šä¸ªæ–‡ä»¶æ—¶ï¼ŒæŒ‡å®šæ–‡ä»¶å†…å®¹çš„åˆ†éš”ç¬¦</span><br><span class="line">ç”¨æ³•ï¼šconcat_delimiter: string;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, locatione</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4. concat_unique</span><br><span class="line">åŠŸèƒ½ï¼šæ˜¯å¦ä»…å¯¹ä¸€ç§æ–‡ä»¶ç±»å‹åˆå¹¶</span><br><span class="line">ç”¨æ³•ï¼šconcat_unique on | off;ï¼ˆé»˜è®¤ on, ä»…å¯¹ä¸€ç§æ–‡ä»¶ç±»å‹åˆå¹¶ï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5. concat_ignore_file_error</span><br><span class="line">åŠŸèƒ½ï¼šæ˜¯å¦å¿½ç•¥æ–‡ä»¶ä¸å­˜åœ¨ç­‰é”™è¯¯</span><br><span class="line">ç”¨æ³•ï¼šconcat_ignore_file_error: on | off;ï¼ˆé»˜è®¤ offï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6. concat_max_files</span><br><span class="line">åŠŸèƒ½ï¼šæŒ‡å®šæœ€å¤šåˆå¹¶çš„æ–‡ä»¶æ•°é‡</span><br><span class="line">ç”¨æ³•ï¼šconcat_max_files numberï¼ˆé»˜è®¤ 10ï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location</span><br></pre></td></tr></table></figure><h2 id="LOGé˜¶æ®µ"><a href="#LOGé˜¶æ®µ" class="headerlink" title="LOGé˜¶æ®µ"></a>LOGé˜¶æ®µ</h2><p>logé˜¶æ®µä¸­æœ‰ log æ¨¡å—ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯æŠŠ http è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚å¸¸ç”¨æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1. log_format</span><br><span class="line">åŠŸèƒ½ï¼šå®šä¹‰æ—¥å¿—çš„æ ¼å¼</span><br><span class="line">ç”¨æ³•ï¼šlog_format name [escape&#x3D;default|json|none] string ...;</span><br><span class="line">é»˜è®¤ï¼šlog_format combined &#39;...&#39;;ï¼ˆæ—¥å¿—æœ‰ä¸€ä¸ªé»˜è®¤æ ¼å¼ï¼‰</span><br><span class="line">ä¸Šä¸‹æ–‡: http</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. access_log</span><br><span class="line">åŠŸèƒ½ï¼šæŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„å’Œæ ¼å¼</span><br><span class="line">ç”¨æ³•ï¼šaccess_log path [format [buffer&#x3D;size] [gzip[&#x3D;level]] [flush&#x3D;time] [if&#x3D;condition]];</span><br><span class="line">é»˜è®¤ï¼šaccess_log path combined;</span><br><span class="line">ä¸Šä¸‹æ–‡ï¼šhttp, server, location, if in location, limit_except</span><br><span class="line"></span><br><span class="line">access_log åçš„ path ä¸­å¯ä»¥åŒ…å«å˜é‡ï¼Œå®ƒåé¢ä¹Ÿå¯ä»¥è·Ÿ bufferã€gzipã€flushç­‰å‚æ•°ï¼Œè¿™äº›å‚æ•°æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š</span><br><span class="line">1. æ—¥å¿—ç¼“å­˜ï¼šæ‰¹é‡å°†å†…å­˜ä¸­çš„æ—¥å¿—å†™å…¥ç¼“å­˜ä¸­ï¼Œå†™å…¥ç£ç›˜çš„æ¡ä»¶æœ‰1ï¼‰æ‰€æ¬²å¾…å†™å…¥ç£ç›˜çš„æ—¥å¿—å¤§å°è¶…å‡ºç¼“å­˜å¤§å° 2ï¼‰è¾¾åˆ° flush æŒ‡å®šçš„è¿‡æœŸæ—¶é—´ 3ï¼‰workerè¿›ç¨‹æ‰§è¡Œ reopen å‘½ä»¤</span><br><span class="line">2. æ—¥å¿—å‹ç¼©ï¼šæ‰¹é‡å‹ç¼©å†…å­˜ä¸­çš„æ—¥å¿—ï¼Œå†å†™å…¥ç£ç›˜ï¼Œbufferå‚æ•°å€¼çš„é»˜è®¤å¤§å°ä¸º64kï¼Œå‹ç¼©çº§åˆ«é»˜è®¤ä¸º1ï¼ˆ1æœ€å¿«å‹ç¼©å‹ç¼©ç‡æœ€ä½ 9æœ€æ…¢å‹ç¼©å‹ç¼©ç‡æœ€é«˜ï¼‰</span><br></pre></td></tr></table></figure><p>â€¦.. æœªå®Œå¾…ç»­</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ€»ç»“ä¸‹ nginx å¤„ç†httpè¯·æ±‚çš„æµç¨‹ï¼Œé‡ç‚¹ä»‹ç»ä¸‹å¤„ç† http è¯·æ±‚çš„11ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;nginx å¤„ç† http è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¼šå¯¹è¯·æ±‚è¡Œå’Œè¯·æ±‚ä½“è¿›è¡Œè§£æï¼Œè§£æå®Œæˆåè¿›å…¥11 ä¸ªé˜¶æ®µï¼Œè¿™ 11 ä¸ªé˜¶æ®µä¼šæ ¹æ® nginx.conf ä¸­çš„é…ç½®ä¿¡æ¯è¿›è¡Œç›¸åº”çš„é‡å®šå‘ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ç­‰æ“ä½œã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="http://wyzane.gitee.io/blog/categories/Nginx/"/>
    
    
  </entry>
  
  <entry>
    <title>djangoå¼€å‘ä¹‹åœ¨dockerä¸­éƒ¨ç½²é¡¹ç›®</title>
    <link href="http://wyzane.gitee.io/blog/2020/07/26/django%E5%BC%80%E5%8F%91%E4%B9%8B%E5%9C%A8docker%E4%B8%AD%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/"/>
    <id>http://wyzane.gitee.io/blog/2020/07/26/django%E5%BC%80%E5%8F%91%E4%B9%8B%E5%9C%A8docker%E4%B8%AD%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/</id>
    <published>2020-07-26T07:51:27.000Z</published>
    <updated>2020-07-26T08:06:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ•´ç†äº†ä¸€ä¸‹å¦‚ä½•åœ¨dockerä¸­éƒ¨ç½²djangoé¡¹ç›®ã€‚</p><a id="more"></a><h1 id="é¡¹ç›®ç¯å¢ƒ"><a href="#é¡¹ç›®ç¯å¢ƒ" class="headerlink" title="é¡¹ç›®ç¯å¢ƒ"></a>é¡¹ç›®ç¯å¢ƒ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3.6 django2.0.5 nginx mysql5.7 gunicorn</span><br></pre></td></tr></table></figure><h1 id="é¡¹ç›®æ–‡ä»¶"><a href="#é¡¹ç›®æ–‡ä»¶" class="headerlink" title="é¡¹ç›®æ–‡ä»¶"></a>é¡¹ç›®æ–‡ä»¶</h1><p>é¡¹ç›®ä¸»ç›®å½•ä¸º blog ç›®å½•ï¼Œéœ€è¦ç¼–å†™çš„æ–‡ä»¶åŒ…æ‹¬ï¼ˆçœå»äº†å…¶ä»–djangoæ–‡ä»¶ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blog&#x2F;Dockerfile, blog&#x2F;gunicorn.conf, blog&#x2F;start.sh, nginx&#x2F;Doickerfile, nginx&#x2F;nginx.conf, docker-conpose.yml</span><br></pre></td></tr></table></figure><h1 id="é¡¹ç›®é…ç½®"><a href="#é¡¹ç›®é…ç½®" class="headerlink" title="é¡¹ç›®é…ç½®"></a>é¡¹ç›®é…ç½®</h1><h2 id="Dockeré…ç½®"><a href="#Dockeré…ç½®" class="headerlink" title="Dockeré…ç½®"></a>Dockeré…ç½®</h2><p>blog/Dockerfile å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FROM python:3.6    # é€‰æ‹©åŸºç¡€é•œåƒ,è¿™é‡Œçš„åŸºç¡€é•œåƒä¹Ÿå¯ä»¥é€‰æ‹©ubuntu,centosç­‰ï¼Œä½†æ˜¯ä¸‹é¢çš„é…ç½®å°±ä¼šå‘ç”Ÿå˜åŒ–</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå·¥ä½œç›®å½•</span><br><span class="line">RUN mkdir &#x2F;blog  </span><br><span class="line"></span><br><span class="line">#è®¾ç½®å·¥ä½œç›®å½•</span><br><span class="line">WORKDIR &#x2F;blog</span><br><span class="line"></span><br><span class="line">#å°†å½“å‰ç›®å½•åŠ å…¥åˆ°å·¥ä½œç›®å½•ä¸­</span><br><span class="line">ADD . &#x2F;blog</span><br><span class="line">RUN pip3 install -r requirements.txt</span><br><span class="line">#å¯¹å¤–æš´éœ²ç«¯å£</span><br><span class="line">EXPOSE 80 8080 8000 5000</span><br><span class="line">#è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">ENV SPIDER&#x3D;&#x2F;blog</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åŸºç¡€é•œåƒä½¿ç”¨çš„æ˜¯python:3.6,è€Œä¸æ˜¯ubuntuã€centosã€‚å¦‚æœæ˜¯ubuntuã€cenosï¼ŒDockerfileæ–‡ä»¶ä¸­éœ€è¦é…ç½®pythonç¯å¢ƒ</p><p>nginx/Doickerfile å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx    # nginxé•œåƒï¼Œæœ€å¥½æ˜¯å…ˆæ‹‰å–åˆ°æœ¬åœ°</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># å¯¹å¤–æš´éœ²ç«¯å£</span><br><span class="line">EXPOSE 80 8000</span><br><span class="line"></span><br><span class="line">RUN rm &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf  # åˆ é™¤åŸæœ‰é…ç½®æ–‡ä»¶</span><br><span class="line">ADD nginx.conf  &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;   # æ·»åŠ é…ç½®æ–‡ä»¶</span><br><span class="line">RUN mkdir -p &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;static  # åˆ›å»ºé™æ€èµ„æºæ–‡ä»¶å¤¹</span><br></pre></td></tr></table></figure><p>docker-compose.yml å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db:</span><br><span class="line">    image: mysql:5.7  # mysqlé•œåƒï¼Œæœ€å¥½å…ˆæ‹‰å–åˆ°æœ¬åœ°</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_HOST&#x3D;localhost</span><br><span class="line">      - MYSQL_DATABASE&#x3D;docker</span><br><span class="line">      - MYSQL_USER&#x3D;root</span><br><span class="line">      - MYSQL_PASSWORD&#x3D;wyzane</span><br><span class="line">      - MYSQL_ROOT_PASSWORD&#x3D;wyzane</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x2F;home&#x2F;wyzane&#x2F;pyprojects&#x2F;db:&#x2F;var&#x2F;lib&#x2F;mysql  # å°†å®¿ä¸»æœºä¸å®¹å™¨ä¸­çš„æ–‡ä»¶æ˜ å°„</span><br><span class="line">    restart: always  # è‹¥å®¹å™¨è¿è¡Œå‡ºç°é—®é¢˜ï¼Œä¼šè‡ªåŠ¨é‡å¯å®¹å™¨</span><br><span class="line"></span><br><span class="line">  web:</span><br><span class="line">    build: .&#x2F;blog</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;8000:8000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">    - .&#x2F;blog:&#x2F;blog</span><br><span class="line">    - &#x2F;tmp&#x2F;logs:&#x2F;tmp</span><br><span class="line">    command: bash start.sh  # æ‰§è¡Œå‘½ä»¤ï¼Œæœ‰å¤šç§æ ¼å¼</span><br><span class="line">    links:</span><br><span class="line">    - db</span><br><span class="line">    depends_on:</span><br><span class="line">    - db</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">nginx:</span><br><span class="line">    build: .&#x2F;nginx</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;80:80&quot;</span><br><span class="line">    volumes:</span><br><span class="line">    - .&#x2F;blog&#x2F;static:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;static:ro</span><br><span class="line">    links:</span><br><span class="line">    - web</span><br><span class="line">    depends_on:</span><br><span class="line">    - web</span><br><span class="line">    restart: always</span><br></pre></td></tr></table></figure><h2 id="gunicorné…ç½®"><a href="#gunicorné…ç½®" class="headerlink" title="gunicorné…ç½®"></a>gunicorné…ç½®</h2><p>blog/gunicorn.conf çš„é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">workers&#x3D;2</span><br><span class="line">bind&#x3D;&#39;0.0.0.0:8000&#39;</span><br><span class="line">proc_name&#x3D;&#39;blog&#39;</span><br></pre></td></tr></table></figure><h2 id="startæ–‡ä»¶é…ç½®"><a href="#startæ–‡ä»¶é…ç½®" class="headerlink" title="startæ–‡ä»¶é…ç½®"></a>startæ–‡ä»¶é…ç½®</h2><p>blog/start.sh æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œç”¨äºå¯åŠ¨é¡¹ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">python manage.py collectstatic --noinput&amp;&amp;</span><br><span class="line">python manage.py makemigrations&amp;&amp;</span><br><span class="line">python manage.py migrate &amp;&amp;</span><br><span class="line">gunicornblog.wsgi:application -c gunicorn.conf</span><br></pre></td></tr></table></figure><h2 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h2><p>nginx/nginx.conf æ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    location &#x2F;static &#123;</span><br><span class="line">        alias &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;static;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;web:8000;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é¡¹ç›®å¯åŠ¨"><a href="#é¡¹ç›®å¯åŠ¨" class="headerlink" title="é¡¹ç›®å¯åŠ¨"></a>é¡¹ç›®å¯åŠ¨</h1><p>é…ç½®å®Œæˆåï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡ docker images å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–°å¢äº†2ä¸ªé•œåƒï¼Œdocker ps å‘½ä»¤å¯ä»¥æŸ¥çœ‹å¯åŠ¨äº†3ä¸ªå®¹å™¨ã€‚</p><p>å¤šæ‰§è¡Œå‡ æ¬¡docker psï¼Œå½“å®¹å™¨çš„STATUSæ˜¯ä»¥Restartingå¼€å¤´æ—¶ï¼Œè¡¨ç¤ºè¿™ä¸ªå®¹å™¨è¿è¡Œæ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚æ‰§è¡Œdocker logs CONTAINERIDå¯ä»¥æŸ¥çœ‹å®¹å™¨å‡ºé”™çš„å…·ä½“åŸå› ã€‚</p><p>è‹¥ä¸Šè¿°å®¹å™¨éƒ½æˆåŠŸè¿è¡Œï¼Œåˆ™åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<a href="http://127.0.0.1:80/api/v1/articles/info/æ—¶ï¼ˆè¿™æ˜¯djangoä¸­çš„ä¸€ä¸ªè§†å›¾ï¼Œåœ¨è¿™é‡Œæ²¡æœ‰å†™å‡ºæ¥ï¼Œä¸åŒçš„å°ä¼™ä¼´å¯ä»¥æ›¿æ¢æˆä¸åŒçš„æ¥å£ï¼‰ï¼Œè§†å›¾ä¼šè¿”å›ç›¸åº”çš„ç»“æœã€‚" target="_blank" rel="noopener">http://127.0.0.1:80/api/v1/articles/info/æ—¶ï¼ˆè¿™æ˜¯djangoä¸­çš„ä¸€ä¸ªè§†å›¾ï¼Œåœ¨è¿™é‡Œæ²¡æœ‰å†™å‡ºæ¥ï¼Œä¸åŒçš„å°ä¼™ä¼´å¯ä»¥æ›¿æ¢æˆä¸åŒçš„æ¥å£ï¼‰ï¼Œè§†å›¾ä¼šè¿”å›ç›¸åº”çš„ç»“æœã€‚</a><br>ä»¥äº¤äº’æ–¹å¼è¿›å…¥å®¹å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it CONTAINERID &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>åï¼Œè¿›å…¥mysqlæ•°æ®åº“ï¼Œä¼šçœ‹åˆ°åœ¨æ•°æ®åº“ä¸­ç”Ÿæˆäº†ç›¸åº”çš„è¡¨ã€‚</p><h1 id="é‡åˆ°é—®é¢˜"><a href="#é‡åˆ°é—®é¢˜" class="headerlink" title="é‡åˆ°é—®é¢˜"></a>é‡åˆ°é—®é¢˜</h1><p>åœ¨è¿è¡Œ3ä¸ªå®¹å™¨åï¼Œwebå®¹å™¨ä¸€ç›´æŠ¥é”™ï¼Œé€šè¿‡ docker logs CONTAINERIDæŸ¥çœ‹ä¸»è¦é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django.db.utils.OperationalError: (2003, &#39;Can\&#39;t connect to MySQL server on \&#39;mariadb55\&#39; (111 &quot;Connection refused&quot;)&#39;)</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆåœ¨è¿™é‡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;47979270&#x2F;django-cannot-connect-mysql-in-docker-compose</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯åœ¨settings.pyä¸­ï¼Œå°†databaseé…ç½®ä¸­çš„HOSTå€¼æ”¹æˆdb,è€Œä¸æ˜¯127.0.0.1ï¼ŒæŒ‡å‘docker-compose.ymlä¸­çš„dbæœåŠ¡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ•´ç†äº†ä¸€ä¸‹å¦‚ä½•åœ¨dockerä¸­éƒ¨ç½²djangoé¡¹ç›®ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="django, docker" scheme="http://wyzane.gitee.io/blog/tags/django-docker/"/>
    
  </entry>
  
  <entry>
    <title>ä¸ºå·²å®‰è£…çš„nginxåŠ¨æ€æ·»åŠ æ¨¡å—</title>
    <link href="http://wyzane.gitee.io/blog/2020/07/25/%E4%B8%BA%E5%B7%B2%E5%AE%89%E8%A3%85%E7%9A%84nginx%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97/"/>
    <id>http://wyzane.gitee.io/blog/2020/07/25/%E4%B8%BA%E5%B7%B2%E5%AE%89%E8%A3%85%E7%9A%84nginx%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97/</id>
    <published>2020-07-25T09:47:09.000Z</published>
    <updated>2020-07-25T09:58:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©ä»‹ç»ä¸‹å¦‚ä½•ä¸ºå·²å®‰è£…çš„ nginx åŠ¨æ€æ·»åŠ æ¨¡å—ã€‚</p><a id="more"></a><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸‹è½½éœ€è¦ç¼–è¯‘è¿› nginx æ¨¡å—ï¼Œæˆ–è€…ä½¿ç”¨ nginx è‡ªå¸¦çš„æ¨¡å—å¦‚ï¼šrealip æ¨¡å—ã€‚</p><p>ç„¶åï¼Œæ‰§è¡Œ nginx -Vï¼ŒæŸ¥çœ‹nginxä¿¡æ¯å’Œä¹‹å‰çš„å®‰è£…è®°å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">âœ  conf nginx -V                                  </span><br><span class="line">nginx version: nginx&#x2F;1.16.1</span><br><span class="line">built by gcc 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04) </span><br><span class="line">built with OpenSSL 1.1.1  11 Sep 2018</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_ssl_module --with-stream --with-mail&#x3D;dynamic</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¹‹å‰ç¼–è¯‘ nginx æ—¶ä½¿ç”¨çš„å‚æ•°æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_ssl_module --with-stream --with-mail&#x3D;dynamic</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¿™æ¬¡ç¼–è¯‘æ—¶ï¼Œå¦‚æœæƒ³æŠŠ nginx è‡ªå¸¦çš„æ¨¡å—ç¼–è¯‘è¿›å»ï¼Œå¦‚ realipï¼Œåˆ™æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_ssl_module --with-stream --with-mail&#x3D;dynamic --with-http_realip_module</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³æŠŠç¬¬ä¸‰æ–¹æ¨¡å—ç¼–è¯‘è¿›å»ï¼Œåˆ™å¯ä»¥æ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_ssl_module --with-stream --with-mail&#x3D;dynamic -â€“add-module&#x3D;ç¬¬ä¸‰æ–¹æ¨¡å—æ‰€åœ¨ç›®å½•</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œå†æ‰§è¡Œ make å‘½ä»¤ï¼ˆä¸éœ€è¦æŒ‡å®š make installå‘½ä»¤ï¼‰å°±è¡Œäº†ã€‚</p><p>æœ€åï¼Œå°†ç°æœ‰çš„ nginx äºŒè¿›åˆ¶æ–‡ä»¶å¤‡ä»½ï¼ˆä¾‹å¦‚ï¼šå¤‡ä»½æ–‡ä»¶ /usr/local/nginx/sbin/nginxï¼‰ï¼Œå¤‡ä»½å®Œæˆåï¼Œå†ä½¿ç”¨åˆšåˆšç”Ÿæˆçš„ nginx äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢ç°æœ‰çš„ nginx äºŒè¿›åˆ¶æ–‡ä»¶æ—¢å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©ä»‹ç»ä¸‹å¦‚ä½•ä¸ºå·²å®‰è£…çš„ nginx åŠ¨æ€æ·»åŠ æ¨¡å—ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="http://wyzane.gitee.io/blog/categories/Nginx/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨nginxæ­å»ºåå‘ä»£ç†æœåŠ¡å™¨</title>
    <link href="http://wyzane.gitee.io/blog/2020/07/20/%E4%BD%BF%E7%94%A8nginx%E6%90%AD%E5%BB%BA%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>http://wyzane.gitee.io/blog/2020/07/20/%E4%BD%BF%E7%94%A8nginx%E6%90%AD%E5%BB%BA%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2020-07-20T13:56:31.000Z</published>
    <updated>2020-07-26T02:22:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åˆ†äº«ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨ nginx æ­å»ºå…·æœ‰åå‘ä»£ç†åŠŸèƒ½çš„æœåŠ¡å™¨ã€‚</p><p>é¦–å…ˆæŠŠ nginx å®˜æ–¹æ–‡æ¡£åœ°å€è´´å‡ºæ¥ï¼Œæœ‰é—®é¢˜å¯ä»¥éšæ—¶æŸ¥é˜…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h1><p>é¦–å…ˆä»‹ç»ä¸‹æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«ã€‚</p><p>æ­£å‘ä»£ç†æ˜¯å‘é€è¯·æ±‚æ—¶ï¼Œéšè—äº†çœŸæ­£çš„å®¢æˆ·ç«¯ï¼Œå³æœåŠ¡ç«¯ä¸çŸ¥é“è¯·æ±‚çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½è¢«ä»£ç†æœåŠ¡å™¨ä»£æ›¿æ¥è¯·æ±‚ã€‚æ­£å‘ä»£ç†çš„å¸¸ç”¨åœºæ™¯å°±æ˜¯åœ¨çˆ¬è™«ç³»ç»Ÿä¸­ã€‚<br>åå‘ä»£ç†æ˜¯å®¢æˆ·ç«¯ä¸çŸ¥é“å°†è¦è¯·æ±‚çš„æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œè€Œæ˜¯è¯·æ±‚ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å†å»è¯·æ±‚ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¹¶æŠŠä¸Šæ¸¸æœåŠ¡å™¨çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å…¶å®ï¼Œæ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„è¯·æ±‚æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¢«ä»£ç†å¯¹è±¡ä¸åŒã€‚æ­£å‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯ï¼Œåå‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè°è¢«ä»£ç†å°±éšè—äº†è°ã€‚</p><h2 id="åå‘ä»£ç†æœåŠ¡å™¨æ­å»º"><a href="#åå‘ä»£ç†æœåŠ¡å™¨æ­å»º" class="headerlink" title="åå‘ä»£ç†æœåŠ¡å™¨æ­å»º"></a>åå‘ä»£ç†æœåŠ¡å™¨æ­å»º</h2><p>ä¸‹é¢çœ‹ä¸€ä¸ª nginx é…ç½®åå‘ä»£ç†çš„ä¾‹å­ã€‚</p><p>ä½¿ç”¨ nginx æ­å»ºä¸€ä¸ªåå‘ä»£ç†ï¼Œä¸Šæ¸¸æœåŠ¡å™¨æ˜¯ä¸€ä¸ªé™æ€èµ„æº web æœåŠ¡ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><p>nginx.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                  <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                  <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">127.0.0.1:8081</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        <span class="attribute">access_log</span>  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">alias</span>  docs/;   <span class="comment"># æŒ‡å®šé™æ€èµ„æºç›®å½•</span></span><br><span class="line">            <span class="attribute">autoindex</span>  <span class="literal">on</span>;  <span class="comment"># è¿™ä¸ªè®¾ç½®ä¼šæ˜¾ç¤ºdocsç›®å½•ç»“æ„</span></span><br><span class="line">            <span class="attribute">set</span> <span class="variable">$limit_rate</span> <span class="number">1k</span>;  <span class="comment"># é™åˆ¶é€Ÿç‡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå‘ä»£ç†æœåŠ¡å™¨é…ç½®å¦‚ä¸‹ï¼š</p><p>nginx2.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">include</span>       ../confs/<span class="regexp">*.conf</span>;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                  <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                  <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŒ‡å®šä¸Šæ¸¸æœåŠ¡,è¿™é‡Œå¯ä»¥é…ç½®è´Ÿè½½å‡è¡¡ç®—æ³•</span></span><br><span class="line">    <span class="attribute">upstream</span> local &#123;</span><br><span class="line">        <span class="attribute">server</span>  <span class="number">127.0.0.1:8081</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8082</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">192.168.0.105</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">access_log</span>  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>  Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>  X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>  X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†è¯·æ±‚è½¬å‘åˆ°æŒ‡å®šçš„ä¸Šæ¸¸æœåŠ¡å™¨</span></span><br><span class="line">            <span class="attribute">proxy_pass</span>  http://local;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæœåŠ¡å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line">sudo nginx -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx2.conf</span><br></pre></td></tr></table></figure><p>å¯åŠ¨åï¼Œå†æµè§ˆå™¨åœ°å€æ è¾“å…¥ <a href="http://192.168.0.105:8082/" target="_blank" rel="noopener">http://192.168.0.105:8082/</a> ä¾¿å¯ä»¥è®¿é—®é™æ€èµ„æºäº†ã€‚</p><h2 id="åå‘ä»£ç†æœåŠ¡åŠ å…¥ç¼“å­˜åŠŸèƒ½"><a href="#åå‘ä»£ç†æœåŠ¡åŠ å…¥ç¼“å­˜åŠŸèƒ½" class="headerlink" title="åå‘ä»£ç†æœåŠ¡åŠ å…¥ç¼“å­˜åŠŸèƒ½"></a>åå‘ä»£ç†æœåŠ¡åŠ å…¥ç¼“å­˜åŠŸèƒ½</h2><p>å¦‚æœæƒ³æé«˜å“åº”é€Ÿç‡ï¼Œå¯ä»¥åœ¨ nginx åå‘ä»£ç†æœåŠ¡å™¨ä¸Šå¢åŠ ç¼“å­˜åŠŸèƒ½ã€‚</p><p>åå‘ä»£ç†å¢åŠ ç¼“å­˜åï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šé¦–å…ˆä»nginxç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå½“æ²¡æœ‰ç¼“å­˜æ•°æ®æˆ–è€…ç¼“å­˜æ•°æ®è¿‡æœŸæ—¶ï¼Œæ‰ä¼šè¯·æ±‚ä¸Šæ¸¸æœåŠ¡å™¨ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">include</span>       ../confs/<span class="regexp">*.conf</span>;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                  <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                  <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># proxy_cache_path å‚æ•°ç”¨äºè®¾ç½®ç¼“å­˜è·¯å¾„ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šå…¶ä»–å‚æ•°</span></span><br><span class="line">    <span class="comment"># levels=1:2 å‚æ•°æŒ‡å®šç¼“å­˜ç­‰çº§ï¼Œå€¼ä»1åˆ°3ï¼ˆæš‚æ—¶æ²¡å¼„æ˜ç™½è¿™é‡Œçš„æ„æ€ï¼‰</span></span><br><span class="line">    <span class="comment"># keys_zone  å‚æ•°æŒ‡å®šå…±äº«å†…å­˜å¤§å°å’Œåç§°</span></span><br><span class="line">    <span class="comment"># inactive å‚æ•°æŒ‡å®šæ•°æ®ç¼“å­˜çš„æ—¶é•¿ï¼Œé»˜è®¤10åˆ†é’Ÿ</span></span><br><span class="line">    <span class="comment"># max_size å‚æ•°æŒ‡å®šç¼“å­˜æ•°æ®çš„æœ€å¤§å€¼</span></span><br><span class="line">    <span class="comment"># use_temp_path æŒ‡å®šæ˜¯å¦ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç¼“å­˜æ•°æ®</span></span><br><span class="line">    æŒ‡å®šä¿å­˜ç¼“å­˜æ•°æ®çš„è·¯å¾„, keys_zoneè¡¨ç¤ºå¼€äº†ä¸€ä¸ª10mçš„å…±äº«å†…å­˜ç”¨äºå­˜æ”¾keyï¼Œmy_cacheæ˜¯å…±äº«å†…å­˜åç§° </span><br><span class="line">    <span class="attribute">proxy_cache_path</span>  /tmp/nginx_cache levels=<span class="number">1</span>:<span class="number">2</span> keys_zone=my_cache:<span class="number">10m</span> max_size=<span class="number">10g</span> </span><br><span class="line">                      inactive=<span class="number">60m</span> use_temp_path=<span class="literal">off</span>;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŒ‡å®šä¸Šæ¸¸æœåŠ¡,è¿™é‡Œå¯ä»¥é…ç½®è´Ÿè½½å‡è¡¡ç®—æ³•</span></span><br><span class="line">    <span class="attribute">upstream</span> local &#123;</span><br><span class="line">        <span class="attribute">server</span>  <span class="number">127.0.0.1:8081</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8082</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">192.168.0.105</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">access_log</span>  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>  Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>  X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>  X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment"># æŒ‡å®šåˆšåˆšå¼€è¾Ÿçš„å…±äº«å†…å­˜</span></span><br><span class="line">            <span class="attribute">proxy_cache</span>  my_cache;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å®šä¹‰ç¼“å­˜æ•°æ®å¯¹åº”çš„ key ç”±ä»€ä¹ˆç»„æˆ</span></span><br><span class="line">            <span class="attribute">proxy_cache_key</span>  <span class="variable">$host</span><span class="variable">$uri</span><span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç»™æŒ‡å®šçš„æƒ³ç”¨çª—å°å—è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œæœ€åä¸€ä¸ªå€¼æ—¶è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æ˜¯å°æ—¶ã€åˆ†é’Ÿç­‰å•ä½</span></span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">304</span> <span class="number">302</span> <span class="number">1d</span>;            </span><br><span class="line">           </span><br><span class="line">            <span class="attribute">proxy_pass</span>  http://local;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„é…ç½®ä¸­ä¹Ÿä»‹ç»äº†ä¸€äº›å¸¸ç”¨çš„ç¼“å­˜å‚æ•°ï¼Œè¯¦ç»†å‚æ•°ä¿¡æ¯å¯ä»¥å‚è€ƒ nginx çš„å®˜æ–¹æ–‡æ¡£ï¼Œæ–‡æ¡£åœ°å€ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;http&#x2F;ngx_http_proxy_module.html#proxy_cache_path</span><br></pre></td></tr></table></figure><h1 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h1><p>æ—¢ç„¶æåˆ°äº†åå‘ä»£ç†ï¼Œé‚£ä¹ˆè´Ÿè½½å‡è¡¡æ˜¯ä¸€å®šè¦è¯´ä¸€ä¸‹çš„ã€‚è´Ÿè½½å‡è¡¡çš„å¤§æ„å°±æ˜¯åå‘ä»£ç†æœåŠ¡å™¨æŠŠå®¢æˆ·ç«¯çš„è¯·æ±‚å‡åŒ€çš„ï¼Œæˆ–è€…æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†å‘ç»™ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œä»è€Œä¿è¯æœåŠ¡å¯ç”¨æ€§ã€‚</p><p>å®ç°è´Ÿè½½å‡è¡¡æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. æ°´å¹³æ‰©å±•ï¼šåŸºäº Round-Robinæˆ–è€…least-connectç®—æ³•è¿›è¡Œè¯·æ±‚åˆ†å‘</span><br><span class="line">2. æŒ‰åŠŸèƒ½æ‰©å±•ï¼šæ ¹æ®è¯·æ±‚URLï¼ŒæŒ‰ç…§åŠŸèƒ½åˆ†å‘è¯·æ±‚åˆ°ä¸Šæ¸¸æœåŠ¡å™¨</span><br><span class="line">3. åŸºäºç”¨æˆ·ä¿¡æ¯æ‰©å±•ï¼šæ ¹æ®è¯·æ±‚å®¢æˆ·ç«¯ipæˆ–è€…å…¶ä»–ä¿¡æ¯åˆ†å‘å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆåŸºäºhashçš„æŸäº›ç®—æ³•ï¼‰</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹å¼å¯ä»¥ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œå¹¶ä¸æ˜¯åªèƒ½å•ç‹¬ä½¿ç”¨ã€‚</p><p>nginxæ”¯æŒå¤šç§åè®®çš„åå‘ä»£ç†ï¼Œå³å®¢æˆ·ç«¯ä½¿ç”¨httpåè®®è¯·æ±‚æœåŠ¡æ—¶ï¼Œnginxå¯ä»¥å°†å…¶è½¬æ¢æˆfastcgiã€uwsgiã€rpcã€websocketç­‰åè®®ï¼Œå†å‘ä¸Šæ¸¸æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</p><h2 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p>nginx ä¸­è´Ÿè´£ä¸ä¸Šæ¸¸æœåŠ¡å™¨äº¤äº’çš„æ¨¡å—æ˜¯ upstream æ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸­æä¾›äº†ä¸€ä¸ªåŸºæœ¬çš„è´Ÿè½½å‡è¡¡ç®—æ³• Round-Robinã€‚</p><p>upstream æ¨¡å—ä¸­ï¼ŒæŒ‡å®šä¸Šæ¸¸æœåŠ¡å™¨çš„æŒ‡ä»¤æ˜¯ upstreamï¼Œä¸Šé¢çš„ä¾‹å­ä¸­å·²ç»è§è¿‡ï¼Œè¯¥æŒ‡ä»¤çš„ä½œç”¨åŸŸæ˜¯ http ä¸Šä¸‹æ–‡ã€‚åœ¨ upstream ä¸­ï¼Œä½¿ç”¨ server æŒ‡ä»¤æŒ‡å®šä¸Šæ¸¸æœåŠ¡å™¨åœ°å€ä¿¡æ¯ã€‚</p><p>Round-Robinè´Ÿè½½å‡è¡¡ç®—æ³•ä»‹ç»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¯¥ç®—æ³•åŠŸèƒ½ï¼šä»¥è½®è¯¢çš„æ–¹å¼è®¿é—® server æŒ‡ä»¤æŒ‡å®šçš„ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œè¯¥ç®—æ³•é›†æˆåœ¨ Nginx çš„ upstream æ¨¡å—ä¸­ã€‚</span><br></pre></td></tr></table></figure><p>è¯¥ç®—æ³•æä¾›ä»¥ä¸‹æŒ‡å®šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wieght: ä¸Šæ¸¸æœåŠ¡å™¨æƒé‡ï¼Œé»˜è®¤1</span><br><span class="line">max_connsï¼šä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ï¼Œä»…ç”¨äºå• worker è¿›ç¨‹ï¼Œé»˜è®¤0ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span><br><span class="line">max_fails: ä¸fail_timeouté…åˆä½¿ç”¨ã€‚åœ¨fail_timeoutæ—¶é—´æ®µå†…ï¼Œæœ€å¤§çš„å¤±è´¥æ¬¡æ•°ã€‚å½“è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°æ—¶ï¼Œåœ¨fail_timeoutæ—¶é—´å†…ï¼Œè¯¥ä¸Šæ¸¸æœåŠ¡å™¨ä¸å†è¢«é€‰æ‹©</span><br><span class="line">fail_timeout:å•ä½ç§’ï¼Œé»˜è®¤ä¸º10ï¼Œä¸max_failsé…åˆä½¿ç”¨ï¼Œæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼šï¼ŒæŒ‡å®šä¸€æ®µæ—¶é—´å†…æœ€å¤§çš„å¤±è´¥æ¬¡æ•°max_failsï¼›å½“åˆ°è¾¾max_failsåï¼Œè¯¥ä¸Šæ¸¸æœåŠ¡å™¨ä¸èƒ½å†è¢«è®¿é—®</span><br></pre></td></tr></table></figure><h2 id="åå‘ä»£ç†æœåŠ¡ä¸­åŠ å…¥è´Ÿè½½å‡è¡¡"><a href="#åå‘ä»£ç†æœåŠ¡ä¸­åŠ å…¥è´Ÿè½½å‡è¡¡" class="headerlink" title="åå‘ä»£ç†æœåŠ¡ä¸­åŠ å…¥è´Ÿè½½å‡è¡¡"></a>åå‘ä»£ç†æœåŠ¡ä¸­åŠ å…¥è´Ÿè½½å‡è¡¡</h2><h3 id="åŸºäº-Round-Robin-ç®—æ³•çš„è´Ÿè½½å‡è¡¡"><a href="#åŸºäº-Round-Robin-ç®—æ³•çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="åŸºäº  Round-Robin ç®—æ³•çš„è´Ÿè½½å‡è¡¡"></a>åŸºäº  Round-Robin ç®—æ³•çš„è´Ÿè½½å‡è¡¡</h3><h4 id="åå‘ä»£ç†æœåŠ¡é…ç½®"><a href="#åå‘ä»£ç†æœåŠ¡é…ç½®" class="headerlink" title="åå‘ä»£ç†æœåŠ¡é…ç½®"></a>åå‘ä»£ç†æœåŠ¡é…ç½®</h4><p>nginx.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                      <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                      <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">127.0.0.1:8081</span>;</span><br><span class="line">        <span class="comment"># server_name  192.168.0.103;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        <span class="attribute">access_log</span>  logs/access.log  main;</span><br><span class="line">        <span class="attribute">error_log</span>   logs/error.log;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">alias</span>  docs/;</span><br><span class="line">            <span class="attribute">autoindex</span>  <span class="literal">on</span>;  <span class="comment"># æ˜¾ç¤ºdocsç›®å½•ç»“æ„</span></span><br><span class="line">            <span class="attribute">set</span> <span class="variable">$limit_rate</span> <span class="number">1k</span>;</span><br><span class="line">            <span class="comment"># index  index.html index.htm;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># æŒ‡å®šåå‘ä»£ç†çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä¸­åŠ å…¥äº†è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attribute">include</span> reverse_proxy.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>reverse_proxy.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> proxy &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8011</span> weight=<span class="number">2</span> max_conns=<span class="number">2</span> max_fails=<span class="number">2</span> fail_timeout=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8012</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8091</span>;</span><br><span class="line">    <span class="attribute">error_log</span>  logs/reverse_proxy.err.log;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>  http://proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸Šæ¸¸æœåŠ¡é…ç½®"><a href="#ä¸Šæ¸¸æœåŠ¡é…ç½®" class="headerlink" title="ä¸Šæ¸¸æœåŠ¡é…ç½®"></a>ä¸Šæ¸¸æœåŠ¡é…ç½®</h4><p>nginx2.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                      <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                      <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">127.0.0.1:8082</span>;</span><br><span class="line">        <span class="comment"># server_name  192.168.0.103;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        <span class="attribute">access_log</span>  logs/access.log  main;</span><br><span class="line">        <span class="attribute">error_log</span>   logs/error.log;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">alias</span>  docs/;</span><br><span class="line">            <span class="attribute">autoindex</span>  <span class="literal">on</span>;  <span class="comment"># æ˜¾ç¤ºdocsç›®å½•ç»“æ„</span></span><br><span class="line">            <span class="attribute">set</span> <span class="variable">$limit_rate</span> <span class="number">1k</span>;</span><br><span class="line">            <span class="comment"># index  index.html index.htm;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># æŒ‡å®šä¸Šæ¸¸æœåŠ¡é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="attribute">include</span> upstream.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>upstream.confï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># ç›‘å¬ 8011 ç«¯å£</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8011</span>;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">'8011 server response'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># ç›‘å¬ 8012 ç«¯å£</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8012</span>;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">'8012 server response'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æœåŠ¡é…ç½®å¥½ä»¥åï¼Œå¯ä»¥åˆ†åˆ«å¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨åå‘ä»£ç†æœåŠ¡ï¼šsudo nginx -c nginx.conf</span><br><span class="line">å¯åŠ¨ä¸Šæ¸¸æœåŠ¡ï¼šsudo nginx -c nginx2.conf</span><br></pre></td></tr></table></figure><p>æœåŠ¡å¯åŠ¨åï¼Œåœ¨ç»ˆç«¯å¤šæ¬¡æ‰§è¡Œ curl localhost:8091ï¼Œå¯ä»¥å‘ç°ï¼Œå“åº”ç»“æœä¸­ï¼Œâ€™8011 server responseâ€™ å’Œ â€˜8012 server responseâ€™ çš„æ¯”ä¾‹å¤§è‡´ä¸º 2:1ï¼Œè¿™è¯´æ˜æˆ‘ä»¬é…ç½®çš„è´Ÿè½½å‡è¡¡å·²ç»ç”Ÿæ•ˆäº†ã€‚</p><h3 id="åŸºäº-ip-hash-çš„è´Ÿè½½å‡è¡¡"><a href="#åŸºäº-ip-hash-çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="åŸºäº ip hash çš„è´Ÿè½½å‡è¡¡"></a>åŸºäº ip hash çš„è´Ÿè½½å‡è¡¡</h3><p>åŸºäº ip åœ°å€çš„ hash ç®—æ³•å¯ä»¥æ ¹æ®å®¢æˆ·ç«¯ ip çš„ä¸åŒï¼Œå°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå®ƒçš„é…ç½®å¦‚ä¸‹ï¼ˆä»…ä»…ä¿®æ”¹äº† reverse_proxy.confæ–‡ä»¶ï¼‰ï¼š</p><p>reverse_proxy.confï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream proxy &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 127.0.0.1:8011 weight&#x3D;2 max_conns&#x3D;2 max_fails&#x3D;2 fail_timeout&#x3D;5;</span><br><span class="line">    server 127.0.0.1:8012 weight&#x3D;1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    set_real_ip_from  192.168.0.105;</span><br><span class="line">    real_ip_recursive on;</span><br><span class="line">    real_ip_header X-Forwarded-For;</span><br><span class="line"></span><br><span class="line">    listen 8091;</span><br><span class="line">    error_log  logs&#x2F;reverse_proxy.err.log;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass  http:&#x2F;&#x2F;proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢ä½¿ç”¨äº† realip æ¨¡å—çš„ä¸€äº›æŒ‡ä»¤ï¼Œç°åœ¨çš„ nginx ç‰ˆæœ¬ä¸­ï¼Œrealipæ¨¡å—é»˜è®¤æ²¡æœ‰ç¼–è¯‘è¿› nginxï¼Œå¦‚æœè¦ä½¿ç”¨ è¯¥æ¨¡å—ï¼Œéœ€è¦å°† realip æ¨¡å—ç¼–è¯‘è¿› nginx ä¸­ã€‚å¦‚ä½•æŠŠæŸä¸ªæ¨¡å—ç¼–è¯‘è¿›å·²å®‰è£…çš„ nginx ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ã€‚</p><p>ä¸Šé¢æŒ‡å®šçš„å¤§è‡´æ„æ€å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip_hashï¼šæ ¹æ®ç”¨æˆ·çš„ ip åœ°å€åˆ†å‘å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°ä¸Šæ¸¸æœåŠ¡å™¨</span><br><span class="line">set_real_ip_fromï¼šè®¾ç½®å¯ä¿¡ä»»çš„åœ°å€</span><br><span class="line">real_ip_recursive onï¼šè¡¨ç¤ºåŸå§‹å®¢æˆ·ç«¯ ip åœ°å€ä¼šè¢«è¯·æ±‚å¤´ä¸­çš„æŸä¸ªéä¿¡ä»» ip åœ°å€ï¼ˆç”±real_ip_headerå†³å®šï¼‰æ›¿æ¢</span><br><span class="line">real_ip_header X-Forwarded-Forï¼šè¡¨ç¤ºä»¥ X-Forwarded-For ä¸­çš„æœ€åä¸€ä¸ª ip ä½œä¸º ip_hash å¯¹åº”çš„ ip åœ°å€</span><br></pre></td></tr></table></figure><p>å…·ä½“è§£é‡Šå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;http&#x2F;ngx_http_realip_module.html#set_real_ip_from</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆé‡å¯åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æµ‹è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;X-Forwarded-For: 10.112.23.45&quot; localhost:8091</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ›´æ¢ ip ï¼ŒæŸ¥çœ‹è¿”å›çš„ç»“æœã€‚</p><h3 id="åŸºäºå…³é”®å­—-hash-çš„è´Ÿè½½å‡è¡¡"><a href="#åŸºäºå…³é”®å­—-hash-çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="åŸºäºå…³é”®å­—  hash çš„è´Ÿè½½å‡è¡¡"></a>åŸºäºå…³é”®å­—  hash çš„è´Ÿè½½å‡è¡¡</h3><p>ä½¿ç”¨å…³é”®å­— hash æ—¶ï¼Œreverse_proxy.confçš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">upstream proxy &#123;</span><br><span class="line">    # ä½¿ç”¨ç‰¹å®šçš„å­—ç¬¦ä¸²ä½œä¸ºhashå€¼</span><br><span class="line">    hash user_$arg_username;</span><br><span class="line">    server 127.0.0.1:8011 weight&#x3D;2 max_conns&#x3D;2 max_fails&#x3D;2 fail_timeout&#x3D;5;</span><br><span class="line">    server 127.0.0.1:8012 weight&#x3D;1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    set_real_ip_from  192.168.0.105;</span><br><span class="line">    real_ip_recursive on;</span><br><span class="line">    real_ip_header X-Forwarded-For;</span><br><span class="line"></span><br><span class="line">    listen 8091;</span><br><span class="line">    error_log  logs&#x2F;reverse_proxy.err.log;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass  http:&#x2F;&#x2F;proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚æœåŠ¡æ—¶æ—¶ï¼Œä¼ å…¥ä¸åŒçš„ username å‚æ•°ï¼Œä¼šè¯·æ±‚ä¸åŒçš„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚</p><h3 id="hashç®—æ³•ä¼˜åŒ–"><a href="#hashç®—æ³•ä¼˜åŒ–" class="headerlink" title="hashç®—æ³•ä¼˜åŒ–"></a>hashç®—æ³•ä¼˜åŒ–</h3><p>å½“æœ‰ä¸Šæ¸¸æœåŠ¡å™¨å®•æœºæˆ–è€…éœ€è¦æ‰©å®¹æ—¶ï¼Œhash ç®—æ³•ä¼šå¯¼è‡´è´Ÿè½½å‡è¡¡çš„è·¯ç”±å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ï¼ˆä¾‹å¦‚ç¼“å­˜å¤±æ•ˆï¼‰ã€‚ä¸€è‡´æ€§ hash ç®—æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>nginx ä¸­é…ç½®ä¸€è‡´æ€§ hash æ¯”è¾ƒç®€å•ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><p>reverse_proxy.confï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">upstream proxy &#123;</span><br><span class="line">    # ä½¿ç”¨ç‰¹å®šçš„å­—ç¬¦ä¸²ä½œä¸ºhashå€¼</span><br><span class="line">    hash user_$arg_username consistent;</span><br><span class="line">    server 127.0.0.1:8011 weight&#x3D;2 max_conns&#x3D;2 max_fails&#x3D;2 fail_timeout&#x3D;5;</span><br><span class="line">    server 127.0.0.1:8012 weight&#x3D;1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    # set_real_ip_from  192.168.0.105;</span><br><span class="line">    # real_ip_recursive on;</span><br><span class="line">    real_ip_header X-Forwarded-For;</span><br><span class="line"></span><br><span class="line">    listen 8091;</span><br><span class="line">    error_log  logs&#x2F;reverse_proxy.err.log;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass  http:&#x2F;&#x2F;proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åŸæ¥çš„ hash key åé¢åŠ ä¸Š consistent å³å¯å®ç°ä¸€è‡´æ€§ hashï¼Œå…·ä½“ä»‹ç»å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;http&#x2F;ngx_http_upstream_module.html#hash</span><br></pre></td></tr></table></figure><h3 id="åŸºäºæœ€å°‘è¿æ¥æ•°ç®—æ³•çš„è´Ÿè½½å‡è¡¡"><a href="#åŸºäºæœ€å°‘è¿æ¥æ•°ç®—æ³•çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="åŸºäºæœ€å°‘è¿æ¥æ•°ç®—æ³•çš„è´Ÿè½½å‡è¡¡"></a>åŸºäºæœ€å°‘è¿æ¥æ•°ç®—æ³•çš„è´Ÿè½½å‡è¡¡</h3><p>æœ€å°‘è¿æ¥æ•°ç®—æ³•ä¸­ï¼Œnginx åå‘ä»£ç†æœåŠ¡å™¨ä¼šå°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°è¿æ¥æ•°æœ€å°‘çš„ä¸Šæ¸¸æœåŠ¡å™¨ä¸­ã€‚å½“æœ‰å¤šä¸ªä¸Šæ¸¸æœåŠ¡å™¨æœ€å°‘è¿æ¥æ•°ç›¸åŒæ—¶ï¼Œä¼šæŒ‰ç…§ Roubd-Robin ç®—æ³•å°†è¯·æ±‚å‘é€åˆ°è¿™å‡ ä¸ªæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªã€‚æœ€å°‘è¿æ¥æ•°ç®—æ³•çš„é…ç½®å¦‚ä¸‹ï¼š</p><p>reverse_proxy.confï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream proxy &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server 127.0.0.1:8011 weight&#x3D;2 max_conns&#x3D;2 max_fails&#x3D;2 fail_timeout&#x3D;5;</span><br><span class="line">    server 127.0.0.1:8012 weight&#x3D;1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    # set_real_ip_from  192.168.0.105;</span><br><span class="line">    # real_ip_recursive on;</span><br><span class="line">    real_ip_header X-Forwarded-For;</span><br><span class="line"></span><br><span class="line">    listen 8091;</span><br><span class="line">    error_log  logs&#x2F;reverse_proxy.err.log;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass  http:&#x2F;&#x2F;proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ upstream ä¸Šä¸‹æ–‡ä¸­ï¼ŒåŠ å…¥ least_conn æŒ‡ä»¤å³å¯é…ç½®æœ€å°‘è¿æ¥æ•°ç®—æ³•ã€‚</p><p>å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;http&#x2F;ngx_http_upstream_module.html#least_conn</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©åˆ†äº«ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨ nginx æ­å»ºå…·æœ‰åå‘ä»£ç†åŠŸèƒ½çš„æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæŠŠ nginx å®˜æ–¹æ–‡æ¡£åœ°å€è´´å‡ºæ¥ï¼Œæœ‰é—®é¢˜å¯ä»¥éšæ—¶æŸ¥é˜…ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http:&amp;#x2F;&amp;#x2F;nginx.org&amp;#x2F;en&amp;#x2F;docs&amp;#x2F;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="http://wyzane.gitee.io/blog/categories/Nginx/"/>
    
    
  </entry>
  
  <entry>
    <title>iceé…åˆtornadoæ­å»ºhttpæœåŠ¡</title>
    <link href="http://wyzane.gitee.io/blog/2020/07/19/ice%E9%85%8D%E5%90%88tornado%E6%90%AD%E5%BB%BAhttp%E6%9C%8D%E5%8A%A1/"/>
    <id>http://wyzane.gitee.io/blog/2020/07/19/ice%E9%85%8D%E5%90%88tornado%E6%90%AD%E5%BB%BAhttp%E6%9C%8D%E5%8A%A1/</id>
    <published>2020-07-19T13:23:40.000Z</published>
    <updated>2020-07-19T13:28:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>tornado æ˜¯ python ä¸­çš„ä¸€ä¸ª http æ¡†æ¶ï¼Œä»¥å¼‚æ­¥é«˜æ€§èƒ½è‘—ç§°ï¼Œzeroc-ice æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ rpc æ¡†æ¶ï¼Œå°†ä¸¤è€…ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æ­å»ºé«˜æ€§èƒ½çš„ web åº”ç”¨æœåŠ¡ã€‚</p><p>ä¸‹é¢å†™äº†ä¸€ä¸ªå° demoï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨ tornado ä¸­ä½¿ç”¨ iceã€‚</p><a id="more"></a><h2 id="demoç»“æ„"><a href="#demoç»“æ„" class="headerlink" title="demoç»“æ„"></a>demoç»“æ„</h2><p>demo çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ app.py</span><br><span class="line">â”œâ”€â”€ handlers.py</span><br><span class="line">â”œâ”€â”€ Test</span><br><span class="line">â”‚Â Â  â””â”€â”€ __init__.py</span><br><span class="line">â”œâ”€â”€ Test.ice</span><br><span class="line">â”œâ”€â”€ Test_ice.py</span><br><span class="line">â””â”€â”€ user</span><br><span class="line">    â”œâ”€â”€ client.ini</span><br><span class="line">    â”œâ”€â”€ client.py</span><br><span class="line">    â”œâ”€â”€ __init__.py</span><br><span class="line">    â”œâ”€â”€ server.ini</span><br><span class="line">    â””â”€â”€ server.py</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒTest.ice æ˜¯ slice æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module Test</span><br><span class="line">&#123;</span><br><span class="line">    dictionary&lt;string, string&gt; Params;</span><br><span class="line"></span><br><span class="line">    interface User</span><br><span class="line">    &#123;</span><br><span class="line">        void printStr(string s);</span><br><span class="line"></span><br><span class="line">        int addMun(int num1, int num2);</span><br><span class="line"></span><br><span class="line">        string invoke(string fid, string params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ slice2py åï¼Œç”Ÿæˆäº† Test ç›®å½•å’Œ Test_ics.py æ–‡ä»¶ã€‚</p><p>handlers.py å’Œ app.py æ˜¯ tornado æ–‡ä»¶ï¼Œå†…å®¹åˆ†åˆ«å¦‚ä¸‹ï¼š</p><p>handlers.pyï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># @Author : WZ </span><br><span class="line"># @Time : 2020&#x2F;7&#x2F;19 13:48 </span><br><span class="line"># @Intro :</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line">import tornado.web</span><br><span class="line"></span><br><span class="line">from user.client import IceCommunicator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserHandler(tornado.web.RequestHandler):</span><br><span class="line"></span><br><span class="line">    def post(self, url):</span><br><span class="line">        print(&quot;url:&quot;, url)</span><br><span class="line">        # print(&quot;params:&quot;, self.request.body.decode(&quot;utf-8&quot;))</span><br><span class="line">        print(&quot;params:&quot;, self.request.arguments)</span><br><span class="line"></span><br><span class="line">        path &#x3D; &quot;user&#x2F;&quot; + url</span><br><span class="line">        params &#x3D; self.request.arguments</span><br><span class="line">        params &#x3D; &#123;k: params.get(k)[0].decode(&quot;utf-8&quot;) for k in params.keys()&#125;</span><br><span class="line"></span><br><span class="line">        resp &#x3D; self.invoke(path, params)</span><br><span class="line">        self.write(resp)</span><br><span class="line">        self.finish()</span><br><span class="line"></span><br><span class="line">    def invoke(self, path, params):</span><br><span class="line">        communicator &#x3D; IceCommunicator()</span><br><span class="line">        user &#x3D; communicator.init()</span><br><span class="line">        params &#x3D; json.dumps(params)</span><br><span class="line">        resp &#x3D; user.invoke(path, params)</span><br><span class="line">        return resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class GoodsHandler(tornado.web.RequestHandler):</span><br><span class="line"></span><br><span class="line">    def post(self):</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure><p>app.pyï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># @Author : WZ </span><br><span class="line"># @Time : 2020&#x2F;7&#x2F;19 13:46 </span><br><span class="line"># @Intro :</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import tornado.web</span><br><span class="line">import tornado.ioloop</span><br><span class="line">import tornado.options</span><br><span class="line">import tornado.httpserver</span><br><span class="line">from tornado.options import define, options</span><br><span class="line"></span><br><span class="line">from handlers import UserHandler, GoodsHandler</span><br><span class="line"></span><br><span class="line">define(&quot;port&quot;, default&#x3D;8000, help&#x3D;&quot;run on the given port&quot;, type&#x3D;int)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">    handlers &#x3D; [</span><br><span class="line">        (r&quot;&#x2F;user&#x2F;(.*)&quot;, UserHandler),</span><br><span class="line">        (r&quot;&#x2F;goods&#x2F;(.*)&quot;, GoodsHandler)</span><br><span class="line">    ]</span><br><span class="line">    app &#x3D; tornado.web.Application(handlers&#x3D;handlers)</span><br><span class="line">    http_server &#x3D; tornado.httpserver.HTTPServer(app)</span><br><span class="line">    http_server.listen(options.port)</span><br><span class="line">    tornado.ioloop.IOLoop.instance().start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure><p>userç›®å½•ä¸‹æ˜¯ ice ç›¸å…³çš„æ–‡ä»¶å’Œé…ç½®ï¼Œå†…å®¹åˆ†åˆ«å¦‚ä¸‹ï¼š</p><p>server.pyï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"># @Author : WZ </span><br><span class="line"># @Time : 2020&#x2F;7&#x2F;19 10:00 </span><br><span class="line"># @Intro :</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import Ice</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">Ice.loadSlice(&quot;..&#x2F;Test.ice&quot;)</span><br><span class="line">import Test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_resp(status&#x3D;None, msg&#x3D;None, data&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;è·å–å“åº”ä¿¡æ¯</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    resp &#x3D; dict()</span><br><span class="line">    resp[&quot;status&quot;] &#x3D; status if status else &#39;10000&#39;</span><br><span class="line">    resp[&quot;msg&quot;] &#x3D; msg if msg else &#39;ok&#39;</span><br><span class="line">    resp[&quot;data&quot;] &#x3D; data if data else &#123;&#125;</span><br><span class="line">    return resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserI(Test.User):</span><br><span class="line"></span><br><span class="line">    def printStr(self, s, current&#x3D;None):</span><br><span class="line">        print(&quot;hello ice&quot;)</span><br><span class="line"></span><br><span class="line">    def addMun(self, n1, n2, current&#x3D;None):</span><br><span class="line">        ret &#x3D; n1 + n2</span><br><span class="line">        print(&quot;addMun result is:&quot;, ret)</span><br><span class="line">        return ret</span><br><span class="line"></span><br><span class="line">    def invoke(self, path, params, current&#x3D;None):</span><br><span class="line">        &quot;&quot;&quot;è°ƒç”¨å…·ä½“ä¸šåŠ¡é€»è¾‘</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        user &#x3D; ViewUser()</span><br><span class="line"></span><br><span class="line">        params &#x3D; json.loads(params)</span><br><span class="line"></span><br><span class="line">        map &#x3D; &#123;</span><br><span class="line">            &quot;user&#x2F;list&quot;: user.list,</span><br><span class="line">            &quot;user&#x2F;detail&quot;: user.detail,</span><br><span class="line">            &quot;user&#x2F;add&quot;: user.add</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        resp &#x3D; map.get(path, user.others)(params)</span><br><span class="line">        return resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ViewUser():</span><br><span class="line"></span><br><span class="line">    def list(self, params):</span><br><span class="line">        resp &#x3D; get_resp(data&#x3D;&#123;&quot;url&quot;: &quot;user&#x2F;list&quot;&#125;)</span><br><span class="line">        print(&quot;user list:&quot;, params)</span><br><span class="line">        return json.dumps(resp)</span><br><span class="line"></span><br><span class="line">    def detail(self, params):</span><br><span class="line">        resp &#x3D; get_resp(data&#x3D;&#123;&quot;url&quot;: &quot;user&#x2F;detail&quot;&#125;)</span><br><span class="line">        print(&quot;user detail:&quot;, params)</span><br><span class="line">        return json.dumps(resp)</span><br><span class="line"></span><br><span class="line">    def add(self, params):</span><br><span class="line">        resp &#x3D; get_resp(data&#x3D;&#123;&quot;url&quot;: &quot;user&#x2F;add&quot;&#125;)</span><br><span class="line">        print(&quot;user add:&quot;, params)</span><br><span class="line">        return json.dumps(resp)</span><br><span class="line"></span><br><span class="line">    def others(self, params):</span><br><span class="line">        resp &#x3D; get_resp(&#39;10001&#39;, &#39;not found&#39;)</span><br><span class="line">        return json.dumps(resp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with Ice.initialize(sys.argv, &quot;server.ini&quot;) as communicator:</span><br><span class="line">    adapter &#x3D; communicator.createObjectAdapter(&quot;User&quot;)</span><br><span class="line">    adapter.add(UserI(), Ice.stringToIdentity(&quot;user&quot;))</span><br><span class="line">    adapter.activate()</span><br><span class="line">    communicator.waitForShutdown()</span><br></pre></td></tr></table></figure><p>client.pyï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># @Author : WZ </span><br><span class="line"># @Time : 2020&#x2F;7&#x2F;19 10:00 </span><br><span class="line"># @Intro :</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import Ice</span><br><span class="line"></span><br><span class="line">Ice.loadSlice(&quot;Test.ice&quot;)</span><br><span class="line">import Test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class IceCommunicator:</span><br><span class="line"></span><br><span class="line">    def init(self):</span><br><span class="line">        communicator &#x3D; Ice.initialize(sys.argv, &#39;user&#x2F;client.ini&#39;)</span><br><span class="line">        user &#x3D; Test.UserPrx.checkedCast(communicator.propertyToProxy(&#39;User.Proxy&#39;)</span><br><span class="line">                                        .ice_twoway()</span><br><span class="line">                                        .ice_secure(False))</span><br><span class="line">        if not user:</span><br><span class="line">            print(&quot;invalid proxy&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line"></span><br><span class="line">        return user</span><br></pre></td></tr></table></figure><p>server.iniï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.Endpoints&#x3D;tcp -p 10000</span><br><span class="line">Ice.Default.Host&#x3D;localhost</span><br><span class="line">Ice.Warn.Connections&#x3D;1</span><br></pre></td></tr></table></figure><p>client.iniï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.Proxy&#x3D;user:tcp -p 10000</span><br><span class="line">Ice.Default.Host&#x3D;localhost</span><br><span class="line">Ice.Warn.Connections&#x3D;1</span><br></pre></td></tr></table></figure><h2 id="demoæ‰§è¡Œæµç¨‹"><a href="#demoæ‰§è¡Œæµç¨‹" class="headerlink" title="demoæ‰§è¡Œæµç¨‹"></a>demoæ‰§è¡Œæµç¨‹</h2><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. app.py ä¸­æ¥å— http è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„ handler</span><br><span class="line">2. åœ¨ hendler ä¸­è°ƒç”¨ ice å®¢æˆ·ç«¯å‘ ice æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè¯·æ±‚ ice æœåŠ¡ç«¯æ—¶ä¼šä¼ å…¥è¯·æ±‚ path å’Œå‚æ•°</span><br><span class="line">3. ice æœåŠ¡ç«¯æ ¹æ®ä¸åŒçš„è¯·æ±‚ path æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œå¹¶è¿”å›å“åº”ç»“æœ</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»…ä»…æ˜¯ä¸€ä¸ªå°çš„ demoï¼Œåé¢è¿˜ä¼šæ›´è¿‘ä¸€æ­¥ç ”ç©¶ä¸¤è€…çš„ç»“åˆä½¿ç”¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;tornado æ˜¯ python ä¸­çš„ä¸€ä¸ª http æ¡†æ¶ï¼Œä»¥å¼‚æ­¥é«˜æ€§èƒ½è‘—ç§°ï¼Œzeroc-ice æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ rpc æ¡†æ¶ï¼Œå°†ä¸¤è€…ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æ­å»ºé«˜æ€§èƒ½çš„ web åº”ç”¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å†™äº†ä¸€ä¸ªå° demoï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨ tornado ä¸­ä½¿ç”¨ iceã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="tornado" scheme="http://wyzane.gitee.io/blog/tags/tornado/"/>
    
  </entry>
  
  <entry>
    <title>Pythonä¸­å¤šä¸ªè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåº</title>
    <link href="http://wyzane.gitee.io/blog/2020/07/13/Python%E4%B8%AD%E5%A4%9A%E4%B8%AA%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"/>
    <id>http://wyzane.gitee.io/blog/2020/07/13/Python%E4%B8%AD%E5%A4%9A%E4%B8%AA%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/</id>
    <published>2020-07-13T14:04:07.000Z</published>
    <updated>2020-07-13T14:17:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ€»ç»“ä¸‹ Python ä¸­å¤šä¸ªè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåºã€‚</p><a id="more"></a><p>è£…é¥°å™¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper_out1</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'--out11--'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner1</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"--in11--"</span>)</span><br><span class="line">        ret = func(*args, **kwargs)</span><br><span class="line">        print(<span class="string">"--in12--"</span>)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    print(<span class="string">"--out12--"</span>)</span><br><span class="line">    <span class="keyword">return</span> inner1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper_out2</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'--out21--'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner2</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"--in21--"</span>)</span><br><span class="line">        ret = func(*args, **kwargs)</span><br><span class="line">        print(<span class="string">"--in22--"</span>)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    print(<span class="string">"--out22"</span>)</span><br><span class="line">    <span class="keyword">return</span> inner2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@wrapper_out2</span></span><br><span class="line"><span class="meta">@wrapper_out1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"--test--"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">--out11--</span><br><span class="line">--out12--</span><br><span class="line">--out21--</span><br><span class="line">--out22--</span><br><span class="line">--in21--</span><br><span class="line">--in11--</span><br><span class="line">--test--</span><br><span class="line">--in12--</span><br><span class="line">--in22--</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œé¡ºåºä»¥å›¾ç‰‡å½¢å¼å±•ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="python01.png" alt="python01"></p><p>å…ˆè¿›å…¥ç¦»testå‡½æ•°æœ€è¿‘çš„è£…é¥°å™¨ï¼Œç”±äºè£…é¥°å™¨ä¸­è¿”å›çš„æ˜¯å‡½æ•°çš„å‡½æ•°åå¼•ç”¨ï¼Œå¹¶éçœŸæ­£è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥å…ˆæ‰“å°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--out11--</span><br><span class="line">--out12--</span><br><span class="line">--out21--</span><br><span class="line">--out22--</span><br></pre></td></tr></table></figure><p>åˆ°inner2åï¼Œfuncä¼šçœŸæ­£æ‰§è¡Œå‡½æ•°ï¼Œä¼šè°ƒç”¨ inner1() ,æ‰€ä»¥å†æ‰“å°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--in21--</span><br><span class="line">--in11--</span><br></pre></td></tr></table></figure><p>åˆ° inner1 ä¸­ï¼Œfunc ä¼šè°ƒç”¨testå‡½æ•°ï¼Œæ‰€ä»¥ä¼šæ‰“å°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--test--</span><br></pre></td></tr></table></figure><p>å†ä»å„ä¸ªå‡½æ•°å‡ºæ¥åï¼Œä¼šä¾æ¬¡æ‰“å°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--in12--</span><br><span class="line">--in22--</span><br></pre></td></tr></table></figure><p>åˆèµ·æ¥å°±æ˜¯ä¸Šé¢çš„æ‰§è¡Œç»“æœã€‚</p><p>ä»¥ä¸Šå°±æ˜¯å¤šä¸ªè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåºã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ€»ç»“ä¸‹ Python ä¸­å¤šä¸ªè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåºã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="python" scheme="http://wyzane.gitee.io/blog/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>zeroc iceåœ¨pythonä¸­çš„ä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2020/07/11/zeroc-ice%E5%9C%A8python%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2020/07/11/zeroc-ice%E5%9C%A8python%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-07-11T01:54:26.000Z</published>
    <updated>2020-07-19T13:22:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>zeroc ice æŒ‡çš„æ˜¯ zeroc å…¬å¸å¼€å‘çš„ä¸€æ¬¾ç½‘ç»œé€šè®¯å¼•æ“ iceã€‚ice æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ RPC æ¡†æ¶ï¼Œå¯ä»¥æ­å»ºåˆ†å¸ƒå¼åº”ç”¨ã€‚æœ€ä¸»è¦çš„ä¸€ç‚¹ï¼Œå®ƒæ˜¯è·¨è¯­è¨€çš„ï¼Œä¸ç®¡ä½ ä½¿ç”¨ Pythonã€Java è¿˜æ˜¯ C++ã€Rubyã€C# ç­‰å¼€å‘è¯­è¨€ï¼Œå®ƒéƒ½æ”¯æŒã€‚è¿˜æœ‰ä¸€ç‚¹ï¼Œice æä¾›äº†å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼šIceStormï¼ˆä¸€ç§è®¢é˜…æœåŠ¡ï¼Œç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€IceGrid ç­‰ã€‚</p><a id="more"></a><p>ä¸‹é¢ä»å®‰è£…ã€ä½¿ç”¨ç­‰å‡ ä¸ªæ–¹é¢ä»‹ç»ä¸‹ ice åœ¨ python ä¸­çš„ä½¿ç”¨ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>å®‰è£…ç¯å¢ƒæ˜¯ python3.6.9ï¼Œubuntu18.04ã€‚</p><h2 id="å®‰è£…æ–¹å¼ä¸€"><a href="#å®‰è£…æ–¹å¼ä¸€" class="headerlink" title="å®‰è£…æ–¹å¼ä¸€"></a>å®‰è£…æ–¹å¼ä¸€</h2><p>å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. sudo apt-get install openssl libssl-dev libbz2-dev</span><br><span class="line">    ç¬¬ä¸€æ­¥å®‰è£…ä¸æˆåŠŸæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ aptitude æ¥å®‰è£…éœ€è¦çš„åŒ…ï¼š</span><br><span class="line">sudo apt-get install aptitude </span><br><span class="line">sudo aptitude install xxxxx</span><br><span class="line">2. å®‰è£… ice for python: pip install zeroc-ice</span><br><span class="line">3. å®‰è£… ice for linux</span><br><span class="line">1ï¼‰å°†æºç å…‹éš†åˆ°æœ¬åœ°: git clone https:&#x2F;&#x2F;github.com&#x2F;zeroc-ice&#x2F;ice.git</span><br><span class="line">è‹¥ç½‘é€Ÿå¤ªæ…¢ï¼Œå¯ä»¥å…ˆåœ¨ç äº‘ä¸Šåˆ›å»ºé¡¹ç›®å¹¶å°†ice.gitå…‹éš†è¿‡å»ï¼Œå†ä»ç äº‘ä¸Šå…‹éš†</span><br><span class="line">2ï¼‰å…‹éš†å®Œæˆåï¼Œåˆ‡æ¢åˆ†æ”¯åˆ°3.7: git checkout 3.7ï¼ˆå®‰è£…3.7ç‰ˆæœ¬ï¼‰</span><br><span class="line">3ï¼‰ç¼–è¯‘ï¼šmake supported-languages&#x3D;&#39;cpp python&#39; ï¼ˆåªç¼–è¯‘c++å’Œpythonï¼Œè¿˜å¯ä»¥ç¼–è¯‘å…¶ä»–è¯­è¨€ï¼‰</span><br><span class="line">4ï¼‰å®‰è£…ï¼šmake install supported-languages&#x3D;&#39;cpp python&#39; prefix&#x3D;&#x2F;opt&#x2F;zeroc-ice </span><br><span class="line">5ï¼‰é…ç½®ç¯å¢ƒå˜é‡ï¼šåœ¨ .zshrc ä¸­æ·»åŠ é…ç½®: PATH&#x3D;$PATH:&#x2F;opt&#x2F;zeroc-ice&#x2F;bin</span><br><span class="line">6ï¼‰æ‰§è¡Œå‘½ä»¤: icegridnode -vï¼Œä¼šè¾“å‡ºå“åº”ç‰ˆæœ¬</span><br><span class="line">4. å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä» github ä¸Šå…‹éš† ice-demos æ¥å­¦ä¹ ã€‚</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…æ–¹å¼äºŒ"><a href="#å®‰è£…æ–¹å¼äºŒ" class="headerlink" title="å®‰è£…æ–¹å¼äºŒ"></a>å®‰è£…æ–¹å¼äºŒ</h2><p>æˆ–è€…ï¼Œå¯ä»¥æŒ‰ç…§ zeroc å®˜æ–¹æ–‡æ¡£è¿›è¡Œå®‰è£…ï¼Œå®˜æ–¹æ–‡æ¡£å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;zeroc.com&#x2F;downloads&#x2F;ice&#x2F;3.7&#x2F;python</span><br></pre></td></tr></table></figure><h1 id="åŸºç¡€ä»‹ç»"><a href="#åŸºç¡€ä»‹ç»" class="headerlink" title="åŸºç¡€ä»‹ç»"></a>åŸºç¡€ä»‹ç»</h1><p>é¦–å…ˆç®€å•ä»‹ç»ä¸‹ ice ä¸­ç›¸å…³æ¦‚å¿µå’Œä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p><h2 id="sliceè¯­è¨€"><a href="#sliceè¯­è¨€" class="headerlink" title="sliceè¯­è¨€"></a>sliceè¯­è¨€</h2><p>Slice (Specification Language for Ice) æ˜¯å®ç° Ice åè®®çš„å¼€å‘è¯­è¨€ï¼Œå®ƒå¯ä»¥æŠŠ Ice æ¥å£çš„å®ç°ç¿»è¯‘æˆä¸åŒçš„å¼€å‘è¯­è¨€ç‰ˆæœ¬ã€‚å¯¹äºä¸åŒçš„åº”ç”¨å¼€å‘è¯­è¨€ï¼Œæœ‰ä¸åŒçš„æ˜ å°„è§„åˆ™ã€‚</p><p>Slice æä¾›ä¸€ä¸ªåŸºæœ¬çš„æŠ½è±¡æœºåˆ¶ç”¨äºåˆ†ç¦»æ¥å£å’Œä»–ä»¬çš„å®ç°ã€‚Slice ç”¨äºæè¿°æ¥å£ï¼Œå»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„å…³ç³»ã€‚Sliceçš„æ¥å£æè¿°ä¸å…·ä½“å®ç°è¯­è¨€æ— å…³ï¼Œå³å®ƒå¯ä»¥è®©ä½ å®šä¹‰ client å’Œ server ä¹‹é—´çš„äº¤äº’è€Œä¸ç”¨å…³å¿ƒå…·ä½“çš„å¼€å‘è¯­è¨€ï¼Œä¾‹å¦‚ C++ï¼ŒJavaã€Pythonç­‰ã€‚é€šè¿‡ç¼–è¯‘ï¼Œå¯ä»¥æŠŠ Sliceå¯¹æ¥å£çš„æè¿°è½¬æ¢æˆä¸åŒçš„å¼€å‘è¯­è¨€ã€‚</p><h2 id="client-ä¸-server"><a href="#client-ä¸-server" class="headerlink" title="client ä¸ server"></a>client ä¸ server</h2><p>åœ¨ ice ä¸­ï¼Œclient å’Œ server ä¸æ˜¯æŒ‡ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿçš„ç‰¹å®šéƒ¨åˆ†ï¼Œå®ƒä»¬æ˜¯åœ¨ä¸€ä¸ªæŒç»­è¯·æ±‚ä¸­æ‰®æ¼”ä¸åŒè§’è‰²ï¼Œå…·æœ‰ä¸åŒçš„åŠŸèƒ½ã€‚</p><p>client ä¼šä¸»åŠ¨å‘ server å‘é€æœåŠ¡è¯·æ±‚ï¼Œè€Œ server ç«¯åªèƒ½è¢«åŠ¨çš„æ¥æ”¶è¯·æ±‚ï¼Œå¹¶é’ˆå¯¹è¯·æ±‚ï¼Œä¸º client ç«¯æä¾›ä¸åŒçš„æœåŠ¡ã€‚é€šå¸¸ï¼Œclient ä¼šä¸»åŠ¨å‘ server ç«¯å‘èµ·è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶ server ç«¯çš„å›è°ƒé€šçŸ¥ï¼Œè¿™æ ·çœ‹æ¥ï¼Œclient æ—¢æœ‰ client ç«¯å±æ€§ä¹Ÿæœ‰ server ç«¯å±æ€§ã€‚</p><p>client å’Œ server çš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="Ice_Client_and_Server_Structure.gif" alt="Ice_Client_and_Server_Structure"></p><p>ä¸Šé¢çš„ç»“æ„ä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ éƒ¨åˆ†ã€‚</p><h3 id="Ice-Core"><a href="#Ice-Core" class="headerlink" title="Ice Core"></a>Ice Core</h3><p>ice core åŒ…å«äº† client å’Œ server çš„è¿è¡Œæ—¶ï¼Œç”¨äºæ”¯æŒè¿œç¨‹é€šä¿¡ã€‚è¿™éƒ¨åˆ†åŒ…å«äº†ç½‘ç»œé€šä¿¡ã€çº¿ç¨‹ã€å­—èŠ‚åºåŠå…¶ä»–ç½‘ç»œç›¸å…³çš„ä»£ç å®ç°ï¼Œå¹¶ä¸åº”ç”¨å±‚ä»£ç åˆ†ç¦»å¼€æ¥ã€‚ice core æä¾›äº†ä¸€ç³»åˆ—åº“ä¾› client å’Œ server ç«¯è°ƒç”¨ã€‚</p><h3 id="Ice-API"><a href="#Ice-API" class="headerlink" title="Ice API"></a>Ice API</h3><p>ice ä¸­é€šè¿‡ ice api æ¥è®¿é—® ice coreï¼Œä½¿ç”¨ ice api æ¥åšä¸€äº›åŸºç¡€å·¥ä½œï¼Œä¾‹å¦‚åˆå§‹åŒ–å’Œèµ„æºå›æ”¶ã€‚ice api å¯¹äº client å’Œ server ç«¯æ¥è¯´æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><h3 id="Proxy-Code"><a href="#Proxy-Code" class="headerlink" title="Proxy Code"></a>Proxy Code</h3><p>proxy code éƒ¨åˆ†æ˜¯æ ¹æ® slice æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹ç”Ÿæˆçš„ï¼Œå®ƒè§„å®šäº†å¯¹è±¡å’Œæ•°æ®çš„ç±»å‹ã€‚proxy code ä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>ä¸º client ç«¯æä¾›å‘ä¸‹è°ƒç”¨çš„æ¥å£ï¼Œåœ¨ proxy API è°ƒç”¨å‡½æ•°æœ€ç»ˆä¼šå‘ server ç«¯å‘é€ä¸€ä¸ª RPC æ¶ˆæ¯ï¼Œç„¶ååœ¨æœåŠ¡ç«¯æ‰§è¡Œå“åº”çš„ç›®æ ‡å‡½æ•°</li><li>æä¾›ç»„åŒ…å’Œè§£åŒ…ä»£ç ï¼Œç»„åŒ…æ˜¯åºåˆ—åŒ–å¤æ‚æ•°æ®ç»“æ„çš„è¿‡ç¨‹ï¼Œä¾‹å¦‚ä¸ºäº†åœ¨ç½‘ç»œä¸Šä¼ é€ï¼Œåºåˆ—åŒ–ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸ã€‚ç»„åŒ…ä¼šå°†æ•°æ®è½¬æ¢æˆä¸€ç§æ ‡å‡†çš„æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œå¹¶ä¸”ä¸å—å­—èŠ‚åºçš„å½±å“ã€‚è§£åŒ…å°±æ˜¯ç›¸åçš„è¿‡ç¨‹ã€‚</li></ol><h3 id="Skeleton-Code"><a href="#Skeleton-Code" class="headerlink" title="Skeleton Code"></a>Skeleton Code</h3><p>skeleton code ä¸ proxy code åŠŸèƒ½ç›¸ä¼¼ï¼Œåªæ˜¯å®ƒåœ¨ server ç«¯å‘æŒ¥ä½œç”¨ï¼Œproxy code æ˜¯åœ¨ client ç«¯çš„ã€‚å®ƒæä¾›äº†å‘ä¸Šè°ƒç”¨çš„æ¥å£ï¼Œå¹¶ä¸”å…è®¸ ice è¿è¡Œæ—¶å°†æ§åˆ¶çº¿ç¨‹è½¬æ¢ä¸ºåº”ç”¨ä»£ç ã€‚skeleton ä¸­ä¹ŸåŒ…å«ç»„åŒ…å’Œè§£åŒ…çš„åŠŸèƒ½ï¼Œä»¥ä¾¿ server ç«¯èƒ½æ¥æ”¶ client ç«¯ä¼ å…¥çš„å‚æ•°ï¼Œå¹¶ä¸”å‘ client ç«¯è¿”å›ç»“æœæˆ–è€…å¼‚å¸¸ã€‚</p><h3 id="Object-Adapter"><a href="#Object-Adapter" class="headerlink" title="Object Adapter"></a>Object Adapter</h3><p>object adapter æ˜¯ ice api çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåªåœ¨ server ç«¯ä½¿ç”¨ï¼Œå®ƒç”±å¦‚ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š</p><ol><li>å°†å®¢æˆ·ç«¯è¯·æ±‚ä¸ç¼–ç¨‹è¯­è¨€ä¸­çš„ç‰¹å®šæ–¹æ³•æ˜ å°„ï¼Œå³ object adapter ä¼šæ‰¾åˆ°å†…å­˜ä¸­å…·æœ‰ç‰¹å®šæ ‡è¯†çš„å¯¹è±¡</li><li>object adapter ä¸ä¼ è¾“åè®®æœ‰å…³ï¼Œå¦‚æœä¸€ä¸ª object adapter å¯¹åº”å¤šä¸ªä¼ è¾“åè®®ï¼Œserver å°±èƒ½æä¾›å¤šç§æœåŠ¡</li><li>object adapter å¯ä»¥ç”Ÿæˆ proxyï¼ˆproxy ä¼šè¢«å‘é€åˆ° client ç«¯ï¼‰ã€‚object adapter ä¸­è®°å½•äº†æ¯ä¸ªå¯¹è±¡çš„ç±»å‹ã€åç§°ã€ä¼ è¾“ä¿¡æ¯ã€‚å½“ server ç«¯æƒ³è¦åˆ›å»º proxy æ—¶ï¼Œobject adapter èƒ½åˆ›å»º proxy è€Œä¸éœ€è¦çŸ¥é“å…·ä½“ç»†èŠ‚ã€‚</li></ol><h2 id="Ice-Objects"><a href="#Ice-Objects" class="headerlink" title="Ice Objects"></a>Ice Objects</h2><p>ç®€å•æ¥è¯´ï¼Œice object å¯¹è±¡ä¸­å®šä¹‰äº†ä¸€äº›æ¥å£ï¼Œé€šè¿‡è°ƒç”¨è¿™äº›æ¥å£ï¼Œclient èƒ½å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼ˆä»¥ Python ä¸ºä¾‹ï¼‰ï¼Œice object ä¸­å®šä¹‰äº†ä¸€äº›æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®ç°äº†è¯·æ±‚åˆ›å»ºã€æ•°æ®ä¼ é€’ã€æ•°æ®æ¥æ”¶ç­‰åŠŸèƒ½ï¼›æˆ‘ä»¬åœ¨ slice æ–‡ä»¶ä¸­å®šä¹‰çš„æ¥å£ï¼Œç»è¿‡è½¬æ¢åæ˜¯ ice object çš„å­ç±»ï¼›server ç«¯éœ€è¦ç»§æ‰¿ ice object çš„å­ç±»æ¥å®ç°å…·ä½“çš„åŠŸèƒ½ã€‚</p><h2 id="Proxies"><a href="#Proxies" class="headerlink" title="Proxies"></a>Proxies</h2><p>é€šè¿‡ proxyï¼Œclient èƒ½ä¸ ice object å…³è”èµ·æ¥ï¼Œproxy å°±ç±»ä¼¼äº ice object çš„ä¸€ä¸ªä½¿è€…ã€‚å½“ client æƒ³è°ƒç”¨ ice object ä¸­çš„æŸä¸ªåŠŸèƒ½æ—¶ï¼ˆå…¶å®å°±æ˜¯æŸä¸ªæ–¹æ³•ï¼‰ï¼Œéœ€è¦é€šè¿‡ proxy ï¼Œè¿™æ—¶ä¼šæ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. å®šä½ ice object</span><br><span class="line">2. æ¿€æ´» ice object</span><br><span class="line">3. æ¿€æ´» server ç«¯çš„ ice object</span><br><span class="line">4. ä¼ é€’å…¥å‚åˆ° ice object ä¸­</span><br><span class="line">5. ç­‰å¾…æ“ä½œå®Œæˆ</span><br><span class="line">6. æŠŠå‡ºå‚å’Œç»“æœè¿”å›ç»™ client ç«¯</span><br></pre></td></tr></table></figure><p>proxy ä¿¡æ¯å¯ä»¥ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimplePrinter:default -p 10000</span><br></pre></td></tr></table></figure><p>è¿™ç§å­—ç¬¦ä¸²å½¢å¼çš„ proxy æ›´åŠ æ˜“äºç†è§£å’Œå­˜å‚¨ã€‚</p><p>proxy è¿˜åˆ†ä¸º Direct Proxy å’Œ Indirect Proxyã€‚Direct Proxy é€šå¸¸åŒ…æ‹¬ proxy å¯¹è±¡åç§°å’ŒæœåŠ¡å™¨åœ°å€ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸¤ç±»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. a protocol identifier (such TCP&#x2F;IP or UDP)</span><br><span class="line">2. a protocol-specific address (such as a host name and port number)</span><br></pre></td></tr></table></figure><p>Indirect Proxy æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯ä»…ä»…æä¾›å¯¹è±¡åç§°ï¼ˆå¦‚ï¼šSimplePrinterï¼‰ï¼Œå¦ä¸€ç§æ˜¯æä¾›å¯¹è±¡åç§°å’Œå¯¹è±¡é€‚é…å™¨åç§°ï¼ˆå¦‚ï¼šSimplePrinter@PrinterAdapterï¼‰ã€‚</p><h2 id="Ice-Protocol"><a href="#Ice-Protocol" class="headerlink" title="Ice Protocol"></a>Ice Protocol</h2><p>iceèƒ½æä¾› RPC åè®®ï¼Œè¿™äº› RPC åè®®å¯ä»¥ä½¿ç”¨å¤šç§åº•å±‚åè®®ï¼Œæœ€å¸¸ç”¨çš„æ˜¯TCPå’ŒUDPï¼Œä½†æ˜¯iceä¹Ÿæ”¯æŒ Websocket, Bluetooth å’Œ Appleâ€™s iAPã€‚Iceè¿˜å¯ä»¥ä½¿ç”¨ SSL åè®®å¯¹ä¼ è¾“æ•°æ®åŠ å¯†ã€‚</p><p>Ice åè®®ä¸­å®šä¹‰äº†ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. å®šä¹‰äº†ä¸€äº›æ¶ˆæ¯ç±»å‹ï¼Œä¾‹å¦‚è¯·æ±‚\åº”ç­”çš„æ¶ˆæ¯ç±»å‹</span><br><span class="line">2. å®šä¹‰äº†çŠ¶æ€æœºï¼Œç¡®å®šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¦‚ä½•äº¤æ¢æ•°æ®</span><br><span class="line">3. å®šä¹‰ç¼–ç è§„åˆ™ï¼Œç¡®å®šæ€æ ·è¡¨ç¤ºæ•°æ®ç±»å‹</span><br><span class="line">4. å®šä¹‰äº†æ¶ˆæ¯ç±»å‹çš„å¤´éƒ¨ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ç±»å‹ã€æ¶ˆæ¯å¤§å°ã€ä½¿ç”¨çš„åè®®ç­‰ã€‚</span><br></pre></td></tr></table></figure><p>Iceä¹Ÿæ”¯æŒæ•°æ®å‹ç¼©ï¼Œå½“å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼ è¾“çš„æ•°æ®é‡éå¸¸å¤§æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚<br>Ice åè®®éå¸¸é€‚åˆåˆ›å»ºé«˜æ•ˆçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬åˆ†å‘æ¶ˆæ¯è€Œä¸ç”¨å…³å¿ƒæ¶ˆæ¯å†…éƒ¨çš„å®ç°ã€‚<br>Ice åè®®ä¹Ÿæ”¯æŒåŒå‘çš„æ“ä½œï¼Œå³ï¼šå¦‚æœæœåŠ¡ç«¯ä¼ è¾“æ•°æ®åˆ°å®¢æˆ·ç«¯æä¾›çš„å›è°ƒå¯¹è±¡ä¸Šï¼Œå›è°ƒè¿‡ç¨‹å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯æœ€åˆåˆ›å»ºçš„è¿æ¥æ¥å®Œæˆã€‚</p><h2 id="Ice-Service"><a href="#Ice-Service" class="headerlink" title="Ice Service"></a>Ice Service</h2><p>å¯¹äºå¼€å‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼ŒIce Coreæä¾›äº†ä¸€ä¸ªå¤æ‚çš„ client-server å¹³å°ï¼Œç„¶è€Œï¼Œå®é™…å¼€å‘ä¸­ä¸ä»…ä»…éœ€è¦è¿œç¨‹å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿéœ€è¦æŒ‰éœ€æä¾›æœåŠ¡ã€å‘å®¢æˆ·ç«¯åˆ†å‘ä»£ç†ã€åˆ†å‘å¼‚æ­¥ä»»åŠ¡ã€å‘åº”ç”¨ç¨‹åºåˆ†å‘è¡¥ä¸ç­‰ç­‰ã€‚Ice æä¾›äº†ä»¥ä¸‹æœåŠ¡æ¥å®ç°ä¸Šé¢çš„åŠŸèƒ½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. IceGrid</span><br><span class="line">2. IceStorm</span><br><span class="line">3. IcePatch2</span><br><span class="line">4. Glacier2</span><br><span class="line">5. IceBridge</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»ä¸Šé¢çš„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¼€å‘ ice çš„ client å’Œ server æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. slice æ–‡ä»¶</span><br><span class="line">2. ice object</span><br><span class="line">3. proxy code</span><br><span class="line">4. object adapter</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™äº›éƒ½ä¼šåœ¨ä¸‹é¢çš„ä»£ç ä¸­ä½“ç°å‡ºæ¥ï¼Œå¯ä»¥å›æƒ³ä¸€ä¸‹å®ƒä»¬çš„åŠŸèƒ½åˆ†åˆ«æ˜¯ä»€ä¹ˆã€‚</p><h1 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h1><p>å®‰è£…å®Œæˆåï¼Œé¦–å…ˆçœ‹ç¬¬ä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­ã€‚</p><h2 id="ç¼–å†™-Slice-File"><a href="#ç¼–å†™-Slice-File" class="headerlink" title="ç¼–å†™ Slice File"></a>ç¼–å†™ Slice File</h2><p>å¼€å‘æ—¶ï¼Œé¦–å…ˆè¦ç¼–å†™ slice æ–‡ä»¶ï¼Œslice æ–‡ä»¶æ˜¯ä¸å¼€å‘è¯­è¨€æ— å…³çš„ã€‚ç¼–å†™å®Œæˆåï¼Œéœ€è¦ä½¿ç”¨ç¼–è¯‘å™¨å°†å…¶è½¬æ¢æˆä¸åŒçš„å¼€å‘è¯­è¨€ï¼Œä¾‹å¦‚è½¬æ¢æˆ Python æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ slice2pyã€‚slice æ–‡ä»¶é‡Œé¢çš„å†…å®¹å…¶å®å°±æ˜¯ä¸€äº›æ¥å£ï¼Œserver ç«¯å¼€å‘æ—¶éœ€è¦ç¼–å†™ Python ç±»æ¥å®ç°è¿™äº›æ¥å£ã€‚</p><p>Printer.iceï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module Demo</span><br><span class="line">&#123;</span><br><span class="line">    interface Printer</span><br><span class="line">    &#123;</span><br><span class="line">        void printString(string s);</span><br><span class="line"></span><br><span class="line">        int addMun(int num1, int num2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ Demo æ˜¯æ¨¡å—åç§°ï¼ŒPrinter æ˜¯æ¥å£åç§°ï¼Œæ¥å£é‡Œé¢æ˜¯æ–¹æ³•çš„å®šä¹‰ã€‚</p><p>ç¼–å†™å®Œæˆåï¼Œæ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slice2py Printer.ice</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæˆåï¼Œä¼šç”Ÿæˆ Printer_ice.py æ–‡ä»¶å’Œ Demo æ–‡ä»¶å¤¹ã€‚Demoæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ __init__.py</span><br><span class="line">â””â”€â”€ __pycache__</span><br><span class="line">    â””â”€â”€ __init__.cpython-36.pyc</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Demo&#x2F;__init__.py å†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line"># Generated by slice2py - DO NOT EDIT!</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">import Ice</span><br><span class="line">Ice.updateModule(&quot;Demo&quot;)</span><br><span class="line"></span><br><span class="line"># Modules:</span><br><span class="line">import Printer_ice</span><br><span class="line"></span><br><span class="line"># Submodules:</span><br></pre></td></tr></table></figure><p>Printer_ice.py æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Copyright (c) ZeroC, Inc. All rights reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Ice version 3.7.4</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &lt;auto-generated&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Generated from file `Printer.ice'</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Warning: do not edit this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &lt;/auto-generated&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> version_info <span class="keyword">as</span> _version_info_</span><br><span class="line"><span class="keyword">import</span> Ice, IcePy</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start of module Demo</span></span><br><span class="line">_M_Demo = Ice.openModule(<span class="string">'Demo'</span>)</span><br><span class="line">__name__ = <span class="string">'Demo'</span></span><br><span class="line"></span><br><span class="line">_M_Demo._t_Printer = IcePy.defineValue(<span class="string">'::Demo::Printer'</span>, Ice.Value, <span class="number">-1</span>, (), <span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">None</span>, ())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">'PrinterPrx'</span> <span class="keyword">not</span> <span class="keyword">in</span> _M_Demo.__dict__:</span><br><span class="line">    _M_Demo.PrinterPrx = Ice.createTempClass()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PrinterPrx</span><span class="params">(Ice.ObjectPrx)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">printString</span><span class="params">(self, s, context=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_printString.invoke(self, ((s, ), context))</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">printStringAsync</span><span class="params">(self, s, context=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_printString.invokeAsync(self, ((s, ), context))</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">begin_printString</span><span class="params">(self, s, _response=None, _ex=None, _sent=None, context=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_printString.begin(self, ((s, ), _response, _ex, _sent, context))</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">end_printString</span><span class="params">(self, _r)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_printString.end(self, _r)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">addMun</span><span class="params">(self, num1, num2, context=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_addMun.invoke(self, ((num1, num2), context))</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">addMunAsync</span><span class="params">(self, num1, num2, context=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_addMun.invokeAsync(self, ((num1, num2), context))</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">begin_addMun</span><span class="params">(self, num1, num2, _response=None, _ex=None, _sent=None, context=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_addMun.begin(self, ((num1, num2), _response, _ex, _sent, context))</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">end_addMun</span><span class="params">(self, _r)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.Printer._op_addMun.end(self, _r)</span><br><span class="line"></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">checkedCast</span><span class="params">(proxy, facetOrContext=None, context=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.PrinterPrx.ice_checkedCast(proxy, <span class="string">'::Demo::Printer'</span>, facetOrContext, context)</span><br><span class="line"></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">uncheckedCast</span><span class="params">(proxy, facet=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _M_Demo.PrinterPrx.ice_uncheckedCast(proxy, facet)</span><br><span class="line"></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">ice_staticId</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'::Demo::Printer'</span></span><br><span class="line">    _M_Demo._t_PrinterPrx = IcePy.defineProxy(<span class="string">'::Demo::Printer'</span>, PrinterPrx)</span><br><span class="line"></span><br><span class="line">    _M_Demo.PrinterPrx = PrinterPrx</span><br><span class="line">    <span class="keyword">del</span> PrinterPrx</span><br><span class="line"></span><br><span class="line">    _M_Demo.Printer = Ice.createTempClass()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Printer</span><span class="params">(Ice.Object)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">ice_ids</span><span class="params">(self, current=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="string">'::Demo::Printer'</span>, <span class="string">'::Ice::Object'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">ice_id</span><span class="params">(self, current=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'::Demo::Printer'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">ice_staticId</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'::Demo::Printer'</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">printString</span><span class="params">(self, s, current=None)</span>:</span></span><br><span class="line">            <span class="keyword">raise</span> NotImplementedError(<span class="string">"servant method 'printString' not implemented"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">addMun</span><span class="params">(self, num1, num2, current=None)</span>:</span></span><br><span class="line">            <span class="keyword">raise</span> NotImplementedError(<span class="string">"servant method 'addMun' not implemented"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> IcePy.stringify(self, _M_Demo._t_PrinterDisp)</span><br><span class="line"></span><br><span class="line">        __repr__ = __str__</span><br><span class="line"></span><br><span class="line">    _M_Demo._t_PrinterDisp = IcePy.defineClass(<span class="string">'::Demo::Printer'</span>, Printer, (), <span class="literal">None</span>, ())</span><br><span class="line">    Printer._ice_type = _M_Demo._t_PrinterDisp</span><br><span class="line"></span><br><span class="line">    Printer._op_printString = IcePy.Operation(<span class="string">'printString'</span>, Ice.OperationMode.Normal, Ice.OperationMode.Normal, <span class="literal">False</span>, <span class="literal">None</span>, (), (((), IcePy._t_string, <span class="literal">False</span>, <span class="number">0</span>),), (), <span class="literal">None</span>, ())</span><br><span class="line">    Printer._op_addMun = IcePy.Operation(<span class="string">'addMun'</span>, Ice.OperationMode.Normal, Ice.OperationMode.Normal, <span class="literal">False</span>, <span class="literal">None</span>, (), (((), IcePy._t_int, <span class="literal">False</span>, <span class="number">0</span>), ((), IcePy._t_int, <span class="literal">False</span>, <span class="number">0</span>)), (), ((), IcePy._t_int, <span class="literal">False</span>, <span class="number">0</span>), ())</span><br><span class="line"></span><br><span class="line">    _M_Demo.Printer = Printer</span><br><span class="line">    <span class="keyword">del</span> Printer</span><br><span class="line"></span><br><span class="line"><span class="comment"># End of module Demo</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„å†…å®¹ä¸­å¯ä»¥çœ‹å‡ºï¼ŒPrinter_ice.py ä¸­ä¸»è¦æœ‰ä¸¤ä¸ª Python ç±» PrinterPrx å’Œ Printerã€‚</p><h2 id="ç¼–å†™-Server-ç«¯"><a href="#ç¼–å†™-Server-ç«¯" class="headerlink" title="ç¼–å†™ Server ç«¯"></a>ç¼–å†™ Server ç«¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, Ice</span><br><span class="line"><span class="keyword">import</span> Demo</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrinterI</span><span class="params">(Demo.Printer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printString</span><span class="params">(self, s, current=None)</span>:</span></span><br><span class="line">        print(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addMun</span><span class="params">(self, n1, n2, current=None)</span>:</span></span><br><span class="line">        ret = n1 + n2</span><br><span class="line">        print(ret)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> Ice.initialize(sys.argv) <span class="keyword">as</span> communicator:</span><br><span class="line">    adapter = communicator.createObjectAdapterWithEndpoints(<span class="string">"SimplePrinterAdapter"</span>, <span class="string">"default -p 10000"</span>)</span><br><span class="line">    object = PrinterI()</span><br><span class="line">    adapter.add(object, communicator.stringToIdentity(<span class="string">"SimplePrinter"</span>))</span><br><span class="line">    adapter.activate()</span><br><span class="line">    communicator.waitForShutdown()</span><br></pre></td></tr></table></figure><p>server ç«¯çš„ä»£ç ä¸­ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ª Python ç±» PrinterIï¼Œç»§æ‰¿äº† Demo.Printer å¹¶å®ç°äº†å…¶ä¸­çš„æ–¹æ³•ï¼›with ä»£ç å—ã€‚</p><p>with ä»£ç å—ä¸­çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. Ice.initialize()åˆå§‹åŒ– Ice è¿è¡Œç¯å¢ƒï¼Œè¿”å›ä¸€ä¸ªIce.Communicatorå¯¹è±¡ï¼Œå®ƒæ˜¯ Ice è¿è¡Œæ—¶çš„ä¸»è¦å¯¹è±¡</span><br><span class="line">2. communicator.createObjectAdapterWithEndpoints()åˆ›å»ºä¸€ä¸ª Object Adapter å¯¹è±¡ï¼Œ</span><br><span class="line">   &quot;SimplePrinterAdapter&quot;è¡¨ç¤º Adapter å¯¹è±¡åç§°ï¼Œ&quot;default -p 10000&quot; è¡¨ç¤ºä½¿ç”¨ TCP&#x2F;IPåè®®å¹¶ç›‘å¬10000ç«¯å£</span><br><span class="line">3. object &#x3D; PrinterI() è¡¨ç¤ºå®ä¾‹åŒ– Printer æ¥å£çš„å­ç±»</span><br><span class="line">4. è°ƒç”¨ Adapter å¯¹è±¡çš„ add æ–¹æ³•ï¼Œå°†å®ä¾‹åŒ–çš„å¯¹è±¡ç»‘å®šåˆ° Adapter ä¸­ã€‚add() æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ PrinterI ç±»çš„å¯¹    è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»™ PrinterI å¯¹è±¡æŒ‡å®šä¸€ä¸ªåç§°ï¼Œå¦‚æœæœ‰å¤šä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡æ—¶ï¼Œæ¯ä¸ªå¯¹è±¡çš„åç§°éƒ½ä¸èƒ½ç›¸åŒ</span><br><span class="line">5. adapter.activate() è¡¨ç¤ºå¯ç”¨ Adapter </span><br><span class="line">6. æœ€åï¼Œè°ƒç”¨ communicator.waitForShutdown() ä¼šé˜»å¡ç›´åˆ°æœåŠ¡å…³é—­</span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™-Client-ç«¯"><a href="#ç¼–å†™-Client-ç«¯" class="headerlink" title="ç¼–å†™ Client ç«¯"></a>ç¼–å†™ Client ç«¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, Ice</span><br><span class="line"><span class="keyword">import</span> Demo</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> Ice.initialize(sys.argv) <span class="keyword">as</span> communicator:</span><br><span class="line">    base = communicator.stringToProxy(<span class="string">"SimplePrinter:default -p 10000"</span>)</span><br><span class="line">    printer = Demo.PrinterPrx.checkedCast(base)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> printer:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">"Invalid proxy"</span>)</span><br><span class="line"> </span><br><span class="line">    printer.printString(<span class="string">"Hello World!"</span>)</span><br><span class="line">    ret = printer.addMun(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"client:"</span>, ret)</span><br></pre></td></tr></table></figure><p>client ä¸­åªæœ‰ä¸€ä¸ª with ä»£ç å—ï¼Œå…¶å«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. Ice.initialize()ï¼šåˆå§‹åŒ– Ice è¿è¡Œç¯å¢ƒ</span><br><span class="line">2. communicator.stringToProxy()ï¼šè·å¾—è¿œç«¯ printer çš„ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå‚æ•° &quot;SimplePrinter:default -p 10000&quot;    è¡¨ç¤ºåœ¨æœåŠ¡ç«¯æŒ‡å®šçš„ printer å¯¹è±¡åç§°å’Œç›‘å¬ç«¯å£</span><br><span class="line">3. stringToProxy()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªIce.ObjectPrxç±»å‹ï¼Œå®ƒæ˜¯å…¶ä»–æ‰€æœ‰æ¥å£çš„çˆ¶ç±»ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯éœ€è¦ä¸€ä¸ª          Demo.Printer ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ç±»å‹å‘ä¸‹çš„è½¬æ¢ã€‚ä½¿ç”¨ Demo.PrinterPrx.checkedCast(base) å¯ä»¥å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œ    ç¡®è®¤ä»£ç†æ˜¯å¦æ˜¯ Demo.Printerç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œå°±è¿”å›ä¸€ä¸ª Demo.PrinterPrx ç±»å‹çš„ä»£ç†ï¼Œå¦åˆ™è¿”å›None</span><br><span class="line">4. printer.printString(&quot;Hello World!&quot;) è°ƒç”¨æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™å®Œæˆåï¼Œæ‰§è¡Œ Python æ–‡ä»¶å°±è¡Œäº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python server.py</span><br><span class="line">python client.py</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;zeroc ice æŒ‡çš„æ˜¯ zeroc å…¬å¸å¼€å‘çš„ä¸€æ¬¾ç½‘ç»œé€šè®¯å¼•æ“ iceã€‚ice æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ RPC æ¡†æ¶ï¼Œå¯ä»¥æ­å»ºåˆ†å¸ƒå¼åº”ç”¨ã€‚æœ€ä¸»è¦çš„ä¸€ç‚¹ï¼Œå®ƒæ˜¯è·¨è¯­è¨€çš„ï¼Œä¸ç®¡ä½ ä½¿ç”¨ Pythonã€Java è¿˜æ˜¯ C++ã€Rubyã€C# ç­‰å¼€å‘è¯­è¨€ï¼Œå®ƒéƒ½æ”¯æŒã€‚è¿˜æœ‰ä¸€ç‚¹ï¼Œice æä¾›äº†å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼šIceStormï¼ˆä¸€ç§è®¢é˜…æœåŠ¡ï¼Œç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€IceGrid ç­‰ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="python" scheme="http://wyzane.gitee.io/blog/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Redisä¸»ä»å¤åˆ¶çš„æ­å»º</title>
    <link href="http://wyzane.gitee.io/blog/2020/07/04/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E6%90%AD%E5%BB%BA/"/>
    <id>http://wyzane.gitee.io/blog/2020/07/04/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E6%90%AD%E5%BB%BA/</id>
    <published>2020-07-04T02:01:34.000Z</published>
    <updated>2024-02-02T06:20:07.420Z</updated>
    
    <content type="html"><![CDATA[<p>Redis çš„ä¸»ä»å¤åˆ¶æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼Œåœ¨å¤§å‹ç³»ç»Ÿä¸­ï¼Œä¸ºäº†åˆ†æ‹… Redis çš„è¯»å†™å‹åŠ›ï¼Œå¯ä»¥ä½¿ç”¨ä¸»ä»å¤åˆ¶åŠŸèƒ½ã€‚ä¸‹é¢ä»‹ç»ä¸‹ Redis ä¸»ä»å¤åˆ¶çš„æ­å»ºã€‚</p><a id="more"></a><h1 id="ä¸»ä»å¤åˆ¶åŸç†"><a href="#ä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="ä¸»ä»å¤åˆ¶åŸç†"></a>ä¸»ä»å¤åˆ¶åŸç†</h1><h2 id="Redis-æŒä¹…åŒ–æ–¹å¼"><a href="#Redis-æŒä¹…åŒ–æ–¹å¼" class="headerlink" title="Redis æŒä¹…åŒ–æ–¹å¼"></a>Redis æŒä¹…åŒ–æ–¹å¼</h2><p>å…ˆä»‹ç»ä¸‹ Redis çš„æŒä¹…åŒ–æ–¹å¼ã€‚Redis çš„æŒä¹…åŒ–æ–¹å¼æœ‰ä¸¤ç§ rdbå’Œ aofï¼Œé»˜è®¤æ˜¯ rdb çš„æ–¹å¼ã€‚</p><h3 id="rdb-å¤‡ä»½æ–¹å¼"><a href="#rdb-å¤‡ä»½æ–¹å¼" class="headerlink" title="rdb å¤‡ä»½æ–¹å¼"></a>rdb å¤‡ä»½æ–¹å¼</h3><p>rdb æ˜¯åŠæŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ï¼Œå®ƒä¼šå®šæœŸå°†å†…å­˜ä¸­æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œä¿è¯æ•°æ®çš„æŒä¹…åŒ–ï¼Œæ°¸ä¹…ä¿å­˜Redisæ•°æ®ã€‚å®ƒæ˜¯é€šè¿‡å¿«ç…§ï¼ˆsnapshottingï¼‰çš„æ–¹å¼å®Œæˆçš„ï¼Œå½“æ»¡è¶³åœ¨ Redis.conf é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„æ¡ä»¶æ—¶ Redis ä¼šè‡ªåŠ¨å°†å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®è¿›è¡Œå¿«ç…§å¹¶å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œå®Œæˆæ•°æ®å¤‡ä»½ã€‚</p><p>Redisè¿›è¡Œ rdb å¿«ç…§çš„æ¡ä»¶ç”±ç”¨æˆ·åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰ï¼Œç”±ä¸¤ä¸ªå‚æ•°æ„æˆï¼šæ—¶é—´å’Œæ”¹åŠ¨é”®çš„ä¸ªæ•°ã€‚å½“åœ¨æŒ‡å®šæ—¶é—´å†…è¢«æ›´æ”¹é”®çš„ä¸ªæ•°å¤§äºæŒ‡å®šçš„æ•°å€¼æ—¶å°±ä¼šè¿›è¡Œå¿«ç…§ã€‚é…ç½®æ–‡ä»¶ä¸­é»˜è®¤é¢„å€¼äº†3ä¸ªæ¡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1       #900ç§’å†…æœ‰è‡³å°‘1ä¸ªé”®è¢«æ›´æ”¹åˆ™è¿›è¡Œå¿«ç…§ï¼›</span><br><span class="line">save 300 10      #300ç§’å†…æœ‰è‡³å°‘10ä¸ªé”®è¢«æ›´æ”¹åˆ™è¿›è¡Œå¿«ç…§ï¼›</span><br><span class="line">save 60  10000   #60ç§’å†…æœ‰è‡³å°‘10000ä¸ªé”®è¢«æ›´æ”¹åˆ™è¿›è¡Œå¿«ç…§</span><br></pre></td></tr></table></figure><p>é»˜è®¤å¯ä»¥å­˜åœ¨å¤šä¸ªæ¡ä»¶ï¼Œæ¡ä»¶ä¹‹é—´æ˜¯â€œæˆ–â€çš„å…³ç³»ï¼Œåªè¦æ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œå°±ä¼šè¿›è¡Œå¿«ç…§å¤‡ä»½æ•°æ®ã€‚è‹¥æƒ³è¦ç¦ç”¨è‡ªåŠ¨å¿«ç…§ï¼Œåªéœ€åˆ é™¤æ‰€æœ‰saveå‚æ•°å³å¯ã€‚</p><p>Redis é»˜è®¤ä¼šå°†å¿«ç…§æ–‡ä»¶å­˜å‚¨åœ¨ Redis æ•°æ®ç›®å½•ä¸­ï¼Œé»˜è®¤æ–‡ä»¶åæ˜¯ï¼šdump.rdbï¼Œå¯é€šè¿‡é…ç½®dirå’Œdbfilenameä¸¤ä¸ªå‚æ•°æ¥æŒ‡å®šå¿«ç…§æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œæ–‡ä»¶åã€‚</p><p>Rediså¿«ç…§è¿‡ç¨‹ï¼šRedisä½¿ç”¨forkå‡½æ•°å¤åˆ¶ä¸€ä»½å½“å‰è¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰çš„å‰¯æœ¬ï¼ˆå­è¿›ç¨‹ï¼‰ï¼Œçˆ¶è¿›ç¨‹è´Ÿè´£æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤ï¼Œè€Œå­è¿›ç¨‹è´Ÿè´£å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥ç¡¬ç›˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå½“å­è¿›ç¨‹å†™å®Œæ‰€æœ‰æ•°æ®åä¼šç”¨è¯¥ä¸´æ—¶æ–‡ä»¶æ›¿æ¢æ—§çš„ rdb æ–‡ä»¶ï¼Œè‡³æ­¤ä¸€æ¬¡å¿«ç…§æ“ä½œå®Œæˆã€‚<br>rdb æ–‡ä»¶æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ‰€ä»¥å ç”¨çš„ç©ºé—´ä¼šå°äºå†…å­˜ä¸­çš„æ•°æ®å¤§å°ã€‚é™¤äº†è‡ªåŠ¨å¿«ç…§ï¼Œè¿˜å¯ä»¥æ‰‹åŠ¨å‘é€SAVEå’ŒBGSAVE å‘½ä»¤è®©Redisæ‰§è¡Œå¿«ç…§ã€‚ä¸¤ä¸ªå‘½ä»¤åŒºåˆ«æ˜¯ï¼šSAVEæ˜¯ç”±ä¸»è¿›ç¨‹è¿›è¡Œå¿«ç…§æ“ä½œï¼Œä¼šé˜»å¡å…¶ä»–è¯·æ±‚ï¼ŒBGSAVEä¼šé€šè¿‡fork å­è¿›ç¨‹è¿›è¡Œå¿«ç…§æ“ä½œã€‚</p><p>æ‰‹åŠ¨æ‰§è¡Œå¤‡ä»½ï¼šredis-cli bgsave</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save  &#x2F;&#x2F; æ‰‹åŠ¨å¤‡ä»½</span><br><span class="line">bgsave  &#x2F;&#x2F; æ‰‹åŠ¨å¤‡ä»½</span><br><span class="line">config get dir  &#x2F;&#x2F; è·å–redisçš„dir</span><br></pre></td></tr></table></figure><h3 id="aof-å¤‡ä»½æ–¹å¼"><a href="#aof-å¤‡ä»½æ–¹å¼" class="headerlink" title="aof å¤‡ä»½æ–¹å¼"></a>aof å¤‡ä»½æ–¹å¼</h3><p>aof æ˜¯å…¨æŒä¹…åŒ–çš„å¤‡ä»½æ–¹å¼ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼ŒRedis ä¼šå®æ—¶å°†å†…å­˜ä¸­æ•°æ®åˆ·åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œä¿è¯æ•°æ®çš„æŒä¹…åŒ–ï¼Œæ°¸ä¹…ä¿å­˜Redi sæ•°æ®ã€‚å¦‚æœæ•°æ®éå¸¸é‡è¦æ— æ³•æ‰¿å—ä»»ä½•æŸå¤±ï¼Œå¯ä»¥ä½¿ç”¨ aof æ–¹å¼è¿›è¡ŒæŒä¹…åŒ–ï¼Œé»˜è®¤ Redis æ²¡æœ‰å¼€å¯ aofï¼ˆappend only fileï¼‰æ–¹å¼çš„å…¨æŒä¹…åŒ–æ¨¡å¼ã€‚</p><p>åœ¨å¯åŠ¨æ—¶ Redis ä¼šé€ä¸ªæ‰§è¡Œ apf æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥å°†ç¡¬ç›˜ä¸­çš„æ•°æ®è½½å…¥åˆ°å†…å­˜ä¸­ï¼Œè½½å…¥çš„é€Ÿåº¦ç›¸å¯¹äº rdb æ–¹å¼æ…¢äº›ï¼Œå¼€å¯ aof æŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡éƒ½ä¼šæ›´æ”¹Redisä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRediså°±ä¼šå°†å‘½ä»¤å†™å…¥ç¡¬ç›˜ä¸­çš„ aof æ–‡ä»¶ã€‚</p><p>Rediså…è®¸åŒæ—¶å¼€å¯ aof å’Œ rdb ï¼Œæ—¢ä¿è¯äº†æ•°æ®å®‰å…¨åˆä½¿å¾—è¿›è¡Œå¤‡ä»½ç­‰æ“ä½œååˆ†å®¹æ˜“ã€‚</p><p>Redis aofæŒä¹…åŒ–å‚æ•°é…ç½®è¯¦è§£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appendonly  yes                   #å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½ï¼›</span><br><span class="line">appendfilenameappendonly.aof      #AOFæŒä¹…åŒ–ä¿å­˜æ–‡ä»¶åï¼›</span><br><span class="line">appendfsyncalways                 #æ¯æ¬¡æ‰§è¡Œå†™å…¥éƒ½ä¼šæ‰§è¡ŒåŒæ­¥ï¼Œæœ€å®‰å…¨ä¹Ÿæœ€æ…¢ï¼›</span><br><span class="line">#appendfsynceverysec              #æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥æ“ä½œï¼›</span><br><span class="line">#appendfsyncno                    #ä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œè€Œæ˜¯å®Œå…¨äº¤ç”±æ“ä½œç³»ç»Ÿæ¥åšï¼Œæ¯30ç§’ä¸€æ¬¡ï¼Œæœ€å¿«ä¹Ÿæœ€ä¸å®‰å…¨ï¼›</span><br><span class="line">auto-aof-rewrite-percentage  100  #å½“AOFæ–‡ä»¶å¤§å°è¶…è¿‡ä¸Šä¸€æ¬¡é‡å†™æ—¶çš„AOFæ–‡ä»¶å¤§å°çš„ç™¾åˆ†ä¹‹å¤šå°‘æ—¶ä¼šå†æ¬¡è¿›è¡Œé‡å†™ï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰é‡å†™è¿‡ï¼Œåˆ™ä»¥å¯åŠ¨æ—¶çš„AOFæ–‡ä»¶å¤§å°ä¸ºä¾æ®ï¼›</span><br><span class="line">auto-aof-rewrite-min-size    64mb #å…è®¸é‡å†™çš„æœ€å°AOFæ–‡ä»¶å¤§å°é…ç½®å†™å…¥AOFæ–‡ä»¶åï¼Œè¦æ±‚ç³»ç»Ÿåˆ·æ–°ç¡¬ç›˜ç¼“å­˜çš„æœºåˆ¶ã€‚</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure><p>aof åˆ·æ–°æ—¥å¿—åˆ°diskçš„è§„åˆ™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendfsync always   #always è¡¨ç¤ºæ¯æ¬¡æœ‰å†™æ“ä½œéƒ½è¿›è¡ŒåŒæ­¥ï¼Œéå¸¸æ…¢ï¼Œéå¸¸å®‰å…¨ã€‚</span><br><span class="line">appendfsync everysec #everysecè¡¨ç¤ºå¯¹å†™æ“ä½œè¿›è¡Œç´¯ç§¯ï¼Œæ¯ç§’åŒæ­¥ä¸€æ¬¡</span><br></pre></td></tr></table></figure><p>å®˜æ–¹çš„å»ºè®®çš„everysecï¼Œå®‰å…¨ï¼Œå°±æ˜¯é€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œå¦‚æœæ˜¯æœºå™¨å‡ºç°é—®é¢˜å¯èƒ½ä¼šä¸¢å¤±1ç§’çš„æ•°æ®ã€‚</p><p>æ‰‹åŠ¨æ‰§è¡Œå¤‡ä»½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli bgrewriteaof</span><br></pre></td></tr></table></figure><h2 id="ä¸»ä»æ•°æ®åŒæ­¥"><a href="#ä¸»ä»æ•°æ®åŒæ­¥" class="headerlink" title="ä¸»ä»æ•°æ®åŒæ­¥"></a>ä¸»ä»æ•°æ®åŒæ­¥</h2><p>å½“ slave åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šå°† master ä¸Šçš„æ•°æ®å¤åˆ¶ä¸€ä»½åˆ°è‡ªå·±æœåŠ¡å™¨ä¸Šã€‚æ­¤åï¼Œæ¯å½“ master æ–°å¢æ•°æ®åï¼Œéƒ½ä¼šå°†å†™å‘½ä»¤å‘é€ä¸€ä»½åˆ° slave ä¸Šï¼Œslave æ¥æ”¶åˆ°å†™å‘½ä»¤åå°†æ•°æ®å†™å…¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ monitor å‘½ä»¤æ¥çœ‹ slave çš„å†™å…¥è¿‡ç¨‹ã€‚</p><p>ä¾‹å¦‚ï¼šå½“ master æ‰§è¡Œ set name wyzane åï¼Œä½¿ç”¨ monitor æŸ¥çœ‹åˆ° slave çš„æ‰§è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1593857563.031330 [0 192.168.0.105:6379] &quot;PING&quot;</span><br><span class="line">1593857553.918113 [0 192.168.0.105:6379] &quot;set&quot; &quot;name&quot; &quot;wyzane&quot;</span><br><span class="line">1593857563.031330 [0 192.168.0.105:6379] &quot;PING&quot;</span><br></pre></td></tr></table></figure><h1 id="ä¸»ä»å¤åˆ¶æ­å»º"><a href="#ä¸»ä»å¤åˆ¶æ­å»º" class="headerlink" title="ä¸»ä»å¤åˆ¶æ­å»º"></a>ä¸»ä»å¤åˆ¶æ­å»º</h1><p>ä¸‹é¢åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šå¼€å¯ä¸‰ä¸ª Redis è¿›ç¨‹ä¸ºä¾‹ï¼Œæ¥ä»‹ç»ä¸‹ä¸»ä»å¤åˆ¶çš„æ­å»ºè¿‡ç¨‹ã€‚</p><h2 id="ä¸éœ€è¦æƒé™æ ¡éªŒçš„ä¸»ä»å¤åˆ¶"><a href="#ä¸éœ€è¦æƒé™æ ¡éªŒçš„ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸éœ€è¦æƒé™æ ¡éªŒçš„ä¸»ä»å¤åˆ¶"></a>ä¸éœ€è¦æƒé™æ ¡éªŒçš„ä¸»ä»å¤åˆ¶</h2><p>é…ç½®çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹ Redis .conf é…ç½®æ–‡ä»¶ï¼Œmaster å’Œ slave çš„é…ç½®åˆ†åˆ«å¦‚ä¸‹ã€‚å…¶ä¸­ï¼Œprotected-mode no è¡¨ç¤º slave è¿æ¥ master æ—¶ä¸éœ€è¦å¯†ç æ ¡éªŒã€‚</p><p>masteré…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bind 192.168.0.105</span><br><span class="line">protected-mode no</span><br><span class="line">port 6379</span><br></pre></td></tr></table></figure><p>slqve1 çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bind 192.168.0.105</span><br><span class="line">slaveof 192.168.0.105 6379</span><br><span class="line">protected-mode no</span><br><span class="line">port 6380</span><br></pre></td></tr></table></figure><p>slave2 çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bind 192.168.0.105</span><br><span class="line">slaveof 192.168.0.105 6379</span><br><span class="line">protected-mode no</span><br><span class="line">port 6381</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨è¿™ä¸‰ä¸ªæœåŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf ï¼ˆmasterï¼‰</span><br><span class="line">redis-server redis2.conf ï¼ˆslave1ï¼‰</span><br><span class="line">redis-server redis3.conf ï¼ˆslave2ï¼‰</span><br></pre></td></tr></table></figure><p>æœåŠ¡å¯åŠ¨åï¼Œéœ€è¦è¿æ¥è¿™ä¸‰ä¸ªæœåŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.0.105 -p 6379</span><br><span class="line">redis-cli -h 192.168.0.105 -p 6380</span><br><span class="line">redis-cli -h 192.168.0.105 -p 6381</span><br></pre></td></tr></table></figure><p>è¿æ¥ä¸Šå®¢æˆ·ç«¯ï¼Œåœ¨ master ä¸Š set æ•°æ®åï¼Œå¯ä»¥åˆ†åˆ«åœ¨ slave1ã€slave2 ä¸Šçœ‹åˆ°è¿™äº›æ•°æ®ã€‚</p><h2 id="æƒé™æ ¡éªŒçš„ä¸»ä»é…ç½®"><a href="#æƒé™æ ¡éªŒçš„ä¸»ä»é…ç½®" class="headerlink" title="æƒé™æ ¡éªŒçš„ä¸»ä»é…ç½®"></a>æƒé™æ ¡éªŒçš„ä¸»ä»é…ç½®</h2><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œæƒé™æ ¡éªŒæ˜¯éå¸¸é‡è¦çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é…ç½®ä¸»ä»å¤åˆ¶æ—¶ï¼Œä¸€å®šè¦æŠŠæƒé™æ ¡éªŒçš„åŠŸèƒ½åŠ ä¸Šå»ã€‚æƒé™æ ¡éªŒé¦–å…ˆéœ€è¦æŠŠ master redis.conf ä¸­çš„ protected-mode å€¼è®¾ç½®ä¸º yesï¼ˆé»˜è®¤ï¼‰ï¼Œç„¶åå†è®¾ç½®å¯†ç ã€‚è®¾ç½®å¯†ç çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">protected-mode yes</span><br><span class="line">requirepass wyzane  # wyzane å°±æ˜¯å¯†ç </span><br></pre></td></tr></table></figure><p>è®¾ç½®å®Œæˆåï¼Œä½¿ç”¨ redis-cli æ—¶ï¼Œéœ€è¦æ‰§è¡Œ auth wyzaneï¼Œ å³è¾“å…¥å¯†ç ã€‚</p><p>slave1 è®¾ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth wyzane</span><br></pre></td></tr></table></figure><p>slave2 è®¾ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth wyzane</span><br></pre></td></tr></table></figure><p>è®¾ç½®å®Œæˆåï¼Œé‡å¯ Redis æœåŠ¡å°±å¯ä»¥äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Redis çš„ä¸»ä»å¤åˆ¶æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼Œåœ¨å¤§å‹ç³»ç»Ÿä¸­ï¼Œä¸ºäº†åˆ†æ‹… Redis çš„è¯»å†™å‹åŠ›ï¼Œå¯ä»¥ä½¿ç”¨ä¸»ä»å¤åˆ¶åŠŸèƒ½ã€‚ä¸‹é¢ä»‹ç»ä¸‹ Redis ä¸»ä»å¤åˆ¶çš„æ­å»ºã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="Redis" scheme="http://wyzane.gitee.io/blog/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>svnçš„ç®€å•ä½¿ç”¨</title>
    <link href="http://wyzane.gitee.io/blog/2020/06/27/svn%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>http://wyzane.gitee.io/blog/2020/06/27/svn%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</id>
    <published>2020-06-27T07:29:17.000Z</published>
    <updated>2020-06-27T13:11:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ git ä¸€æ ·ï¼Œsvn ï¼ˆSubversionï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç›¸æ¯”äº git çš„åˆ†å¸ƒå¼ç®¡ç†ï¼Œsvnæ˜¯ä¸€ä¸ªé›†ä¸­å¼çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚ä»Šå¤©ä»‹ç»ä¸‹å®ƒçš„ç®€å•ä½¿ç”¨ã€‚</p><a id="more"></a><p>svn æ˜¯é›†ä¸­å¼çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå®ƒä¾èµ–äº svn æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬ä¿¡æ¯éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚</p><h1 id="svnä½¿ç”¨æ€»ç»“"><a href="#svnä½¿ç”¨æ€»ç»“" class="headerlink" title="svnä½¿ç”¨æ€»ç»“"></a>svnä½¿ç”¨æ€»ç»“</h1><h2 id="åˆ›å»ºç‰ˆæœ¬åº“"><a href="#åˆ›å»ºç‰ˆæœ¬åº“" class="headerlink" title="åˆ›å»ºç‰ˆæœ¬åº“"></a>åˆ›å»ºç‰ˆæœ¬åº“</h2><p>svnçš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">ubuntuå®‰è£…svn</span><br><span class="line">1. apt-get update</span><br><span class="line">2. apt-get install subversion</span><br><span class="line">å®‰è£…å®Œæˆåï¼Œå¯ä»¥æ‰§è¡Œ svnserve --version æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">åˆ›å»ºç‰ˆæœ¬åº“ï¼š</span><br><span class="line">1. åœ¨ &#x2F;home&#x2F;wyzane ä¸‹åˆ›å»º svn ç›®å½•ï¼ˆä½œä¸ºä¸­å¤®ä»“åº“ï¼‰</span><br><span class="line">2. åˆ›å»ºä»“åº“ï¼šsvnadmin create &#x2F;home&#x2F;wyzane&#x2F;svn</span><br><span class="line">3. åˆ›å»ºå®Œæˆåï¼Œåœ¨ svn ä¸‹ä¼šç”Ÿæˆ confã€db ç­‰ç›®å½•</span><br><span class="line">ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</span><br><span class="line">        .</span><br><span class="line">        â”œâ”€â”€ conf</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ authz</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ hooks-env.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ passwd</span><br><span class="line">        â”‚Â Â  â””â”€â”€ svnserve.conf</span><br><span class="line">        â”œâ”€â”€ db</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ current</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ format</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ fsfs.conf</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ fs-type</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ min-unpacked-rev</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ rep-cache.db</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ rep-cache.db-journal</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ revprops</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ revs</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ transactions</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ txn-current</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ txn-current-lock</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ txn-protorevs</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ uuid</span><br><span class="line">        â”‚Â Â  â””â”€â”€ write-lock</span><br><span class="line">        â”œâ”€â”€ format</span><br><span class="line">        â”œâ”€â”€ hooks</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ post-commit.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ post-lock.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ post-revprop-change.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ post-unlock.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ pre-commit.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ pre-lock.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ pre-revprop-change.tmpl</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ pre-unlock.tmpl</span><br><span class="line">        â”‚Â Â  â””â”€â”€ start-commit.tmpl</span><br><span class="line">        â”œâ”€â”€ locks</span><br><span class="line">        â”‚Â Â  â”œâ”€â”€ db.lock</span><br><span class="line">        â”‚Â Â  â””â”€â”€ db-logs.lock</span><br><span class="line">        â””â”€â”€ README.txt</span><br><span class="line">å…¶ä¸­ï¼Œconfç›®å½•ä¸‹å­˜æ”¾äº†é…ç½®æ–‡ä»¶ï¼Œpasswd æ˜¯ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é…ç½®ç”¨æˆ·åå’Œå¯†ç ã€‚authz æ˜¯æƒé™é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é…ç½®ç”¨æˆ·å¯¹åº”çš„è¯»å†™æƒé™ï¼Œä¹Ÿå¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œåˆ†ç»„é…ç½®ã€‚svnserve.conf æ˜¯åŸºæœ¬çš„é…ç½®æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">å¯åŠ¨æœåŠ¡ï¼š</span><br><span class="line">svnserve -d -r &#x2F;home&#x2F;wyzane&#x2F;svn  (é»˜è®¤ç«¯å£ 3690)</span><br><span class="line">å…¶ä¸­ï¼š</span><br><span class="line">-dï¼šè¡¨ç¤ºåœ¨åå°è¿è¡Œ</span><br><span class="line">-rï¼šæŒ‡å®šæœåŠ¡å™¨çš„æ ¹ç›®å½•</span><br><span class="line">æŸ¥çœ‹è¿›ç¨‹ï¼šps aux | grep svnserve</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯ checkout ä»£ç éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">svn checkout svn:&#x2F;&#x2F;192.168.0.105&#x2F; --username wyzane</span><br></pre></td></tr></table></figure><p>åœ¨ windows ä¸‹ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½ svn çš„ windows ç‰ˆæœ¬è¿›è¡Œå®‰è£…ï¼Œä¸‹è½½åœ°å€ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;subversion.apache.org&#x2F;packages.html</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ”¯æ“ä½œ"><a href="#åˆ†æ”¯æ“ä½œ" class="headerlink" title="åˆ†æ”¯æ“ä½œ"></a>åˆ†æ”¯æ“ä½œ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. é¦–å…ˆåˆ›å»º branches ç›®å½•å¹¶æäº¤</span><br><span class="line">2. åˆ›å»ºåˆ†æ”¯ï¼šsvn copy trunk&#x2F; branches&#x2F;subï¼Œå¹¶ä½¿ç”¨ svn commit æäº¤ï¼ˆåŸºäº trunk çš„åˆ†æ”¯ï¼‰</span><br><span class="line">3. ä¿®æ”¹ sub åˆ†æ”¯ä¸Šçš„å†…å®¹å¹¶æäº¤</span><br><span class="line">4. åˆå¹¶åˆ†æ”¯ï¼šåˆ‡æ¢åˆ° trunk ç›®å½•ï¼Œæ‰§è¡Œsvn merge ..&#x2F;branches&#x2F;sub&#x2F;</span><br><span class="line">5. æäº¤åˆå¹¶åçš„å†…å®¹ï¼šsvn commit -m &quot;update&quot;</span><br></pre></td></tr></table></figure><h2 id="tagæ“ä½œ"><a href="#tagæ“ä½œ" class="headerlink" title="tagæ“ä½œ"></a>tagæ“ä½œ</h2><p>é€šè¿‡ tag æ ‡ç­¾ï¼Œå¯ä»¥ç»™æŸä¸€å…·ä½“çš„ç‰ˆæœ¬åŠ ä¸Šä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œä¾¿äºæ›´å¥½çš„ç®¡ç†ï¼Œtag çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. åˆ›å»º tags ç›®å½•å¹¶æäº¤ï¼šmkdir tags &amp; svn add tags &amp; svn commit -m &quot;commit tags dir&quot;</span><br><span class="line">2. åœ¨å½“å‰çš„ trunk ç‰ˆæœ¬ä¸Šæ‰“ä¸€ä¸ª tagï¼šsvn copy trunk&#x2F; tags&#x2F;v1.0</span><br><span class="line">3. æäº¤åˆ°ç‰ˆæœ¬åº“ï¼šsvn commit -m &quot;v1.0&quot;</span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svn add test.txt   # æ·»åŠ æ–‡ä»¶åˆ°ç‰ˆæœ¬åº“ä¸­</span><br><span class="line">A         test.txt</span><br><span class="line">svn status         # æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">A       test.txt  </span><br><span class="line">svn commit -m &quot;update&quot;   # å°†æ”¹åŠ¨çš„æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬åº“ï¼Œæ­¤æ—¶å†ä½¿ç”¨ svn status æ—¶ï¼Œå°±ä¸ä¼šæœ‰è¾“å‡ºä¿¡æ¯äº†</span><br><span class="line"></span><br><span class="line">svn update  # æ›´æ–°ç‰ˆæœ¬å“­çš„æ”¹åŠ¨åˆ°æœ¬åœ°</span><br><span class="line"></span><br><span class="line">svn log   # æŸ¥çœ‹ç‰ˆæœ¬åº“çš„æäº¤å†å²</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨æ—¶å¯èƒ½çš„é”™è¯¯"><a href="#ä½¿ç”¨æ—¶å¯èƒ½çš„é”™è¯¯" class="headerlink" title="ä½¿ç”¨æ—¶å¯èƒ½çš„é”™è¯¯"></a>ä½¿ç”¨æ—¶å¯èƒ½çš„é”™è¯¯</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. commit failedï¼Œ æ²¡æœ‰æ‰¾åˆ°äº‹åŠ¡5-9</span><br><span class="line">è§£å†³ï¼šè¿™æ˜¯å› ä¸º svnserve çš„æœåŠ¡æ²¡æœ‰å¼€å¯ï¼Œå¯åŠ¨ svnserve å³å¯ã€‚</span><br><span class="line"></span><br><span class="line">2. the error was æ¡ç›®ä¸å¯è¯»</span><br><span class="line">è§£å†³ï¼šé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ anon-access çš„å€¼ä¸º noneï¼Œç„¶åé‡å¯å³å¯</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸ git ä¸€æ ·ï¼Œsvn ï¼ˆSubversionï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç›¸æ¯”äº git çš„åˆ†å¸ƒå¼ç®¡ç†ï¼Œsvnæ˜¯ä¸€ä¸ªé›†ä¸­å¼çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚ä»Šå¤©ä»‹ç»ä¸‹å®ƒçš„ç®€å•ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="SVN" scheme="http://wyzane.gitee.io/blog/tags/SVN/"/>
    
  </entry>
  
  <entry>
    <title>gitæ“ä½œä¸åˆ†æ”¯ç®¡ç†</title>
    <link href="http://wyzane.gitee.io/blog/2020/06/21/git%E6%93%8D%E4%BD%9C%E4%B8%8E%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/"/>
    <id>http://wyzane.gitee.io/blog/2020/06/21/git%E6%93%8D%E4%BD%9C%E4%B8%8E%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/</id>
    <published>2020-06-21T13:38:08.000Z</published>
    <updated>2020-06-27T02:36:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>git æ˜¯ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç°åœ¨å¤§éƒ¨åˆ†é¡¹ç›®éƒ½ä¼šä½¿ç”¨å®ƒæ¥ç®¡ç†å¼€å‘çš„é¡¹ç›®ï¼Œä¸‹é¢æ•´ç†äº† git çš„å¸¸ç”¨å‘½ä»¤åŠä½¿ç”¨æ–¹å¼ã€‚</p><a id="more"></a><h1 id="GitåŸºç¡€"><a href="#GitåŸºç¡€" class="headerlink" title="GitåŸºç¡€"></a>GitåŸºç¡€</h1><h2 id="gitæœ€å°é…ç½®"><a href="#gitæœ€å°é…ç½®" class="headerlink" title="gitæœ€å°é…ç½®"></a>gitæœ€å°é…ç½®</h2><p>é…ç½® username å’Œ email</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &#39;your name&#39;</span><br><span class="line">git config --global user.email &#39;your email&#39;</span><br></pre></td></tr></table></figure><p>é…ç½® email çš„ç›®çš„ï¼Œå½“ç‰ˆæœ¬åº“ä¸­çš„ä»£ç å˜æ›´æ—¶ï¼Œä¼šè®°å½•å¯¹åº”å¼€å‘äººå‘˜çš„ email ç­‰ä¿¡æ¯ï¼Œå½“è¿›è¡Œ code review æ—¶ï¼Œè‹¥ç›¸åº”å˜æ›´çš„ä»£ç æœ‰é—®é¢˜ï¼Œä¼šå‘é€é‚®ä»¶é€šçŸ¥åˆ°å¯¹åº”çš„å¼€å‘è€…ã€‚</p><p>configçš„ ä¸‰ä¸ªä½œç”¨åŸŸï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --local  ç¼ºçœé…ç½®ï¼Œè¡¨ç¤ºåªå¯¹æŸä¸ªä»“åº“æœ‰æ•ˆ</span><br><span class="line">git config --global å¯¹å½“å‰ç”¨æˆ·æ‰€æœ‰ä»“åº“æœ‰æ•ˆ</span><br><span class="line">git config --system å¯¹ç³»ç»Ÿæ‰€æœ‰çš„ç™»å½•ç”¨æˆ·æœ‰æ•ˆ</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬éœ€è¦æ˜¾ç¤º config çš„é…ç½®ä¿¡æ¯æ—¶ï¼Œä½¿ç”¨ â€“list å°±è¡Œäº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --list --local</span><br><span class="line">git config --list --global</span><br><span class="line">git config --list --system</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Î» git config --list --global</span><br><span class="line">user.email&#x3D;wyzane1207@163.com</span><br><span class="line">user.name&#x3D;wyzane</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Î» git config --list</span><br><span class="line">core.symlinks&#x3D;false</span><br><span class="line">core.autocrlf&#x3D;true</span><br><span class="line">core.fscache&#x3D;true</span><br><span class="line">color.diff&#x3D;auto</span><br><span class="line">color.status&#x3D;auto</span><br><span class="line">color.branch&#x3D;auto</span><br><span class="line">color.interactive&#x3D;true</span><br><span class="line">help.format&#x3D;html</span><br><span class="line">rebase.autosquash&#x3D;true</span><br><span class="line">http.sslbackend&#x3D;openssl</span><br><span class="line">http.sslcainfo&#x3D;D:&#x2F;software&#x2F;Git&#x2F;mingw64&#x2F;ssl&#x2F;certs&#x2F;ca-bundle.crt</span><br><span class="line">credential.helper&#x3D;manager</span><br><span class="line">user.email&#x3D;wyzane1207@163.com</span><br><span class="line">user.name&#x3D;wyzane</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºä»“åº“"><a href="#åˆ›å»ºä»“åº“" class="headerlink" title="åˆ›å»ºä»“åº“"></a>åˆ›å»ºä»“åº“</h2><h3 id="æŠŠå·²æœ‰é¡¹ç›®ä»£ç çº³å…¥ç‰ˆæœ¬ç®¡ç†"><a href="#æŠŠå·²æœ‰é¡¹ç›®ä»£ç çº³å…¥ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="æŠŠå·²æœ‰é¡¹ç›®ä»£ç çº³å…¥ç‰ˆæœ¬ç®¡ç†"></a>æŠŠå·²æœ‰é¡¹ç›®ä»£ç çº³å…¥ç‰ˆæœ¬ç®¡ç†</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd é¡¹ç›®ä»£ç æ‰€åœ¨æ–‡ä»¶å¤¹</span><br><span class="line">git init</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºä¸€ä¸ªgitä»“åº“"><a href="#æ–°å»ºä¸€ä¸ªgitä»“åº“" class="headerlink" title="æ–°å»ºä¸€ä¸ªgitä»“åº“"></a>æ–°å»ºä¸€ä¸ªgitä»“åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd æŸä¸ªæ–‡ä»¶å¤¹</span><br><span class="line">git init ç›®å½•å</span><br><span class="line">cd ç›®å½•å</span><br></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ªgitä»“åº“çš„ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Î» git init demo1</span><br><span class="line">Initialized empty Git repository in F:&#x2F;GitTest&#x2F;demo1&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰§è¡Œ git config â€“global â€“list çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Î» git config --global --list</span><br><span class="line">user.email&#x3D;wyzane1207@163.com</span><br><span class="line">user.name&#x3D;wyzane</span><br></pre></td></tr></table></figure><p>åœ¨ demo1 ä»“åº“ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Î» git config --local user.name &#39;wz&#39;</span><br><span class="line">Î» git config --local user.email &#39;wyzane1207@gmail.com&#39;</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ ä¸€ä¸ªæ–‡ä»¶"><a href="#æ·»åŠ ä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="æ·»åŠ ä¸€ä¸ªæ–‡ä»¶"></a>æ·»åŠ ä¸€ä¸ªæ–‡ä»¶</h2><p>åœ¨ dem01 ç›®å½•ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶ readme.mdï¼Œæ­¤æ—¶æ‰§è¡Œ git statusï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line"></span><br><span class="line">        readme.md</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ˜¾ç¤ºï¼Œreadme.md æ–‡ä»¶æ˜¯æœªè¢«è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œæ‰§è¡Œ git add readme.mdï¼Œæ­¤æ—¶å†æ‰§è¡Œ git statusï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">        new file:   readme.md</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ git commit -m â€˜readme.mdâ€™ï¼Œè¡¨ç¤ºå°†æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œæ‰§è¡Œå®Œï¼Œæ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Î» git commit -m &#39;reaeme.md&#39;</span><br><span class="line">[master (root-commit) 28f3903] &#39;reaeme.md&#39;</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 readme.md</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå¯ä»¥ç”¨ git log å‘½ä»¤æŸ¥çœ‹æäº¤è®°å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Î» git log</span><br><span class="line">commit 28f3903644aea0102c9e7b7a6789b5990a45db50 (HEAD -&gt; master)</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Mon Jun 22 22:41:14 2020 +0800</span><br><span class="line"></span><br><span class="line">    &#39;reaeme.md&#39;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ç»“æœä¸­å¯ä»¥çœ‹å‡º local é…ç½®ä¼šè¦†ç›– global é…ç½®ã€‚</p><h2 id="å¾€ä»“åº“é‡Œæ·»åŠ æ–‡ä»¶"><a href="#å¾€ä»“åº“é‡Œæ·»åŠ æ–‡ä»¶" class="headerlink" title="å¾€ä»“åº“é‡Œæ·»åŠ æ–‡ä»¶"></a>å¾€ä»“åº“é‡Œæ·»åŠ æ–‡ä»¶</h2><p>ä¸Šé¢ä½¿ç”¨çš„ git addã€git commit ç­‰å‘½ä»¤çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git status: æŸ¥çœ‹å·¥ä½œç›®å½•å’Œæš‚å­˜åŒºçš„çŠ¶æ€</span><br><span class="line">git add: å°†å·¥ä½œç›®å½•çš„æ”¹åŠ¨æ·»åŠ åˆ°æš‚å­˜åŒº</span><br><span class="line">git add -uï¼šå°†å·¥ä½œåŒºä¸­ï¼Œå·²ç»è¢«gitç®¡ç†çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼ˆæ²¡æœ‰è¢«ç®¡ç†çš„åˆ™ä¸ä¼šæ·»åŠ åˆ°æš‚å­˜åŒºï¼‰</span><br><span class="line">git commit: å°†æš‚å­˜åŒºçš„é«˜çš„é‚£ä¸ªæ·»åŠ åˆ°æœ¬åœ°ä»“åº“</span><br><span class="line">git log: æŸ¥çœ‹å½“å‰åˆ†æ”¯çš„æœ¬åœ° commit çš„å†å²è®°å½• ï¼ˆæŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æäº¤è®°å½•ä½¿ç”¨ git log --allï¼‰</span><br></pre></td></tr></table></figure><p>git log æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Î» git log</span><br><span class="line">commit 683cbacc9aae84b55bf03a37217f09b23ec71b5a (HEAD -&gt; master)</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 22:50:22 2020 +0800</span><br><span class="line"></span><br><span class="line">    update</span><br><span class="line"></span><br><span class="line">commit 9548167eda1557775206f988e129625c8ebc664e</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 22:41:51 2020 +0800</span><br><span class="line"></span><br><span class="line">    add index</span><br><span class="line"></span><br><span class="line">commit 28f3903644aea0102c9e7b7a6789b5990a45db50</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Mon Jun 22 22:41:14 2020 +0800</span><br><span class="line"></span><br><span class="line">    add readme</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶é‡å‘½å"><a href="#æ–‡ä»¶é‡å‘½å" class="headerlink" title="æ–‡ä»¶é‡å‘½å"></a>æ–‡ä»¶é‡å‘½å</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶çš„é‡å‘½åå¯ä»¥åœ¨å·¥ä½œç›®å½•ä¸­å®Œæˆï¼Œç„¶åæ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå†æäº¤åˆ°æœ¬åœ°ä»“åº“ã€‚è¿™æ ·çš„æ–¹å¼æœ‰å¦‚ä¸‹é—®é¢˜ï¼š</span><br><span class="line">F:\GitTest\demo1 (master -&gt; origin)</span><br><span class="line">Î» mv index2.html index02.html</span><br><span class="line"></span><br><span class="line">F:\GitTest\demo1 (master -&gt; origin)</span><br><span class="line">Î» git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add&#x2F;rm &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">        deleted:    index2.html</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line"></span><br><span class="line">        index02.html</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and&#x2F;or &quot;git commit -a&quot;)</span><br><span class="line"></span><br><span class="line">ä»ä¸Šé¢çš„æ˜¾ç¤ºå¯ä»¥çœ‹å‡ºï¼Œåœ¨å·¥ä½œç›®å½•ä¸­é‡å‘½åæ˜¯å…ˆåˆ é™¤æ–‡ä»¶ï¼Œå†åˆ›å»ºæ–°æ–‡ä»¶ã€‚ç„¶åè¿˜éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">git add index02.html</span><br><span class="line">git rm index2.html  åˆ é™¤æš‚å­˜åŒºä¸­çš„æ–‡ä»¶</span><br><span class="line">æ‰§è¡Œ git status æ‰“å°å¦‚ä¸‹ï¼š</span><br><span class="line">Î» git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">        renamed:    index2.html -&gt; index02.html</span><br></pre></td></tr></table></figure><p>æŠŠæš‚å­˜åŒºä¸­æ‰€æœ‰çš„ä¿®æ”¹è¿˜åŸï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ›´æ”¹æ–‡ä»¶åçš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç›´æ¥ä¿®æ”¹æš‚å­˜åŒºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git mv index.html index02.html</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶å†æ‰§è¡Œ git statusï¼Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">Î» git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">        renamed:    index2.html -&gt; index02.html</span><br><span class="line">        </span><br><span class="line">è¿™ä¸ªç»“æœï¼Œè·Ÿä¸Šé¢çš„ç»“æœä¸€è‡´ã€‚</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ç‰ˆæœ¬å†å²"><a href="#æŸ¥çœ‹ç‰ˆæœ¬å†å²" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬å†å²"></a>æŸ¥çœ‹ç‰ˆæœ¬å†å²</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ git log å‘½ä»¤æŸ¥çœ‹ç‰ˆæœ¬å†å²ï¼Œgit log å‘½ä»¤è¿˜æœ‰ä»¥ä¸‹å‡ ç§ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1. git log --oneline  æŸ¥çœ‹ç®€æ´çš„ log ä¿¡æ¯</span><br><span class="line">febad01 (HEAD -&gt; master) ä¿®æ”¹æ–‡ä»¶å</span><br><span class="line">683cbac update</span><br><span class="line">9548167 add index</span><br><span class="line">28f3903 add readme</span><br><span class="line"></span><br><span class="line">2. git log -n2  ä½¿ç”¨ -n åŠ æ•°å­—çš„æ–¹å¼æŸ¥çœ‹æœ€è¿‘çš„å‡ æ¬¡æäº¤ æˆ–è€… git log -n2 --oneline</span><br><span class="line">commit febad01c1b094e73047b204fd31b827cb2a86ff2 (HEAD -&gt; master)</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 23:02:37 2020 +0800</span><br><span class="line"></span><br><span class="line">    ä¿®æ”¹æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">commit 683cbacc9aae84b55bf03a37217f09b23ec71b5a</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 22:50:22 2020 +0800</span><br><span class="line"></span><br><span class="line">    update</span><br><span class="line">    </span><br><span class="line">3. git log --all --graph  ä½¿ç”¨å›¾å½¢åŒ–çš„å½¢å¼å±•ç¤ºåˆ†æ”¯çš„æäº¤çˆ¶å­å…³ç³»</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¸Šé¢çš„æ‰€æœ‰å‚æ•°éƒ½å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ git help --web log æŸ¥çœ‹æ›´å¤š git log å‚æ•°ã€‚</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ gitk å‘½ä»¤å¯ä»¥æ‰“å¼€å›¾å½¢ç•Œé¢ï¼ŒæŸ¥çœ‹é¡¹ç›®çš„ç‰ˆæœ¬å†å²ã€‚</p><h2 id="gitç›®å½•ä»‹ç»"><a href="#gitç›®å½•ä»‹ç»" class="headerlink" title=".gitç›®å½•ä»‹ç»"></a>.gitç›®å½•ä»‹ç»</h2><p>æ‰§è¡Œ git init åï¼Œä¼šç”Ÿæˆä¸€ä¸ª ,git æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 dell 197121  16 6æœˆ  23 23:02 COMMIT_EDITMSG</span><br><span class="line">-rw-r--r-- 1 dell 197121 180 6æœˆ  22 22:29 config</span><br><span class="line">-rw-r--r-- 1 dell 197121  73 6æœˆ  22 22:24 description</span><br><span class="line">-rw-r--r-- 1 dell 197121 216 6æœˆ  25 14:55 gitk.cache</span><br><span class="line">-rw-r--r-- 1 dell 197121  21 6æœˆ  24 23:07 HEAD</span><br><span class="line">drwxr-xr-x 1 dell 197121   0 6æœˆ  22 22:24 hooks&#x2F;</span><br><span class="line">-rw-r--r-- 1 dell 197121 217 6æœˆ  24 23:08 index</span><br><span class="line">drwxr-xr-x 1 dell 197121   0 6æœˆ  22 22:24 info&#x2F;</span><br><span class="line">drwxr-xr-x 1 dell 197121   0 6æœˆ  22 22:41 logs&#x2F;</span><br><span class="line">drwxr-xr-x 1 dell 197121   0 6æœˆ  23 23:02 objects&#x2F;</span><br><span class="line">-rw-r--r-- 1 dell 197121  41 6æœˆ  23 22:59 ORIG_HEAD</span><br><span class="line">drwxr-xr-x 1 dell 197121   0 6æœˆ  22 22:24 refs&#x2F;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªæ–‡ä»¶çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">HEAD: æ–‡ä»¶ï¼Œä¿å­˜äº†å½“å‰æ­£åœ¨å·¥ä½œçš„åˆ†æ”¯ï¼Œåˆ‡æ¢åˆ†æ”¯æ—¶å†…å®¹ä¼šæ”¹å˜ï¼Œå†…å®¹ä¸ºï¼šref: refs&#x2F;heads&#x2F;master</span><br><span class="line">config: æ–‡ä»¶ï¼Œä¿å­˜äº†ä¸æœ¬åœ°ä»“åº“ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line">[core]</span><br><span class="line">        repositoryformatversion &#x3D; 0</span><br><span class="line">        filemode &#x3D; false</span><br><span class="line">        bare &#x3D; false</span><br><span class="line">        logallrefupdates &#x3D; true</span><br><span class="line">        symlinks &#x3D; false</span><br><span class="line">        ignorecase &#x3D; true</span><br><span class="line">[user]</span><br><span class="line">        name &#x3D; &#39;wz&#39;</span><br><span class="line">        email &#x3D; &#39;wyzane1207@163.com&#39;</span><br><span class="line">refs: ç›®å½•ï¼ŒåŒ…å« heads(ä¿å­˜åˆ†æ”¯) å’Œ tags(ä¿å­˜æ ‡ç­¾)</span><br><span class="line">refs&#x2F;heads&#x2F;master ä¸­ä¿å­˜çš„æ˜¯ä¸€ä¸ª commit çš„ idï¼ŒæŒ‡å‘ä¸€ä¸ª commit</span><br><span class="line">objects: ç›®å½•ï¼Œä¿å­˜äº† treeã€glob ç­‰å¯¹è±¡çš„ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="gitå¯¹è±¡ä¹‹é—´çš„å…³ç³»"><a href="#gitå¯¹è±¡ä¹‹é—´çš„å…³ç³»" class="headerlink" title="gitå¯¹è±¡ä¹‹é—´çš„å…³ç³»"></a>gitå¯¹è±¡ä¹‹é—´çš„å…³ç³»</h2><p>commitã€treeã€blobä¸‰è€…ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªcommitå¯¹åº”ä¸€ä¸ªtreeï¼Œè¿™ä¸ªtreeè¡¨ç¤ºå½“æ—¶commitåï¼Œé¡¹ç›®çš„æ•´ä¸ªç›®å½•ç»“æ„ï¼Œè¿™ä¸ªtreeä¸‹é¢æœ‰å¯ä»¥åŒ…å«å¤šä¸ªå­tree(ç›®å½•)å’Œblob(æ–‡ä»¶)ã€‚</span><br><span class="line">å­treeä¼šå¯¹åº”é¡¹ç›®ä¸­çš„ä¸€ä¸ªç›®å½•ï¼Œå­treeä¸­ä¹ŸåŒ…å«å¾ˆå¤šblobå’Œå­treeã€‚</span><br><span class="line">ä¸€ä¸ªblobå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œåªè¦æ–‡ä»¶å†…å®¹ç›¸åŒï¼Œå°±æ˜¯åŒä¸€ä¸ªblobå¯¹è±¡ã€‚</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Î» git cat-file -p f9c5d761a  æŸ¥çœ‹f9c5d761açš„å†…å®¹</span><br><span class="line">tree b4f5e1498a011eb1267852ff76ccbad35c08aac4</span><br><span class="line">parent febad01c1b094e73047b204fd31b827cb2a86ff2</span><br><span class="line">author wyzane &lt;wyzane1207@163.com&gt; 1593072058 +0800</span><br><span class="line">committer wyzane &lt;wyzane1207@163.com&gt; 1593072058 +0800</span><br><span class="line"></span><br><span class="line">æ·»åŠ ç”¨æˆ·é¡µé¢</span><br><span class="line"></span><br><span class="line">F:\GitTest\demo1 (master -&gt; origin)</span><br><span class="line">Î» git cat-file -t f9c5d761a  æŸ¥çœ‹f9c5d761açš„ç±»å‹</span><br><span class="line">commit</span><br><span class="line"></span><br><span class="line">F:\GitTest\demo1 (master -&gt; origin)</span><br><span class="line">Î» git cat-file -p b4f5e1498a011   æŸ¥çœ‹f9c5d761aä¸‹treeå¯¹è±¡b4f5e1498a011çš„å†…å®¹</span><br><span class="line">100644 blob fd98613334e79fb5a12f537462627af2b7efdacd    index.html</span><br><span class="line">100644 blob 9b562d265a03e923b86bfc3b9b8418463f4f1c70    index02.html</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391    readme.md</span><br><span class="line">040000 tree fa6ab77bfb3a6f0cbecd74ef7e98e8624ee4c099    test</span><br><span class="line"></span><br><span class="line">F:\GitTest\demo1 (master -&gt; origin)</span><br><span class="line">Î» git cat-file -t b4f5e1498a011  æŸ¥çœ‹b4f5e1498a011çš„ç±»å‹</span><br><span class="line">tree</span><br><span class="line"></span><br><span class="line">F:\GitTest\demo1 (master -&gt; origin)</span><br><span class="line">Î» git cat-file -p fa6ab77bfb3</span><br><span class="line">100644 blob 41d4171c5880f9cdab07eadc8564d04e7ee1e055    user.html</span><br><span class="line"></span><br><span class="line">ä»ä¸Šé¢çš„æ‰“å°ä¿¡æ¯ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªcommitå¯¹åº”ä¸€ä¸ªtreeï¼Œè¿™ä¸ªtreeä¸‹é¢å¯ä»¥æœ‰blobå¯¹è±¡å’Œå­treeå¯¹è±¡ï¼Œå­treeä¸‹é¢è¿˜æœ‰blobå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œ git cat-file -p fd98613334e79fbï¼Œæ˜¾ç¤ºå‡º blob å¯¹è±¡çš„å†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line">&lt;h1&gt;git test&lt;h1&#x2F;&gt;</span><br><span class="line">&lt;h1&gt;git test&lt;h1&#x2F;&gt;</span><br><span class="line">&lt;h1&gt;git test&lt;h1&#x2F;&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ†ç¦»å¤´æŒ‡é’ˆ"><a href="#åˆ†ç¦»å¤´æŒ‡é’ˆ" class="headerlink" title="åˆ†ç¦»å¤´æŒ‡é’ˆ"></a>åˆ†ç¦»å¤´æŒ‡é’ˆ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åˆ†ç¦»å¤´æŒ‡é’ˆæ˜¯æŒ‡ï¼Œåšçš„å˜æ›´ä¸æ˜¯åŸºäºä¸€ä¸ªåˆ†æ”¯ã€‚</span><br><span class="line">HEAD å¯ä»¥æŒ‡å‘ä¸€ä¸ªåˆ†æ”¯ï¼ˆæœ€ç»ˆè¿˜æ˜¯æŒ‡å‘ä¸€ä¸ªcommitï¼‰ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘ä¸€ä¸ªcommitï¼Œå½“ä½¿ç”¨ git checkout commitID æ—¶ï¼ŒHEADä¼šåˆ‡æ¢åˆ°ä¸€ä¸ªç‰¹å®šçš„commitã€‚æ­¤æ—¶æˆ‘ä»¬åšçš„ä»»ä½•å˜æ›´ä¸æ˜¯åŸºäºåˆ†æ”¯çš„ï¼Œè€Œæ˜¯åŸºäºè¿™ä¸ªcommitï¼Œå½“åˆ‡æ¢å›å…¶ä»–åˆ†æ”¯æ—¶ï¼Œåœ¨commitä¸Šåšçš„å˜æ›´å°±ä¼šè¢«gitä¸¢å¼ƒæ‰ã€‚</span><br><span class="line">å½“æˆ‘ä»¬éœ€è¦åšä¸€äº›å®éªŒæ€§çš„å˜æ›´æ—¶ï¼Œå¯ä»¥è¿™æ ·åšã€‚</span><br></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µä¸‹ï¼ŒHEADä¼šæŒ‡å‘ä¸€ä¸ªåˆ†æ”¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Î» git log</span><br><span class="line">commit f9c5d761a8922dd69345da752ab135881418bc51 (HEAD -&gt; master)</span><br><span class="line">Author: wyzane &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Thu Jun 25 16:00:58 2020 +0800</span><br><span class="line"></span><br><span class="line">    æ·»åŠ ç”¨æˆ·é¡µé¢</span><br><span class="line"></span><br><span class="line">commit febad01c1b094e73047b204fd31b827cb2a86ff2</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 23:02:37 2020 +0800</span><br><span class="line"></span><br><span class="line">    ä¿®æ”¹æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">commit 683cbacc9aae84b55bf03a37217f09b23ec71b5a</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 22:50:22 2020 +0800</span><br><span class="line"></span><br><span class="line">    update</span><br><span class="line"></span><br><span class="line">commit 9548167eda1557775206f988e129625c8ebc664e (temp)</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 22:41:51 2020 +0800</span><br><span class="line"></span><br><span class="line">    add index</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰§è¡Œ git checkout 9548 febad01c1b åï¼ŒHEADä¼šæŒ‡å‘ä¸€ä¸ª commitï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Î» git checkout febad01c1b</span><br><span class="line">Note: checking out &#39;febad01c1b&#39;.</span><br><span class="line"></span><br><span class="line">You are in &#39;detached HEAD&#39; state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make in this</span><br><span class="line">state without impacting any branches by performing another checkout.</span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line">do so (now or later) by using -b with the checkout command again. Example:</span><br><span class="line"></span><br><span class="line">  git checkout -b &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line">HEAD is now at febad01 ä¿®æ”¹æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">Î» git log</span><br><span class="line">commit febad01c1b094e73047b204fd31b827cb2a86ff2 (HEAD)</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 23:02:37 2020 +0800</span><br><span class="line"></span><br><span class="line">    ä¿®æ”¹æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">commit 683cbacc9aae84b55bf03a37217f09b23ec71b5a</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 22:50:22 2020 +0800</span><br><span class="line"></span><br><span class="line">    update</span><br><span class="line"></span><br><span class="line">commit 9548167eda1557775206f988e129625c8ebc664e (temp)</span><br><span class="line">Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">Date:   Tue Jun 23 22:41:51 2020 +0800</span><br><span class="line"></span><br><span class="line">    add index</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹commitçš„msg"><a href="#ä¿®æ”¹commitçš„msg" class="headerlink" title="ä¿®æ”¹commitçš„msg"></a>ä¿®æ”¹commitçš„msg</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡ commit çš„ msg ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">git commit --amend</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ä¿®æ”¹å…¶ä»– commit çš„ msg</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹å…¶ä»–-commit-çš„-msg"><a href="#ä¿®æ”¹å…¶ä»–-commit-çš„-msg" class="headerlink" title="ä¿®æ”¹å…¶ä»– commit çš„ msg"></a>ä¿®æ”¹å…¶ä»– commit çš„ msg</h2><p>å¯¹å…¶ä»– commit çš„ msg ä¿®æ”¹æ—¶ï¼Œéœ€è¦ç”¨åˆ° git rebase å‘½ä»¤ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦ç¡®å®šå¾…ä¿®æ”¹commitçš„ä¸Šä¸€ä¸ªcommitIDï¼Œä»¥è¿™ä¸ªcommitä¸ºåŸºç¡€ã€‚ç„¶åæ‰§è¡Œ git rebase -i ä¸Šä¸€ä¸ªcommitIDï¼Œä¼šè¿›å…¥ä¸€ä¸ªç¼–è¾‘é¡µé¢ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pick f5b4cb5 ä¿®æ”¹æ–‡ä»¶å</span><br><span class="line">pick a0b86da æ·»åŠ ç”¨æˆ·é¡µé¢2</span><br><span class="line"></span><br><span class="line"># Rebase 683cbac..a0b86da onto 683cbac (2 commands)</span><br><span class="line">#</span><br><span class="line"># Commands:</span><br><span class="line"># p, pick &lt;commit&gt; &#x3D; use commit</span><br><span class="line"># r, reword &lt;commit&gt; &#x3D; use commit, but edit the commit message</span><br><span class="line"># e, edit &lt;commit&gt; &#x3D; use commit, but stop for amending</span><br><span class="line"># s, squash &lt;commit&gt; &#x3D; use commit, but meld into previous commit</span><br><span class="line"># f, fixup &lt;commit&gt; &#x3D; like &quot;squash&quot;, but discard this commit&#39;s log message</span><br><span class="line"># x, exec &lt;command&gt; &#x3D; run command (the rest of the line) using shell</span><br><span class="line"># b, break &#x3D; stop here (continue rebase later with &#39;git rebase --continue&#39;)</span><br><span class="line"># d, drop &lt;commit&gt; &#x3D; remove commit</span><br><span class="line"># l, label &lt;label&gt; &#x3D; label current HEAD with a name</span><br><span class="line"># t, reset &lt;label&gt; &#x3D; reset HEAD to a label</span><br><span class="line"># m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span><br><span class="line"># .       create a merge commit using the original merge commit&#39;s</span><br><span class="line"># .       message (or the oneline, if no original merge commit was</span><br><span class="line"># .       specified). Use -c &lt;commit&gt; to reword the commit message.</span><br><span class="line">#</span><br><span class="line"># These lines can be re-ordered; they are executed from top to bottom.</span><br><span class="line">#</span><br><span class="line"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class="line">#</span><br><span class="line"># However, if you remove everything, the rebase will be aborted.</span><br><span class="line">#</span><br><span class="line"># Note that empty commits are commented out</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–‡ä»¶ä¸­ï¼ŒæŒ‘é€‰å‡ºäº†ä¸¤ä¸ª commitï¼Œç„¶åä¸‹é¢æœ‰é€‰æ‹©æ‰§è¡Œçš„å‘½ä»¤ã€‚ä¿®æ”¹ commit æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹© commit message å‘½ä»¤ï¼Œå³æŠŠç¬¬ä¸€è¡Œçš„ pick æ”¹æˆ rewordï¼Œç„¶åä¿å­˜ã€‚ä¿å­˜ååˆä¼šè¿›å…¥ä¸€ä¸ªç¼–è¾‘é¡µé¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line"># Please enter the commit message for your changes. Lines starting</span><br><span class="line"># with &#39;#&#39; will be ignored, and an empty message aborts the commit.</span><br><span class="line">#</span><br><span class="line"># Author:    wz &lt;wyzane1207@163.com&gt;</span><br><span class="line"># Date:      Tue Jun 23 23:02:37 2020 +0800</span><br><span class="line">#</span><br><span class="line"># interactive rebase in progress; onto 683cbac</span><br><span class="line"># Last command done (1 command done):</span><br><span class="line">#    reword f5b4cb5 ä¿®æ”¹æ–‡ä»¶å2</span><br><span class="line"># Next command to do (1 remaining command):</span><br><span class="line">#    pick a0b86da æ·»åŠ ç”¨æˆ·é¡µé¢2</span><br><span class="line"># You are currently editing a commit while rebasing branch &#39;master&#39; on &#39;683cbac&#39;.</span><br><span class="line">#</span><br><span class="line"># Changes to be committed:</span><br><span class="line">#       renamed:    index2.html -&gt; index02.html</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬ä¿®æ”¹å®Œ msg åä¿å­˜å³å¯ã€‚</p><h2 id="åˆå¹¶commit"><a href="#åˆå¹¶commit" class="headerlink" title="åˆå¹¶commit"></a>åˆå¹¶commit</h2><p>å¯¹å…¶ä»– commit çš„ msg ä¿®æ”¹æ—¶ï¼Œéœ€è¦ç”¨åˆ° git rebase å‘½ä»¤ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦ç¡®å®šå¾…ä¿®æ”¹commitçš„ä¸Šä¸€ä¸ªcommitIDï¼Œä»¥è¿™ä¸ªcommitä¸ºåŸºç¡€ã€‚ç„¶åæ‰§è¡Œ git rebase -i ä¸Šä¸€ä¸ªcommitIDï¼Œä¼šè¿›å…¥ä¸€ä¸ªç¼–è¾‘é¡µé¢ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pick 9548167 add index</span><br><span class="line">pick 683cbac update</span><br><span class="line">pick 4a558f9 ä¿®æ”¹æ–‡ä»¶å2</span><br><span class="line">pick 8d1455b æ·»åŠ ç”¨æˆ·é¡µé¢2</span><br><span class="line"></span><br><span class="line"># Rebase 28f3903..8d1455b onto 28f3903 (4 commands)</span><br><span class="line">#</span><br><span class="line"># Commands:</span><br><span class="line"># p, pick &lt;commit&gt; &#x3D; use commit</span><br><span class="line"># r, reword &lt;commit&gt; &#x3D; use commit, but edit the commit message</span><br><span class="line"># e, edit &lt;commit&gt; &#x3D; use commit, but stop for amending</span><br><span class="line"># s, squash &lt;commit&gt; &#x3D; use commit, but meld into previous commit</span><br><span class="line"># f, fixup &lt;commit&gt; &#x3D; like &quot;squash&quot;, but discard this commit&#39;s log message</span><br><span class="line"># x, exec &lt;command&gt; &#x3D; run command (the rest of the line) using shell</span><br><span class="line"># b, break &#x3D; stop here (continue rebase later with &#39;git rebase --continue&#39;)</span><br><span class="line"># d, drop &lt;commit&gt; &#x3D; remove commit</span><br><span class="line"># l, label &lt;label&gt; &#x3D; label current HEAD with a name</span><br><span class="line"># t, reset &lt;label&gt; &#x3D; reset HEAD to a label</span><br><span class="line"># m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span><br><span class="line"># .       create a merge commit using the original merge commit&#39;s</span><br><span class="line"># .       message (or the oneline, if no original merge commit was</span><br><span class="line"># .       specified). Use -c &lt;commit&gt; to reword the commit message.</span><br><span class="line">#</span><br><span class="line"># These lines can be re-ordered; they are executed from top to bottom.</span><br><span class="line">#</span><br><span class="line"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class="line">#</span><br><span class="line"># However, if you remove everything, the rebase will be aborted.</span><br><span class="line">#</span><br><span class="line"># Note that empty commits are commented out</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŠŠ 683cbacã€4a558f9 è¿™ä¸¤ä¸ª commit åˆå¹¶åˆ°ç¬¬ä¸€ä¸ª commit ä¸­ã€‚æ ¹æ®æ–‡ä»¶ä¸­çš„è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ squashï¼ˆæˆ–è€…ç®€å†™æˆsï¼‰ å‘½ä»¤ã€‚ä¿®æ”¹æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pick 9548167 add index</span><br><span class="line">squash 683cbac update</span><br><span class="line">squash 4a558f9 ä¿®æ”¹æ–‡ä»¶å2</span><br><span class="line">pick 8d1455b æ·»åŠ ç”¨æˆ·é¡µé¢2</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ç„¶åä¿å­˜ï¼Œä¼šå‡ºç°å¦‚ä¸‹æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># This is a combination of 3 commits.</span><br><span class="line"># This is the 1st commit message:</span><br><span class="line"></span><br><span class="line">add index</span><br><span class="line"></span><br><span class="line"># This is the commit message #2:</span><br><span class="line"></span><br><span class="line">update</span><br><span class="line"></span><br><span class="line"># This is the commit message #3:</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹æ–‡ä»¶å2</span><br><span class="line"></span><br><span class="line"># Please enter the commit message for your changes. Lines starting</span><br><span class="line"># with &#39;#&#39; will be ignored, and an empty message aborts the commit.</span><br><span class="line">#</span><br><span class="line"># Author:    wz &lt;wyzane1207@163.com&gt;</span><br><span class="line"># Date:      Tue Jun 23 22:41:51 2020 +0800</span><br><span class="line">#</span><br><span class="line"># interactive rebase in progress; onto 28f3903</span><br><span class="line"># Last commands done (3 commands done):</span><br><span class="line">#    squash 683cbac update</span><br><span class="line">#    squash 4a558f9 ä¿®æ”¹æ–‡ä»¶å2</span><br><span class="line"># Next command to do (1 remaining command):</span><br><span class="line">#    pick 8d1455b æ·»åŠ ç”¨æˆ·é¡µé¢2</span><br><span class="line"># You are currently rebasing branch &#39;master&#39; on &#39;28f3903&#39;.</span><br><span class="line">#</span><br><span class="line"># Changes to be committed:</span><br><span class="line">#       new file:   index.html</span><br><span class="line">#       new file:   index02.html</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€è¡Œä¸‹é¢å†™åˆå¹¶ commit çš„æ³¨é‡Šï¼Œå†™å®Œä¿å­˜å³å¯ã€‚æ‰§è¡Œ git log â€“graphï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ commit è®°å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Î» git log --graph</span><br><span class="line">* commit 04c862efc7b757b2038144ab24b2dc913151213c (HEAD -&gt; master)</span><br><span class="line">| Author: wyzane &lt;wyzane1207@163.com&gt;</span><br><span class="line">| Date:   Thu Jun 25 16:00:58 2020 +0800</span><br><span class="line">|</span><br><span class="line">|     æ·»åŠ ç”¨æˆ·é¡µé¢2</span><br><span class="line">|</span><br><span class="line">* commit 2343bc35bef0f096b3768403fbceeb587e8ddfcf</span><br><span class="line">| Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">| Date:   Tue Jun 23 22:41:51 2020 +0800</span><br><span class="line">|</span><br><span class="line">|     åˆå¹¶commitæµ‹è¯•</span><br><span class="line">|</span><br><span class="line">|     add index</span><br><span class="line">|</span><br><span class="line">|     update</span><br><span class="line">|</span><br><span class="line">|     ä¿®æ”¹æ–‡ä»¶å2</span><br><span class="line">|</span><br><span class="line">* commit 28f3903644aea0102c9e7b7a6789b5990a45db50</span><br><span class="line">  Author: wz &lt;wyzane1207@163.com&gt;</span><br><span class="line">  Date:   Mon Jun 22 22:41:14 2020 +0800</span><br><span class="line"></span><br><span class="line">      reaeme.md</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ 2343bc35bef0f096b3768403fbceeb587e8ddfcf è¿™ä¸ªå°±æ˜¯æ–°ç”Ÿæˆçš„commitã€‚</p><h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><h2 id="git-check"><a href="#git-check" class="headerlink" title="git check"></a>git check</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout åˆ†æ”¯å: åˆ‡æ¢åˆ°åˆ†æ”¯</span><br><span class="line">git checkout -b åˆ†æ”¯å: åˆ›å»ºæ–°åˆ†æ”¯å¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯</span><br><span class="line">git checkout -b æ–°åˆ†æ”¯å åŸºäºåˆ†æ”¯åæˆ–è€…commitID: åŸºäºæŸä¸ªåˆ†æ”¯æˆ–è€…commitåˆ›å»ºä¸€ä¸ªåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span><br></pre></td></tr></table></figure><h2 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch: æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨</span><br><span class="line">git branch -d åˆ†æ”¯å: åˆ é™¤æŸä¸ªåˆ†æ”¯ </span><br><span class="line">git branch -D åˆ†æ”¯å: å¼ºåˆ¶åˆ é™¤æŸä¸ªåˆ†æ”¯</span><br></pre></td></tr></table></figure><h2 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git diff ç”¨æˆ·æ¯”è¾ƒä¸¤ä¸ª commit çš„åŒºåˆ«</span><br><span class="line">git diff commitID1 commitID2: æ¯”è¾ƒä¸¤ä¸ªcommit</span><br><span class="line">git diff HEAD HEAD~1: æ¯”è¾ƒå½“å‰commitä¸ä¸Šä¸€æ¬¡commitçš„åŒºåˆ«</span><br><span class="line">git diff HEAD HEAD^^ ä¸ git diff HEAD HEAD~2 ä¸€æ ·</span><br></pre></td></tr></table></figure><h2 id="git-cat-file"><a href="#git-cat-file" class="headerlink" title="git cat-file"></a>git cat-file</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git cat-file -t 9b562d265a03e923b86bfc3b9b8418463f4f1c70: æŸ¥çœ‹hashå€¼çš„ç±»å‹ï¼ˆè¿™ä¸ªæ˜¯blobç±»å‹ï¼Œå³æ–‡ä»¶å¯¹è±¡ï¼‰</span><br><span class="line">git cat-file -p 9b562d265a03e923b86bfc3b9b8418463f4f1c70: æŸ¥çœ‹hashå€¼çš„å†…å®¹</span><br><span class="line">è¿™ä¸ª blog ç±»å‹çš„å†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line">&lt;h1&gt;git test&lt;h1&#x2F;&gt;</span><br><span class="line">        &lt;h1&gt;git test&lt;h1&#x2F;&gt;</span><br><span class="line">git cat-file -t 239ec593c6a2192e76c005435f748b2ad28be832ï¼šæŸ¥çœ‹hashå€¼çš„ç±»å‹ï¼ˆè¿™ä¸ªæ˜¯treeç±»å‹ï¼Œå³ç›®å½•ï¼‰</span><br><span class="line">git cat-file -p 239ec593c6a2192e76c005435f748b2ad28be832: æŸ¥çœ‹è¾“å‡ºå†…å®¹ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼ˆå†…å®¹æ˜¯ä¸€ä¸ªblobå¯¹è±¡ï¼‰ï¼š</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391    readme.md</span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸­ â€¦..</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;git æ˜¯ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç°åœ¨å¤§éƒ¨åˆ†é¡¹ç›®éƒ½ä¼šä½¿ç”¨å®ƒæ¥ç®¡ç†å¼€å‘çš„é¡¹ç›®ï¼Œä¸‹é¢æ•´ç†äº† git çš„å¸¸ç”¨å‘½ä»¤åŠä½¿ç”¨æ–¹å¼ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://wyzane.gitee.io/blog/categories/Python/"/>
    
    
      <category term="Git" scheme="http://wyzane.gitee.io/blog/tags/Git/"/>
    
  </entry>
  
</feed>
